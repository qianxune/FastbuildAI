const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CU7SWF6K.js","./Cgyg1gJC.js","./Ghlq83yM.js","./DQMjdCEn.js","./OUYfsp1i.js","./BFo3vNrE.js","./CuVAPZQ8.js","./Z7qkLoXK.js","./CjE5iPSn.js","./D9UsdH-b.js","./MCK2d4XT.js","./EK7Wbu3-.js","./CClQHGwT.js","./kJ7pMXHJ.js"])))=>i.map(i=>d[i]);
import{d as j,a_ as G,i as H,at as X,av as q,j as J,V as K,a2 as Y,b2 as Z,n as ee,W as E,ai as te,c as i,g as t,x as r,t as p,z as o,F as re,E as se,w as _,y as I,G as oe,_ as ae,b3 as ne,X as T,o as d,B as ce,C as ie,A as b}from"#entry";import{_ as de}from"./Co1Njv5N.js";import{P as le}from"./CClQHGwT.js";import{a as pe,c as S,d as me,b as Q}from"./D5Fk3VIb.js";import{u as ue}from"./B-cZF5FC.js";import"./D9sX2Qi6.js";import"./CtosDvS0.js";import"./CAQVAH0V.js";import"./BCcN9pii.js";import"./CMKSl-Ng.js";import"./Deu6qIfg.js";import"./DBEJUH-Z.js";import"./CuVAPZQ8.js";import"./BzLCLO6P.js";const he={class:"h-full"},ge={key:0,class:"flex h-full flex-col space-y-4 px-6 pt-6"},fe={class:"flex flex-1 flex-col space-y-8 overflow-y-auto"},_e={class:"bg-muted flex items-center gap-4 rounded-lg p-4"},ye={class:"text-lg font-medium"},xe={class:"text-center"},ve={class:"space-y-4"},ke={class:"text-lg font-medium"},Ie={key:0,class:"grid grid-cols-1 gap-x-4 gap-y-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"},be=["onClick"],we={key:0,class:"absolute -top-4 left-0 rounded-tl-md rounded-br-md bg-[#352B00] px-2 py-0.5 text-xs text-[#FFE7B5]"},Pe={class:"mb-2 flex items-center gap-2"},Ce={class:"text-xl font-bold"},Re={class:"mb-4 text-lg font-medium"},Oe={class:"space-y-2"},Me={key:0,class:"flex items-center gap-2"},Ee={class:"space-x-1 text-sm text-gray-600"},Te={class:"font-bold"},Se={key:1,class:"text-muted-foreground"},Qe={class:"space-y-4"},Ae={class:"text-lg font-medium"},Ve={class:"flex flex-row items-center justify-start gap-6"},De={class:"flex items-center gap-2"},$e={class:"space-y-4"},Be={class:"text-lg font-medium"},Le=["innerHTML"],Ue={key:1,class:"text-muted-foreground text-sm"},ze={class:"flex items-center justify-between border-t pt-4"},Fe={class:"text-lg"},We={class:"text-muted-foreground text-sm"},Ne={class:"flex items-center gap-4"},je={key:0,class:"text-xl font-bold"},Ge={key:1,class:"flex h-full w-full items-center justify-center p-20"},He={class:"w-full max-w-md p-8 text-center"},Xe={class:"mb-2 text-2xl font-bold"},qe={class:"text-muted-foreground text-sm"},mt=j({__name:"recharge-center",async setup(Je){let h,w;const A=E(()=>T(()=>import("./CU7SWF6K.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]),import.meta.url)),V=E(()=>T(()=>import("./kJ7pMXHJ.js"),__vite__mapDeps([13,1,2,3,4,5,6,7,8,9,10,11]),import.meta.url)),D=G(),{t:n}=H(),y=X(),P=q(),m=J(),C=K(),e=Y({_prepaidData:null,orderInfo:null,rechargeOptions:[],paymentMethods:[],selectedOptionIndex:0,selectedPaymentMethod:le.WECHAT,rechargeInstructions:void 0,rechargeSuccess:!1,isQrCodeExpired:!1}),{start:R,clear:x}=ue(async s=>{try{if(!e.orderInfo?.orderId){s();return}(await pe({orderId:e.orderInfo.orderId,from:"recharge"})).payStatus===1&&(s(),await $(),await m.getUser(),L())}catch(a){console.error("Payment polling error:",a)}},{interval:3e3,maxWaitTime:12e4,stopCondition:()=>e.isQrCodeExpired,onEnded:()=>{e.rechargeSuccess||(e.isQrCodeExpired=!0)}}),{data:v}=([h,w]=Z(()=>ne("rechargeCenterInfo",()=>S(),{transform:s=>{e.paymentMethods=s.payWayList.map(l=>({value:l.payType,label:l.name,icon:l.logo}));const a=s.payWayList.find(l=>l.isDefault);return a&&(e.selectedPaymentMethod=a.payType),e.rechargeInstructions=s.rechargeExplain,e.rechargeOptions=s.rechargeRule,s}})),h=await h,w(),h),$=async()=>{try{const s=await S();e.paymentMethods=s.payWayList.map(a=>({value:a.payType,label:a.name,icon:a.logo})),e.rechargeInstructions=s.rechargeExplain,e.rechargeOptions=s.rechargeRule}catch(s){console.error("Failed to refresh recharge info:",s)}},g=ee(()=>e.rechargeOptions.length===0?null:e.rechargeOptions[e.selectedOptionIndex]),B=async()=>{try{if(!g.value){y.error(n("marketing.frontend.recharge.noOptionSelected"));return}const s=await me({id:g.value.id,payType:e.selectedPaymentMethod});e.orderInfo=s;const a=await Q({from:"recharge",orderId:s.orderId,payType:e.selectedPaymentMethod});M(a),e.isQrCodeExpired=!1,e.rechargeSuccess=!1,R()}catch(s){console.error("Recharge failed:",s)}},O=C.create(A),M=async s=>{await O.open({prepaidData:s,orderInfo:e.orderInfo,isQrCodeExpired:e.isQrCodeExpired,onRefreshQrCode:()=>z()}).result&&(x(),e.isQrCodeExpired=!1,y.warning(n("marketing.frontend.recharge.cancelPay")))},L=async()=>{const a=C.create(V).open();O.close(),await a.result&&W()},U=()=>{P.push(`/profile/${m.userInfo?.id}/power-detail`)},z=async()=>{try{if(x(),!e.orderInfo?.orderId){console.error("Order ID does not exist"),y.error(n("marketing.frontend.recharge.orderNotFound"));return}const s=await Q({from:"recharge",orderId:e.orderInfo.orderId,payType:e.selectedPaymentMethod});M(s),e.isQrCodeExpired=!1,e.rechargeSuccess=!1,R()}catch(s){console.error("Failed to refresh QR code:",s)}},F=()=>{window.open("/agreement?type=agreement&item=payment","_blank")},W=()=>{P.push(`/profile/${m.userInfo?.id}/power-detail`)};return te(()=>{x()}),(s,a)=>{const l=oe,f=ce,N=de,k=ae;return d(),i("div",he,[t(v)?.rechargeStatus?(d(),i("div",ge,[r("div",fe,[r("div",_e,[p(l,{src:t(m).userInfo.avatar,size:"3xl"},null,8,["src"]),r("div",null,[r("div",ye,[r("span",null,o(t(m).userInfo.nickname||t(n)("user.frontend.profile.notSet")),1)]),r("div",{class:"text-muted-foreground flex cursor-pointer items-center gap-1",onClick:U},[r("span",xe,o(t(n)("marketing.frontend.recharge.powerBalance"))+"： "+o(t(v)?.user.power),1),p(f,{name:"i-lucide-chevron-right",class:"text-sm"})])])]),r("div",ve,[r("h2",ke,o(t(n)("marketing.frontend.recharge.selectRechargePackage")),1),t(e).rechargeOptions.length>0?(d(),i("div",Ie,[(d(!0),i(re,null,se(t(e).rechargeOptions,(c,u)=>(d(),i("div",{key:u,class:ie(["border-muted relative cursor-pointer rounded-lg border p-4 transition-all duration-200",{"border-primary-500 bg-muted":t(e).selectedOptionIndex===u,"bg-primary/5":t(e).selectedOptionIndex===u,"hover:border-primary-300 border-gray-200":t(e).selectedOptionIndex!==u}]),onClick:Ke=>t(e).selectedOptionIndex=u},[c.label?(d(),i("div",we,o(c.label),1)):I("",!0),r("div",Pe,[p(f,{name:"i-lucide-zap",class:"text-primary text-xl"}),r("span",Ce,o(c.power),1)]),r("div",Re,"¥ "+o(c.sellPrice),1),r("ul",Oe,[c.givePower?(d(),i("li",Me,[p(f,{name:"i-lucide-check",class:"text-sm text-green-500"}),r("span",Ee,[r("span",null,o(t(n)("marketing.frontend.recharge.add")),1),r("span",Te,o(c.givePower),1),r("span",null,o(t(n)("marketing.frontend.recharge.power")),1)])])):I("",!0)])],10,be))),128))])):(d(),i("div",Se,o(t(n)("marketing.frontend.recharge.noRechargeOptions")),1))]),r("div",Qe,[r("h2",Ae,o(t(n)("marketing.frontend.recharge.paymentMethod")),1),r("div",Ve,[p(N,{modelValue:t(e).selectedPaymentMethod,"onUpdate:modelValue":a[0]||(a[0]=c=>t(e).selectedPaymentMethod=c),orientation:"horizontal",variant:"card",color:"primary",items:t(e).paymentMethods},{label:_(({item:c})=>[r("div",De,[p(l,{src:c?.icon,size:"2xs"},null,8,["src"]),r("span",null,o(c?.label),1)])]),_:1},8,["modelValue","items"])])]),r("div",$e,[r("h2",Be,o(t(n)("marketing.frontend.recharge.rechargeInstructions.title")),1),t(e).rechargeInstructions?(d(),i("div",{key:0,innerHTML:t(e).rechargeInstructions,class:"text-muted-foreground space-y-2 text-sm whitespace-pre-wrap"},null,8,Le)):(d(),i("div",Ue,o(t(n)("marketing.frontend.recharge.rechargeInstructions.content")),1))])]),r("div",ze,[r("div",Fe,[r("span",We,o(t(n)("marketing.frontend.recharge.agreement")),1),p(k,{variant:"link",class:"p-0",onClick:F},{default:_(()=>[b(" 《"+o(t(D).siteConfig?.agreement.paymentTitle||t(n)("marketing.frontend.recharge.payment"))+"》 ",1)]),_:1})]),r("div",Ne,[t(g)?(d(),i("div",je," ¥ "+o(t(g)?.sellPrice),1)):I("",!0),p(k,{color:"primary",size:"lg",disabled:!t(v)?.rechargeRule.length,loadingAuto:"",onClick:B},{default:_(()=>[b(o(t(n)("marketing.frontend.recharge.immediatelyPurchase")),1)]),_:1},8,["disabled"])])])])):(d(),i("div",Ge,[r("div",He,[p(f,{name:"i-lucide-lock",class:"text-primary mx-auto mb-4 text-4xl"}),r("h1",Xe,o(t(n)("marketing.frontend.recharge.notOpen")),1),r("p",qe,o(t(n)("marketing.frontend.recharge.notOpenTip")),1),p(k,{class:"mt-6",icon:"i-tabler-arrow-left",variant:"soft",onClick:a[1]||(a[1]=c=>s.$router.back())},{default:_(()=>[b(o(t(n)("marketing.frontend.recharge.back")),1)]),_:1})])]))])}}});export{mt as default};
