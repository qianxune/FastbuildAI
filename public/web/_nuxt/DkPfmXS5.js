import{d as C,i as $,av as V,k as D,n as f,l as h,h as n,G as P,_ as j,p as E,J as g,f as N,o as q}from"#entry";import{_ as G}from"./DBiaUVBh.js";import{_ as J}from"./CBTz8tdX.js";import{_ as z}from"./o4ws_w_T.js";import{_ as F}from"./Y67jy4iF.js";import{_ as H}from"./JxyxsHxp.js";import{u as O}from"./BlyoSzaa.js";import{u as Q}from"./CxvgZo8z.js";import"./DMoqg0Fd.js";import"./CtosDvS0.js";import"./kRIii9yh.js";import"./DNSLGqNg.js";import"./Z7qkLoXK.js";import"./C6Y-ieo6.js";import"./BFo3vNrE.js";import"./DeCyaT7k.js";import"./D4e4FYoF.js";import"./BCcN9pii.js";import"./CMKSl-Ng.js";import"./CuVAPZQ8.js";import"./psimjGaX.js";import"./B3rWqoNg.js";import"./EK7Wbu3-.js";import"./CjasYwqF.js";import"./CAQVAH0V.js";import"./DBEJUH-Z.js";import"./Deu6qIfg.js";import"./D9sX2Qi6.js";const we=C({__name:"user-list",props:{usersList:{default:()=>[]},selectedUsers:{default:()=>new Set}},emits:["update:selectedUsers","delete","editPower","adjustMembership"],setup(k,{emit:v}){const{t:s}=$(),{hasAccessByCodes:p}=O(),_=V(),l=k,i=v,S=P,d=G,A=J,U=j,w=z,b=F,u=D("table"),o=f(()=>({userNo:s("user.backend.list.userNo"),username:s("user.backend.list.username"),nickname:s("user.backend.list.nickname"),status:s("user.backend.list.status"),source:s("user.backend.list.source"),createdAt:s("user.backend.list.registerTime"),lastLoginAt:s("user.backend.list.lastLoginAt"),actions:s("user.backend.list.actions"),membershipLevel:s("user.backend.list.level"),endTime:s("user.backend.list.endTime")}));function y(e){switch(e){case 0:return{label:s("user.backend.source.console"),icon:"i-lucide-user-plus"};case 1:return{label:s("user.backend.source.phone"),icon:"i-lucide-smartphone"};case 2:return{label:s("user.backend.source.wechat"),icon:"i-lucide-message-circle"};case 3:return{label:s("user.backend.source.email"),icon:"i-lucide-mail"};case 4:return{label:s("user.backend.source.username"),icon:"i-lucide-user-check"};default:return{label:s("user.backend.source.unknown"),icon:"i-lucide-help-circle"}}}function L(e){switch(e){case 1:return{label:s("user.backend.status.active"),color:"success",icon:"i-lucide-check-circle"};case 0:return{label:s("user.backend.status.inactive"),color:"error",icon:"i-lucide-x-circle"};default:return{label:s("user.backend.status.unknown"),color:"warning",icon:"i-lucide-help-circle"}}}const R=e=>{const t=e===!0,a=new Set(l.selectedUsers);t?l.usersList.forEach(r=>{r.isRoot!==1&&a.add(r.id)}):l.usersList.forEach(r=>{a.delete(r.id)}),i("update:selectedUsers",a),g(()=>{if(u.value?.tableApi){const r=u.value.tableApi.getRowModel();r&&r.rows.forEach(c=>{c.original.isRoot!==1&&c.toggleSelected(t)})}})},x=(e,t)=>{if(e.isRoot!==1&&typeof t=="boolean"){const a=e.id,r=new Set(l.selectedUsers);t?r.add(a):r.delete(a),i("update:selectedUsers",r)}},T=h([{id:"select",header:()=>{const e=l.usersList.filter(c=>c.isRoot!==1),t=e.filter(c=>l.selectedUsers.has(c.id)).length,a=e.length>0&&t===e.length,r=t>0&&t<e.length;return n(b,{modelValue:r?"indeterminate":a,"onUpdate:modelValue":c=>{R(c)},"aria-label":"Select all"})},cell:({row:e})=>{const t=e.original.isRoot===1;return n(b,{modelValue:e.getIsSelected(),disabled:t,"onUpdate:modelValue":a=>{t||(e.toggleSelected(!!a),x(e.original,a))},"aria-label":"Select row"})}},{accessorKey:"userNo",header:o.value.userNo},{accessorKey:"nickname",header:o.value.nickname,cell:({row:e})=>n("div",{class:"flex items-center gap-2"},[n(S,{src:e.original.avatar}),e.original.nickname])},{accessorKey:"username",header:o.value.username},{accessorKey:"source",header:o.value.source,cell:({row:e})=>y(e.original.source).label},{accessorKey:"membershipLevel",header:o.value.membershipLevel,cell:({row:e})=>{const t=e.original.membershipLevel;return t?n("span",t.name):n("span","-")}},{accessorKey:"endTime",header:o.value.endTime,cell:({row:e})=>{const t=e.original.membershipLevel?.endTime;if(!t)return n("span","-");const a=new Date(t),r=new Date;return n("span",{class:"flex items-center flex-col gap-2"},[n(d,{datetime:t,mode:"datetime"}),a>r?"":n(w,{color:"error"},s("user.backend.expired"))])}},{accessorKey:"status",header:o.value.status,cell:({row:e})=>L(e.original.status).label},{accessorKey:"createdAt",header:o.value.createdAt,cell:({row:e})=>{const t=e.getValue("createdAt");return n("span",t?n(d,{datetime:t,mode:"datetime"}):"-")}},{accessorKey:"lastLoginAt",header:o.value.lastLoginAt,cell:({row:e})=>{const t=e.getValue("lastLoginAt");return n("span",t?n(d,{datetime:t,mode:"datetime"}):s("user.backend.neverLogin"))}},{accessorKey:"actions",header:o.value.actions,cell:({row:e})=>n(A,{items:K(e.original)},()=>n(U,{icon:"i-lucide-ellipsis-vertical",color:"neutral",variant:"ghost",class:"ml-auto"},()=>""))}]);function K(e){const t=[];return p(["users:update"])&&(t.push({label:s("user.backend.editProfile"),icon:"i-lucide-edit",onSelect:()=>_.push({path:Q("users:update"),query:{id:e.id}})}),t.push({label:s("user.backend.adjustBalance"),icon:"i-lucide-edit",onSelect:()=>i("editPower",e)}),t.push({label:s("user.backend.membership.adjustMembership"),icon:"i-lucide-edit",onSelect:()=>i("adjustMembership",e)})),p(["users:delete"])&&e.isRoot!==1&&t.push({label:s("user.backend.deleteUser"),icon:"i-lucide-trash-2",color:"error",onSelect:()=>i("delete",e)}),t}const I=h({left:[""],right:["actions"]}),M=f(()=>Array.from(l.selectedUsers));return E(M,e=>{if(!u.value?.tableApi)return;const t=new Set(e);g(()=>{const a=u.value?.tableApi.getRowModel();a&&a.rows.forEach(r=>{const c=r.original.id,m=t.has(c),B=r.getIsSelected();m!==B&&r.toggleSelected(m)})})},{immediate:!0}),(e,t)=>{const a=H;return q(),N(a,{ref_key:"table",ref:u,data:l.usersList,columns:T.value,"column-pinning":I.value,ui:{base:"table-fixed border-separate border-spacing-0",thead:"[&>tr]:bg-elevated/50 [&>tr]:after:content-none",tbody:"[&>tr]:last:[&>td]:border-b-0",th:"py-2 whitespace-nowrap first:rounded-l-lg last:rounded-r-lg border-y border-default first:border-l last:border-r",td:"border-b border-default",tr:"[&:has(>td[colspan])]:hidden"}},null,8,["data","columns","column-pinning"])}}});export{we as default};
