import{d as xe,av as ye,i as ke,aM as we,n as C,a2 as Ce,b2 as Se,b3 as Ue,s as $e,p as E,K as ze,q as De,c as p,o as d,x as t,t as s,g as e,_ as Ie,w as _,f as y,y as h,z as n,A as k,B as Ae,bb as Ve,F,E as R,aY as Be,C as je}from"#entry";import{_ as Ne}from"./CvI6s-qz.js";import{_ as Pe}from"./CBTz8tdX.js";import{_ as Le}from"./shdu-Ndv.js";import{_ as Ee}from"./Y67jy4iF.js";import{_ as Fe}from"./B3rWqoNg.js";import{_ as Re}from"./DQQ3dYHz.js";import Te from"./cd55qm53.js";import{_ as Me}from"./DbqqhwXM.js";import{_ as qe}from"./o4ws_w_T.js";import{_ as Ge}from"./bvMLy1sv.js";import{_ as Ke}from"./CWpJD8K1.js";import{_ as Oe}from"./Cie-o9Wa.js";import{_ as Qe}from"./DBiaUVBh.js";import{_ as Ye}from"./D4ebF709.js";import{a as Ze,f as He}from"./DUoaAyrs.js";import{l as Je,m as We,n as Xe,o as et}from"./gu2_Ts15.js";import{u as tt,a as ot,b as st}from"./yxr0PByv.js";import{u as at}from"./BlyoSzaa.js";import{u as nt}from"./ZDOPDbaX.js";import{u as lt}from"./B-cZF5FC.js";import"./CtosDvS0.js";import"./CAQVAH0V.js";import"./DNSLGqNg.js";import"./BFo3vNrE.js";import"./DeCyaT7k.js";import"./D4e4FYoF.js";import"./Z7qkLoXK.js";import"./BstbYvQo.js";import"./CuVAPZQ8.js";import"./DMoqg0Fd.js";import"./kRIii9yh.js";import"./C6Y-ieo6.js";import"./BCcN9pii.js";import"./CMKSl-Ng.js";import"./psimjGaX.js";import"./CjasYwqF.js";import"./DBEJUH-Z.js";import"./Deu6qIfg.js";import"./D9sX2Qi6.js";import"./EK7Wbu3-.js";import"./Dh3Mo9T6.js";import"./sTbVUDyT.js";import"./jsPNKUA0.js";import"./abPSHzII.js";import"./o0-e7Rye.js";import"./CSy6ZCzT.js";import"./BzLCLO6P.js";const it={class:"flex h-full w-full flex-col"},ct={class:"flex items-center justify-between gap-1 p-4"},dt={class:"flex w-full items-center"},rt={class:"flex items-center gap-2"},mt={class:"pl-4"},ut={class:"bg-background mb-2 flex w-full justify-between gap-4 p-4 pl-6"},pt={class:"flex items-center gap-3"},_t={class:"text-sm font-semibold"},ft={class:"flex items-center gap-2 md:ml-auto"},ht={key:0,class:"bg-background flex h-full items-center justify-center"},gt={class:"text-center"},bt={class:"text-muted-foreground text-sm"},vt={class:"flex h-full flex-1"},xt={class:"pt-3"},yt={class:"hover:bg-elevated/50 w-full rounded-lg p-3 transition-all duration-200"},kt={class:"mb-1 flex items-start justify-between"},wt={class:"flex items-center gap-2"},Ct={class:"flex items-center gap-1 text-xs font-medium"},St={class:"text-xs"},Ut={class:"flex items-center gap-2"},$t={class:"flex items-center gap-2"},zt={class:"mr-2 text-xs"},Dt={key:0,class:"p-4"},It={class:"mb-3 flex"},At={class:"grid gap-2"},Vt={key:0,class:"w-100 overflow-hidden px-6"},Bt={class:"mb-4"},jt={class:"text-foreground text-lg font-semibold"},Nt={key:0,class:"space-y-4"},Pt={class:"space-y-4"},Lt={class:"items-centsr flex gap-2"},Et={class:"text-foreground truncate font-medium"},Ft={class:"space-y-4 text-xs"},Rt={class:"flex justify-between"},Tt={class:"text-muted-foreground"},Mt={class:"text-foreground"},qt={class:"flex justify-between"},Gt={class:"text-muted-foreground"},Kt={class:"text-foreground"},Ot={class:"flex justify-between"},Qt={class:"text-muted-foreground"},Yt={class:"text-foreground"},Zt={class:"flex justify-between"},Ht={class:"text-muted-foreground"},Jt={class:"text-foreground"},Wt={class:"flex justify-between"},Xt={class:"text-muted-foreground"},eo={class:"text-foreground"},to={class:"flex items-center justify-between"},oo={class:"text-foreground text-xs font-medium"},so={class:"flex items-center gap-2"},ao={key:0,class:"text-muted-foreground text-sm"},no={key:0,class:"flex flex-col"},lo={class:"text-foreground text-xs font-medium"},io={class:"bg-muted mt-2 rounded-md p-3"},co={class:"text-error text-xs"},ro={class:"space-y-2"},mo={class:"bg-muted rounded-md p-2"},uo={class:"text-muted-foreground font-mono text-xs break-all"},po={key:1,class:"flex items-center justify-center py-8"},_o={class:"text-center"},fo={class:"text-muted-foreground text-sm"},ho={class:"flex items-center justify-end p-4"},us=xe({__name:"segments",async setup(go){let w,I;const S=ye(),{t:a}=ke(),{hasAccessByCodes:A}=at(),{params:T,query:M}=we(),U=C(()=>T.id),q=C({get:()=>M.documentId,set:l=>{S.replace({query:{documentId:l}}),r.documentId=l,u()}}),{deleteDocument:G,renameDocument:K}=tt(),{deleteSegments:O,createSegment:Q,editSegment:Y}=ot(),{data:$,refresh:Z}=([w,I]=Se(()=>Ue(()=>et(U.value),"$lh_gmRPt7Z")),w=await w,I(),w),r=Ce({keyword:"",documentId:q.value,datasetId:U.value,status:void 0}),v=$e(!0),{paging:c,getLists:u}=nt({fetchFun:Je,params:r}),{start:H,clear:J}=lt(async l=>{await u(),c.needPolling||l()},{interval:1e3});E(()=>c.needPolling,l=>{l?H():J()},{immediate:!0});const{selected:g,isAll:W,isIndeterminate:X,toggle:ee,toggleAll:te,clear:V}=st(C(()=>c?.items||[]),l=>l.id),b={processing:{label:a("console-common.processing"),color:"warning"},completed:{label:a("console-common.completed"),color:"success"},failed:{label:a("console-common.failed"),color:"error"},pending:{label:a("console-common.pending"),color:"neutral"}},oe=[{label:a("console-common.all"),value:void 0},{label:a("console-common.processing"),value:"processing"},{label:a("console-common.completed"),value:"completed"},{label:a("console-common.failed"),value:"failed"},{label:a("console-common.pending"),value:"pending"}];E(()=>[r.keyword,r.documentId,r.status],()=>{ze(()=>{c.page=1,u()},300)()},{deep:!1,immediate:!1});const B=async l=>{await O(l,u),V()},se=async()=>{await Q(r.documentId,u)},ae=async l=>{await Y(l,u)},ne=async()=>{await G(r.documentId,u),S.back()},le=async()=>{const l=$.value?.find(i=>i.id===r.documentId);await K(l,u),Z()};async function ie(l){await We(l.id,l.enabled?0:1),u()}async function j(l){await Xe(Array.from(g.value),l),V(),u()}const m=C(()=>$.value?.find(l=>l.id===r.documentId));return De(()=>u()),(l,i)=>{const f=Ie,ce=Ne,de=Pe,N=Le,P=Ee,re=Fe,me=Re,ue=Te,L=Me,z=Ae,pe=Ve,D=qe,_e=Ge,fe=Be,x=Ke,he=Oe,ge=Qe,be=Ye;return d(),p("div",it,[t("div",ct,[t("div",dt,[s(f,{variant:"ghost",color:"neutral",class:"rounded-full","leading-icon":"i-lucide-chevron-left",onClick:i[0]||(i[0]=o=>e(S).replace(`/console/datasets/${e(U)}/documents`))}),s(ce,{modelValue:e(r).documentId,"onUpdate:modelValue":i[1]||(i[1]=o=>e(r).documentId=o),items:e($)?.map(o=>({label:o.fileName,value:o.id}))||[],"label-key":"label","value-key":"value",variant:"none"},null,8,["modelValue","items"])]),t("div",rt,[s(f,{color:"primary",variant:"outline",icon:"i-lucide-plus",label:e(a)("ai-datasets.backend.segments.createSegment"),onClick:se},null,8,["label"]),s(de,{items:[e(A)(["ai-datasets-documents:rename"])?{label:e(a)("ai-datasets.backend.segments.rename"),icon:"i-lucide-pen-line",onClick:()=>{le()}}:null,e(A)(["ai-datasets-documents:delete"])?{label:e(a)("console-common.delete"),icon:"i-lucide-trash",color:"error",onSelect:()=>{ne()}}:null].filter(Boolean)},{default:_(()=>[s(f,{icon:"i-lucide-ellipsis-vertical",color:"primary",variant:"outline"})]),_:1},8,["items"])])]),t("div",mt,[s(N)]),t("div",ut,[t("div",pt,[s(P,{"model-value":e(W),indeterminate:e(X),"onUpdate:modelValue":e(te)},null,8,["model-value","indeterminate","onUpdate:modelValue"]),t("span",_t,n(e(c).total)+" "+n(e(a)("ai-datasets.backend.segments.segment")),1),e(g).size>0?(d(),y(f,{key:0,color:"error",variant:"subtle",label:e(a)("console-common.batchDelete"),icon:"i-heroicons-trash",onClick:i[2]||(i[2]=o=>B(Array.from(e(g))))},{trailing:_(()=>[s(re,null,{default:_(()=>[k(n(e(g).size),1)]),_:1})]),_:1},8,["label"])):h("",!0),e(g).size>0?(d(),y(f,{key:1,color:"success",variant:"subtle",label:e(a)("console-common.batchEnable"),icon:"i-heroicons-arrow-up-tray",onClick:i[3]||(i[3]=o=>j(1))},null,8,["label"])):h("",!0),e(g).size>0?(d(),y(f,{key:2,color:"error",variant:"subtle",label:e(a)("console-common.batchDisable"),icon:"i-heroicons-arrow-down-tray",onClick:i[4]||(i[4]=o=>j(0))},null,8,["label"])):h("",!0)]),t("div",ft,[s(me,{modelValue:e(r).status,"onUpdate:modelValue":i[5]||(i[5]=o=>e(r).status=o),items:oe,placeholder:e(a)("console-common.status"),class:"w-30","value-key":"value"},null,8,["modelValue","placeholder"]),s(ue,{modelValue:e(r).keyword,"onUpdate:modelValue":i[6]||(i[6]=o=>e(r).keyword=o),placeholder:e(a)("ai-datasets.backend.segments.searchPlaceholder"),class:"w-50",icon:"i-lucide-search"},null,8,["modelValue","placeholder"]),s(N,{orientation:"vertical",class:"h-5"}),s(L,{text:e(v)?e(a)("ai-datasets.backend.segments.expandAll"):e(a)("ai-datasets.backend.segments.collapseAll"),delayDuration:0},{default:_(()=>[s(f,{variant:"soft",icon:e(v)?"i-lucide-list-plus":"i-lucide-list-x",onClick:i[7]||(i[7]=o=>v.value=!e(v))},null,8,["icon"])]),_:1},8,["text"])])]),s(pe,null,{default:_(()=>[!e(c).loading&&e(c).items.length===0?(d(),p("div",ht,[t("div",gt,[s(z,{name:"i-lucide-file-text",class:"text-muted-foreground mx-auto mb-4 h-12 w-12"}),t("p",bt,n(e(a)("ai-datasets.backend.segments.noData")),1)])])):h("",!0)]),_:1}),t("div",vt,[s(he,{class:"table h-full w-full px-6"},{default:_(()=>[(d(!0),p(F,null,R(e(c).items,o=>(d(),p("div",{key:o.id,class:"group relative mb-2 flex items-stretch gap-4"},[t("div",xt,[s(P,{"model-value":e(g).has(o.id),"onUpdate:modelValue":()=>e(ee)(o.id)},null,8,["model-value","onUpdate:modelValue"])]),t("div",yt,[t("div",kt,[t("div",wt,[t("div",Ct,[s(z,{name:"i-lucide-grip",class:"size-3"}),k(" Chunks #"+n(o.chunkIndex+1),1)]),t("div",St,n(o.contentLength)+" character",1),o.status==="failed"?(d(),y(L,{key:0,text:o?.error,"delay-duration":0},{default:_(()=>[s(D,{color:b[o.status]?.color||"neutral",variant:"subtle",size:"sm"},{default:_(()=>[k(n(b[o.status]?.label||o.status),1)]),_:2},1032,["color"])]),_:2},1032,["text"])):(d(),y(D,{key:1,color:b[o.status]?.color||"neutral",variant:"subtle",size:"sm"},{default:_(()=>[k(n(b[o.status]?.label||o.status),1)]),_:2},1032,["color"]))]),t("div",Ut,[s(f,{icon:"i-lucide-pen-line",color:"neutral",variant:"ghost",size:"sm",class:"opacity-0 transition-opacity group-hover:opacity-100",onClick:ve=>ae(o)},null,8,["onClick"]),s(f,{icon:"i-lucide-trash",color:"error",variant:"ghost",size:"sm",class:"opacity-0 transition-opacity group-hover:opacity-100",onClick:ve=>B(o.id)},null,8,["onClick"]),s(_e,{class:"opacity-0 transition-opacity group-hover:opacity-100","model-value":o.enabled===1,color:"success","onUpdate:modelValue":()=>ie(o)},null,8,["model-value","onUpdate:modelValue"]),t("div",$t,[s(fe,{color:o.enabled===0?"error":"success",standalone:"",inset:""},{default:_(()=>[t("span",zt,n(o.enabled===0?e(a)("ai-datasets.backend.common.disabled"):e(a)("ai-datasets.backend.common.enabled")),1)]),_:2},1032,["color"])])])]),t("div",{class:je(["text-foreground text-xs leading-normal tracking-wide whitespace-pre-wrap",{"line-clamp-2":e(v)}])},n(o.content),3)])]))),128)),e(c).loading&&e(c).items.length===0?(d(),p("div",Dt,[(d(),p(F,null,R(20,o=>t("div",{key:o,class:"mb-6"},[t("div",It,[s(x,{class:"size-3"}),s(x,{class:"ml-1 h-3 w-12"}),s(x,{class:"ml-6 h-3 w-12"})]),t("div",At,[s(x,{class:"h-3 w-full"}),s(x,{class:"h-3 w-full"})])])),64))])):h("",!0)]),_:1}),e(c).items.length?(d(),p("div",Vt,[t("div",Bt,[t("h3",jt,n(e(a)("ai-datasets.backend.documents.table.fileName")),1)]),e(m)?(d(),p("div",Nt,[t("div",Pt,[t("div",Lt,[s(f,{icon:"i-lucide-file-text",color:"neutral",variant:"outline",size:"sm"}),t("span",Et,n(e(m).fileName),1)]),t("div",Ft,[t("div",Rt,[t("span",Tt,n(e(a)("ai-datasets.backend.documents.table.fileSize"))+":",1),t("span",Mt,n(("formatFileSize"in l?l.formatFileSize:e(Ze))(e(m).fileSize)),1)]),t("div",qt,[t("span",Gt,n(e(a)("ai-datasets.backend.documents.table.fileType"))+": ",1),t("span",Kt,n(e(m).fileType),1)]),t("div",Ot,[t("span",Qt,n(e(a)("ai-datasets.backend.documents.table.chunkCount"))+": ",1),t("span",Yt,n(e(m).chunkCount),1)]),t("div",Zt,[t("span",Ht,n(e(a)("ai-datasets.backend.documents.table.characterCount"))+": ",1),t("span",Jt,n(("formatCompactNumber"in l?l.formatCompactNumber:e(He))(e(m).characterCount)),1)]),t("div",Wt,[t("span",Xt,n(e(a)("ai-datasets.backend.documents.table.createdAt"))+": ",1),t("span",eo,[s(ge,{datetime:e(m).createdAt,mode:"datetime"},null,8,["datetime"])])])])]),t("div",to,[t("h4",oo,n(e(a)("console-common.status")),1),t("div",so,[s(D,{color:b[e(m).status]?.color||"neutral",variant:"subtle"},{default:_(()=>[k(n(b[e(m).status]?.label||e(m).status),1)]),_:1},8,["color"]),e(m).progress!==void 0?(d(),p("span",ao,n(e(m).progress)+"% ",1)):h("",!0)])]),e(m).error?(d(),p("div",no,[t("h4",lo,n(e(a)("console-common.error")),1),t("div",io,[t("p",co,n(e(m).error||"-"),1)])])):h("",!0),t("div",ro,[i[10]||(i[10]=t("h4",{class:"text-foreground text-xs font-medium"},"文档 ID",-1)),t("div",mo,[t("p",uo,n(e(m).id),1)])])])):(d(),p("div",po,[t("div",_o,[s(z,{name:"i-lucide-file-text",class:"text-muted-foreground mx-auto mb-2 h-8 w-8"}),t("p",fo,n(e(a)("console-common.noData")),1)])]))])):h("",!0)]),t("div",ho,[s(be,{page:e(c).page,"onUpdate:page":i[8]||(i[8]=o=>e(c).page=o),size:e(c).pageSize,"onUpdate:size":i[9]||(i[9]=o=>e(c).pageSize=o),total:e(c).total,onChange:e(u)},null,8,["page","size","total","onChange"])])])}}});export{us as default};
