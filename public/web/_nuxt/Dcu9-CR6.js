const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Crk5Dp68.js","./Cgyg1gJC.js","./4jjeIyfe.js","./D_3bTjYR.js","./D9sX2Qi6.js","./BFbGFa2O.js","./CBTz8tdX.js","./DMoqg0Fd.js","./CtosDvS0.js","./kRIii9yh.js","./DNSLGqNg.js","./Z7qkLoXK.js","./C6Y-ieo6.js","./BFo3vNrE.js","./DeCyaT7k.js","./D4e4FYoF.js","./BCcN9pii.js","./CMKSl-Ng.js","./CuVAPZQ8.js","./psimjGaX.js","./B3rWqoNg.js","./EK7Wbu3-.js","./BjKIBNOf.js","./9Q2Y_nd6.js","./td2xDKru.js","./BMSQkwth.js","./DaWZu8wl.js","./bvMLy1sv.js","./CAQVAH0V.js","./Deu6qIfg.js","./DD8ySyt7.js","./Ghlq83yM.js","./DQMjdCEn.js","./OUYfsp1i.js","./CjE5iPSn.js","./D9UsdH-b.js","./MCK2d4XT.js","./Dm8J87dm.js","./D2M85Dwf.js","./FTderXKt.js"])))=>i.map(i=>d[i]);
import{d as P,at as E,i as T,V as N,k as O,aQ as G,n as H,aN as $,p as I,K as Q,q as W,c as X,o as J,x as g,t as i,g as e,w as m,_ as Y,h as l,B as Z,W as ee,X as ae}from"#entry";import{_ as te}from"./o4ws_w_T.js";import{_ as ne}from"./CBTz8tdX.js";import le from"./cd55qm53.js";import{_ as oe}from"./DBiaUVBh.js";import{_ as se}from"./B5gsc-Ax.js";import{_ as ie}from"./JxyxsHxp.js";import{_ as ce}from"./D4ebF709.js";import{b as re,c as de,d as ue}from"./Dm8J87dm.js";import{u as ge}from"./BlyoSzaa.js";import{u as pe}from"./ZDOPDbaX.js";const me={class:"flex h-full w-full flex-col"},be={class:"flex h-full flex-1 flex-col"},fe={class:"flex w-full justify-between gap-4 py-4 backdrop-blur-sm"},ve={class:"flex items-center gap-2"},he={class:"flex items-center gap-2 md:ml-auto"},we={class:"flex h-full flex-1 flex-col"},_e={class:"table h-full"},ke={class:"flex items-center justify-end gap-3 py-4"},xe={class:"flex items-center gap-1.5"},Ke=P({__name:"annotations",props:{agentId:{}},setup(j){const z=ee(()=>ae(()=>import("./Crk5Dp68.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39]),import.meta.url)),c=Y,b=te,f=ne,k=Z,U=le,V=oe,v=j,x=E(),{hasAccessByCodes:h}=ge(),{t:n}=T(),D=N(),w=O("table"),o=G({agentId:v.agentId,keyword:"",enabled:void 0,reviewStatus:void 0}),y=[{value:void 0,label:n("ai-agent.backend.logs.allStatus")},{value:"pending",label:n("ai-agent.backend.logs.pending")},{value:"approved",label:n("ai-agent.backend.logs.approved")},{value:"rejected",label:n("ai-agent.backend.logs.rejected")}],K=a=>{switch(a){case"pending":return{label:n("ai-agent.backend.logs.pending"),color:"warning"};case"approved":return{label:n("ai-agent.backend.logs.approved"),color:"success"};case"rejected":return{label:n("ai-agent.backend.logs.rejected"),color:"red"};default:return{label:n("ai-agent.backend.logs.unknown"),color:"neutral"}}},r=H(()=>({question:n("ai-agent.backend.logs.question"),answer:n("ai-agent.backend.logs.answer"),hitCount:n("ai-agent.backend.logs.hitCount"),enabled:n("ai-agent.backend.logs.enabled"),reviewStatus:n("ai-agent.backend.logs.reviewStatus"),reviewer:n("ai-agent.backend.logs.reviewer"),createdAt:n("ai-agent.backend.logs.createdAt"),actions:n("ai-agent.backend.logs.actions")})),{paging:d,getLists:u}=pe({fetchFun:re,params:o}),B=[{accessorKey:"question",header:()=>l("p",{class:""},`${r.value.question}`),cell:({row:a})=>l("div",{class:"flex items-start gap-3"},[l(k,{name:"i-lucide-help-circle",class:"text-primary size-5 mt-0.5 flex-none"}),l("p",{class:"font-medium text-highlighted line-clamp-2 max-w-sm",title:a.original.question},a.original.question)])},{accessorKey:"answer",header:()=>l("p",{class:""},`${r.value.answer}`),cell:({row:a})=>l("div",{class:"flex-1 grid"},[l("p",{class:"text-sm text-muted-foreground truncate",title:a.original.answer},a.original.answer)])},{accessorKey:"hitCount",header:()=>l("p",{class:"whitespace-nowrap"},`${r.value.hitCount}`),cell:({row:a})=>{const t=a.original.hitCount||0,p=t>10?"success":t>5?"warning":"neutral";return l("div",{class:"flex items-center justify-center flex-none"},l(b,{color:p,variant:"subtle"},()=>t.toString()))}},{accessorKey:"enabled",header:()=>l("p",{class:"whitespace-nowrap"},`${r.value.enabled}`),cell:({row:a})=>l("div",{class:"flex items-center justify-center flex-none"},l(b,{color:a.original.enabled?"success":"neutral",variant:"subtle"},()=>a.original.enabled?n("console-common.enabled"):n("console-common.disabled")))},{accessorKey:"reviewStatus",header:()=>l("p",{class:"whitespace-nowrap"},`${r.value.reviewStatus}`),cell:({row:a})=>{const t=K(a.original.reviewStatus);return l("div",{class:"flex items-center justify-center flex-none"},l(b,{color:t.color,variant:"subtle"},()=>t.label))}},{accessorKey:"reviewer",header:()=>l("p",{class:"whitespace-nowrap"},`${r.value.reviewer}`),cell:({row:a})=>{const t=a.original.reviewer;return t?l("div",{class:"flex items-center justify-center flex-none"},l("div",{class:"flex items-center gap-2"},[t.avatar?l("img",{src:t.avatar,class:"w-6 h-6 rounded-full",alt:t.nickname||t.username}):l(k,{name:"i-lucide-user",class:"w-6 h-6 text-muted-foreground"}),l("span",{class:"text-sm font-medium"},t.nickname||t.username)])):l("div",{class:"flex items-center flex-none"},l("span",{class:"text-muted-foreground text-sm"},n("ai-agent.backend.logs.unreviewed")))}},{accessorKey:"createdAt",header:({column:a})=>{const t=a.getIsSorted();return l(c,{color:"neutral",variant:"ghost",label:r.value.createdAt,icon:t?t==="asc"?"i-lucide-arrow-up-narrow-wide":"i-lucide-arrow-down-wide-narrow":"i-lucide-arrow-up-down",class:"-mx-2.5",onClick:()=>a.toggleSorting(a.getIsSorted()==="asc")})},cell:({row:a})=>{const t=a.getValue("createdAt");return l(V,{datetime:t,mode:"datetime"})}},{accessorKey:"actions",header:()=>l("p",{class:"text-center"},`${r.value.actions}`),cell:({row:a})=>{const t=[];return h(["ai-agent-annotations:update"])&&t.push(l(c,{color:"neutral",variant:"ghost",size:"xs",icon:"i-lucide-edit",onClick:()=>F(a.original.id)})),a.original.reviewStatus==="pending"&&h(["ai-agent-annotations:review"])&&t.push(l(c,{color:"green",variant:"ghost",size:"xs",icon:"i-lucide-check",onClick:()=>S(a.original.id,"approved")}),l(c,{color:"red",variant:"ghost",size:"xs",icon:"i-lucide-x",onClick:()=>S(a.original.id,"rejected")})),h(["ai-agent-annotations:delete"])&&t.push(l(c,{color:"red",variant:"ghost",size:"xs",icon:"i-lucide-trash-2",onClick:()=>L(a.original.id)})),l("div",{class:"flex items-center justify-center gap-1"},t)}}],{lockFn:S}=$(async(a,t)=>{try{await de(a,{reviewStatus:t}),x.success(`${n("ai-agent.backend.logs.annotation")}${n(t==="approved"?"ai-agent.backend.logs.approved":"ai-agent.backend.logs.rejected")}${n("ai-agent.backend.logs.success")}`),u()}catch(p){console.error("审核标注失败:",p)}}),{lockFn:q}=$(async a=>{try{await ue(a),x.success(n("common.message.deleteSuccess")),u()}catch(t){console.error("删除标注失败:",t)}}),C=async(a=null)=>{await D.create(z).open({agentId:v.agentId,annotationId:a,hiddenStatus:!0}).result&&u()},R=()=>{C()},F=a=>{C(a)},L=a=>{q(a)};return I(()=>[o.keyword,o.enabled,o.reviewStatus],()=>{Q(()=>{d.page=1,u()},300)()},{deep:!0}),I(()=>v.agentId,a=>{o.agentId=a,d.page=1,u()}),W(()=>u()),(a,t)=>{const p=se,A=ie,M=ce;return J(),X("div",me,[g("div",be,[g("div",fe,[g("div",ve,[i(e(U),{modelValue:e(o).keyword,"onUpdate:modelValue":t[0]||(t[0]=s=>e(o).keyword=s),placeholder:e(n)("ai-agent.backend.logs.searchPlaceholder"),class:"w-80",icon:"i-lucide-search"},null,8,["modelValue","placeholder"]),i(e(f),{items:[{label:e(n)("ai-agent.backend.logs.allStatus"),type:"radio",checked:e(o).enabled===void 0,onSelect:()=>e(o).enabled=void 0},{label:e(n)("console-common.enabled"),type:"radio",checked:e(o).enabled===!0,onSelect:()=>e(o).enabled=!0},{label:e(n)("console-common.disabled"),type:"radio",checked:e(o).enabled===!1,onSelect:()=>e(o).enabled=!1}],content:{align:"start"}},{default:m(()=>[i(e(c),{label:e(o).enabled===void 0?e(n)("ai-agent.backend.logs.allStatus"):e(o).enabled?e(n)("console-common.enabled"):e(n)("console-common.disabled"),color:"neutral",variant:"outline","trailing-icon":"i-lucide-chevron-down"},null,8,["label"])]),_:1},8,["items"]),i(e(f),{items:y.map(s=>({label:s.label,type:"radio",checked:e(o).reviewStatus===s.value,onSelect:()=>e(o).reviewStatus=s.value})),content:{align:"start"}},{default:m(()=>[i(e(c),{label:y.find(s=>s.value===e(o).reviewStatus)?.label||e(n)("ai-agent.backend.logs.allStatus"),color:"neutral",variant:"outline","trailing-icon":"i-lucide-chevron-down"},null,8,["label"])]),_:1},8,["items"])]),g("div",he,[i(p,{codes:["ai-agent-annotations:create"]},{default:m(()=>[i(e(c),{label:e(n)("ai-agent.backend.logs.addAnnotation"),color:"primary",variant:"solid","leading-icon":"i-lucide-plus",onClick:R},null,8,["label"])]),_:1}),i(e(f),{items:e(w)?.tableApi?.getAllColumns().filter(s=>s.getCanHide()).map(s=>({label:e(r)[s.id]||s.columnDef.header,type:"checkbox",checked:s.getIsVisible(),onUpdateChecked(_){e(w)?.tableApi?.getColumn(s.id)?.toggleVisibility(!!_)},onSelect(_){_?.preventDefault()}})),content:{align:"end"}},{default:m(()=>[i(e(c),{label:e(n)("console-common.showColumns"),color:"neutral",variant:"outline","trailing-icon":"i-lucide-chevron-down"},null,8,["label"])]),_:1},8,["items"]),i(e(c),{label:e(n)("console-common.refresh"),color:"neutral",variant:"outline","leading-icon":"i-lucide-refresh-cw",onClick:e(u)},null,8,["label","onClick"])])]),g("div",we,[g("div",_e,[i(A,{loading:e(d).loading,data:e(d).items,columns:B,class:"h-full",ref_key:"table",ref:w,sticky:"",selectable:"",ui:{base:"table-fixed border-separate border-spacing-0",thead:"[&>tr]:bg-elevated/50 [&>tr]:after:content-none",tbody:"[&>tr]:last:[&>td]:border-b-0",th:"py-2 first:rounded-l-lg last:rounded-r-lg border-y border-default first:border-l last:border-r",td:"border-b border-default",tr:"hover:bg-elevated/50"}},null,8,["loading","data"])])]),g("div",ke,[g("div",xe,[i(M,{page:e(d).page,"onUpdate:page":t[1]||(t[1]=s=>e(d).page=s),size:e(d).pageSize,"onUpdate:size":t[2]||(t[2]=s=>e(d).pageSize=s),total:e(d).total,onChange:e(u)},null,8,["page","size","total","onChange"])])])])])}}});export{Ke as _};
