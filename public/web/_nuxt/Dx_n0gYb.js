import{_ as C}from"./DQQ3dYHz.js";import{_ as z}from"./D_3bTjYR.js";import{_ as B}from"./Co1Njv5N.js";import F from"./cd55qm53.js";import{d as S,i as q,at as D,aQ as N,s as R,n as y,q as A,f,o as v,w as l,t as m,y as k,x as j,g as e,A as u,z as i,_ as G}from"#entry";import{_ as P}from"./DD8ySyt7.js";import{_ as Q}from"./Ghlq83yM.js";import{g as Y}from"./B9ZIqvFb.js";import{d as E}from"./CnGIiRp6.js";import{c as H,e as J,b as U}from"./FTderXKt.js";import"./Dh3Mo9T6.js";import"./DNSLGqNg.js";import"./CuVAPZQ8.js";import"./BFo3vNrE.js";import"./sTbVUDyT.js";import"./CtosDvS0.js";import"./CAQVAH0V.js";import"./kRIii9yh.js";import"./D4e4FYoF.js";import"./CMKSl-Ng.js";import"./Deu6qIfg.js";import"./Z7qkLoXK.js";import"./D9sX2Qi6.js";import"./BCcN9pii.js";import"./DBEJUH-Z.js";import"./DQMjdCEn.js";import"./OUYfsp1i.js";import"./CjE5iPSn.js";import"./D9UsdH-b.js";import"./MCK2d4XT.js";import"./EK7Wbu3-.js";import"./DaWZu8wl.js";const K={class:"flex items-center gap-2"},W={class:"flex justify-end gap-2"},xe=S({__name:"adjust-membership",props:{user:{}},emits:["close"],setup(V,{emit:g}){const n=V,c=g,{t}=q(),d=D(),s=N({levelId:null,durationType:"custom",customValue:7,customUnit:"day"}),p=R([]),I=y(()=>H({levelId:U().nullable(),durationType:U().required(),customValue:J().when("durationType",{is:"custom",then:r=>r.required(t("user.backend.membership.adjust.validation.customDurationRequired")).min(1,t("user.backend.membership.adjust.validation.customDurationMin")),otherwise:r=>r.optional()}).nullable()})),w=y(()=>[{label:t("user.backend.membership.adjust.durationOptions.oneMonth"),value:"1"},{label:t("user.backend.membership.adjust.durationOptions.threeMonths"),value:"3"},{label:t("user.backend.membership.adjust.durationOptions.oneYear"),value:"12"},{label:t("user.backend.membership.adjust.durationOptions.forever"),value:"forever"},{label:t("user.backend.membership.adjust.durationOptions.custom"),value:"custom"}]),T=async()=>{try{const r=await Y();p.value=[{label:t("user.backend.membership.adjust.noLevel"),value:null},...r.filter(a=>a.status).map(a=>({label:a.name,value:a.id}))]}catch(r){console.error("Get level list failed:",r),d.error(t("user.backend.membership.adjust.messages.getLevelListFailed"))}},$=async()=>{try{if(!n.user?.id){d.error(t("user.backend.membership.adjust.messages.userIdMissing"));return}await E({userId:n.user.id,levelId:s.levelId,durationType:s.durationType,customValue:s.durationType==="custom"?s.customValue:void 0,customUnit:s.durationType==="custom"?s.customUnit:void 0}),d.success(t("user.backend.membership.adjust.messages.adjustSuccess")),c("close",!0)}catch(r){console.error("调整会员失败:",r),d.error(t("user.backend.membership.adjust.messages.adjustFailed"))}};return A(()=>{T(),n.user?.membershipLevel&&(s.levelId=n.user.membershipLevel.id)}),(r,a)=>{const h=C,b=z,L=B,x=F,_=G,M=P,O=Q;return v(),f(O,{title:e(t)("user.backend.membership.adjust.title"),ui:{content:"max-w-md overflow-y-auto h-fit"},onClose:a[5]||(a[5]=o=>c("close",!1))},{default:l(()=>[m(M,{state:e(s),schema:e(I),class:"space-y-4",onSubmit:$},{default:l(()=>[m(b,{label:e(t)("user.backend.membership.adjust.levelLabel"),name:"levelId"},{default:l(()=>[m(h,{modelValue:e(s).levelId,"onUpdate:modelValue":a[0]||(a[0]=o=>e(s).levelId=o),items:e(p),"value-key":"value",placeholder:e(t)("user.backend.membership.adjust.levelPlaceholder"),size:"lg",class:"w-full"},{default:l(()=>[u(i(e(p).find(o=>o.value===e(s).levelId)?.label||e(t)("user.backend.membership.adjust.levelPlaceholder")),1)]),item:l(({item:o})=>[u(i(o.label),1)]),_:1},8,["modelValue","items","placeholder"])]),_:1},8,["label"]),e(s).levelId?(v(),f(b,{key:0,label:e(t)("user.backend.membership.adjust.durationLabel"),name:"durationType"},{default:l(()=>[m(L,{modelValue:e(s).durationType,"onUpdate:modelValue":a[1]||(a[1]=o=>e(s).durationType=o),items:e(w),orientation:"horizontal",color:"primary",class:"flex-wrap"},null,8,["modelValue","items"])]),_:1},8,["label"])):k("",!0),e(s).levelId&&e(s).durationType==="custom"?(v(),f(b,{key:1,label:"",name:"customValue"},{default:l(()=>[j("div",K,[m(x,{modelValue:e(s).customValue,"onUpdate:modelValue":a[2]||(a[2]=o=>e(s).customValue=o),modelModifiers:{number:!0},type:"number",min:"1",size:"lg",class:"w-24"},null,8,["modelValue"]),m(h,{modelValue:e(s).customUnit,"onUpdate:modelValue":a[3]||(a[3]=o=>e(s).customUnit=o),items:[{label:e(t)("user.backend.membership.adjust.customUnit.day"),value:"day"},{label:e(t)("user.backend.membership.adjust.customUnit.month"),value:"month"},{label:e(t)("user.backend.membership.adjust.customUnit.year"),value:"year"}],"value-key":"value",size:"lg",class:"w-24"},{default:l(()=>[u(i(e(s).customUnit==="day"?e(t)("user.backend.membership.adjust.customUnit.day"):e(s).customUnit==="month"?e(t)("user.backend.membership.adjust.customUnit.month"):e(t)("user.backend.membership.adjust.customUnit.year")),1)]),item:l(({item:o})=>[u(i(o.label),1)]),_:1},8,["modelValue","items"])])]),_:1})):k("",!0),j("div",W,[m(_,{color:"neutral",variant:"soft",onClick:a[4]||(a[4]=o=>c("close",!1))},{default:l(()=>[u(i(e(t)("console-common.cancel")),1)]),_:1}),m(_,{color:"primary",type:"submit"},{default:l(()=>[u(i(e(t)("console-common.confirm")),1)]),_:1})])]),_:1},8,["state","schema"])]),_:1},8,["title"])}}});export{xe as default};
