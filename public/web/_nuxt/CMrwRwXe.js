import{aU as ee,b7 as L,aT as me,bn as fe,n as z,bg as R,f as k,o as a,w as C,y as g,t as y,g as f,r as M,C as b,m as E,d as S,i as H,c as d,x as n,B as U,z as c,F as A,E as O,A as N,bw as ge,bx as ve,G as te,P as he,j as _e,k as ae,aR as xe,R as ye,S as be,H as Z,ba as we,_ as ke,a0 as Ce,p as $e,q as ze,ai as Me,J as Te}from"#entry";import{_ as Ae}from"./5wIHoxV5.js";import{b as Oe,a as Se,C as Be}from"./gaGwb9HC.js";import{b as V}from"./DUoaAyrs.js";import{S as Ue}from"./shdu-Ndv.js";import{_ as qe}from"./CnxT3uvZ.js";import{_ as Ie}from"./DbqqhwXM.js";import{_ as Ne}from"./DBiaUVBh.js";const Re={slots:{root:"",content:"data-[state=open]:animate-[collapsible-down_200ms_ease-out] data-[state=closed]:animate-[collapsible-up_200ms_ease-out] overflow-hidden"}},P={__name:"Collapsible",props:{as:{type:null,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1},defaultOpen:{type:Boolean,required:!1},open:{type:Boolean,required:!1},disabled:{type:Boolean,required:!1},unmountOnHide:{type:Boolean,required:!1,default:!0}},emits:["update:open"],setup(i,{emit:t}){const l=i,_=t,p=ee(),m=L(),v=me(fe(l,"as","defaultOpen","open","disabled","unmountOnHide"),_),h=z(()=>R({extend:R(Re),...m.ui?.collapsible||{}})());return(r,$)=>(a(),k(f(Be),E(f(v),{class:h.value.root({class:[l.ui?.root,l.class]})}),{default:C(({open:o})=>[p.default?(a(),k(f(Oe),{key:0,"as-child":""},{default:C(()=>[M(r.$slots,"default",{open:o})]),_:2},1024)):g("",!0),y(f(Se),{class:b(h.value.content({class:l.ui?.content}))},{default:C(()=>[M(r.$slots,"content")]),_:3},8,["class"])]),_:3},16,["class"]))}},Ve={key:0,class:"bg-muted mb-2 rounded-lg p-2"},He={class:"flex cursor-pointer flex-row items-center gap-2 p-1 text-xs select-none"},De={class:"text-sm font-medium"},Le={key:0,class:"text-sm font-medium"},Ee={key:0,class:"text-muted-foreground rounded p-2 text-sm whitespace-pre-wrap"},Pe=S({__name:"reference-reasoning",props:{reasoning:{default:void 0},messageId:{default:void 0},isThinking:{type:Boolean,default:!1},defaultOpen:{type:Boolean,default:!1}},setup(i){const{t}=H(),l=i,_=z(()=>{if(l.reasoning?.duration)return V(l.reasoning.duration);if(l.reasoning?.startTime&&l.reasoning?.endTime){const p=l.reasoning.endTime-l.reasoning.startTime;return V(p)}return null});return(p,m)=>{const v=U,h=P;return i.reasoning?.content||i.isThinking?(a(),d("div",Ve,[y(h,{unmountOnHide:!1,class:"group","default-open":i.defaultOpen},{content:C(()=>[i.reasoning?.content?(a(),d("div",Ee,c(i.reasoning.content),1)):g("",!0)]),default:C(()=>[n("div",He,[y(v,{name:"i-lucide-atom",class:"text-primary size-4"}),n("div",De,c(i.isThinking?f(t)("common.chat.reasoning.thinking"):f(t)("common.chat.reasoning.completed")),1),f(_)?(a(),d("div",Le," ("+c(f(t)("common.chat.reasoning.duration"))+c(f(_))+") ",1)):g("",!0),y(v,{name:"i-lucide-chevron-down",class:"size-4 rotate-270 transition-transform duration-200 group-data-[state=open]:rotate-360"})])]),_:1},8,["default-open"])])):g("",!0)}}}),je={key:0,class:"bg-muted mb-2 rounded-lg p-2"},Fe={class:"flex w-full cursor-pointer flex-wrap items-center gap-2 text-xs select-none"},Je={class:"flex min-w-0 flex-1 flex-wrap items-center gap-2"},We={class:"shrink-0"},Ye=["title"],Ge={class:"text-md shrink-0"},Ke=["title"],Qe={class:"shrink-0"},Xe={key:1,class:"bg-secondary shrink-0 rounded px-2 py-1 text-xs"},Ze={class:"mt-3 space-y-3"},et={class:"bg-background rounded p-3"},tt={class:"text-foreground mb-2 text-xs font-medium"},at={class:"text-sm text-gray-800"},ot={class:"bg-background rounded p-3"},st={class:"text-foreground mb-2 text-xs font-medium"},rt={class:"text-muted-foreground flex flex-col gap-2 text-sm"},nt={class:"text-foreground font-bold"},lt=S({__name:"reference-knowledge",props:{references:{default:()=>[]}},setup(i){const{t}=H(),l={vector:t("common.datasets.retrieval.vector"),fullText:t("common.datasets.retrieval.fullText"),hybrid:t("common.datasets.retrieval.hybrid")};return(_,p)=>{const m=U,v=P;return i.references&&i.references.length>0?(a(),d("div",je,[(a(!0),d(A,null,O(i.references,(h,r)=>(a(),k(v,{class:"group",key:r,unmountOnHide:!1},{content:C(()=>[n("div",Ze,[n("div",et,[n("div",tt,c(f(t)("common.reference.request")),1),n("div",at,c(h?.userContent),1)]),n("div",ot,[n("div",st,c(f(t)("common.reference.response")),1),n("div",rt,[(a(!0),d(A,null,O(h?.chunks,($,o)=>(a(),d("div",{key:o},[n("span",nt," #chunk-"+c(o+1)+": ",1),N(" "+c($.content),1)]))),128))])])])]),default:C(()=>[n("div",Fe,[y(m,{name:"i-lucide-hammer",class:"text-primary size-4"}),n("div",Je,[n("div",We,c(f(t)("common.chat.knowledgeCall.start"))+" "+c(f(t)("common.chat.knowledgeCall.from")),1),n("div",{name:"knowledge",class:"bg-primary/15 text-primary max-w-[50vw] truncate rounded px-2 py-1 text-xs sm:max-w-[20rem]",title:h.datasetName},c(h.datasetName),9,Ye),n("div",Ge,c(f(t)("common.chat.knowledgeCall.call")),1),h.retrievalMode?(a(),d("div",{key:0,name:"knowledge",class:"bg-primary/15 text-primary max-w-[40vw] truncate rounded px-2 py-1 text-xs sm:max-w-[16rem]",title:l[h.retrievalMode]},c(l[h.retrievalMode]),9,Ke)):g("",!0),n("div",Qe,c(f(t)("common.chat.knowledgeCall.finished")),1),h.duration?(a(),d("div",Xe,c(f(t)("common.chat.toolCall.duration"))+" "+c(f(V)(h.duration)),1)):g("",!0)]),y(m,{name:"i-lucide-chevron-down",class:"ml-auto rotate-270 transition-transform duration-200 group-data-[state=open]:rotate-360"})])]),_:2},1024))),128))])):g("",!0)}}}),it={slots:{root:"flex gap-1.5",item:"group relative flex flex-1 gap-3",container:"relative flex items-center gap-1.5",indicator:"group-data-[state=completed]:text-inverted group-data-[state=active]:text-inverted text-muted",separator:"flex-1 rounded-full bg-elevated",wrapper:"w-full",date:"text-dimmed text-xs/5",title:"font-medium text-highlighted text-sm",description:"text-muted text-wrap text-sm"},variants:{orientation:{horizontal:{root:"flex-row w-full",item:"flex-col",separator:"h-0.5"},vertical:{root:"flex-col",container:"flex-col",separator:"w-0.5"}},color:{primary:{indicator:"group-data-[state=completed]:bg-primary group-data-[state=active]:bg-primary"},secondary:{indicator:"group-data-[state=completed]:bg-secondary group-data-[state=active]:bg-secondary"},success:{indicator:"group-data-[state=completed]:bg-success group-data-[state=active]:bg-success"},info:{indicator:"group-data-[state=completed]:bg-info group-data-[state=active]:bg-info"},warning:{indicator:"group-data-[state=completed]:bg-warning group-data-[state=active]:bg-warning"},error:{indicator:"group-data-[state=completed]:bg-error group-data-[state=active]:bg-error"},neutral:{indicator:"group-data-[state=completed]:bg-inverted group-data-[state=active]:bg-inverted"}},size:{"3xs":"","2xs":"",xs:"",sm:"",md:"",lg:"",xl:"","2xl":"","3xl":""},reverse:{true:""}},compoundVariants:[{color:"primary",reverse:!1,class:{separator:"group-data-[state=completed]:bg-primary"}},{color:"secondary",reverse:!1,class:{separator:"group-data-[state=completed]:bg-secondary"}},{color:"success",reverse:!1,class:{separator:"group-data-[state=completed]:bg-success"}},{color:"info",reverse:!1,class:{separator:"group-data-[state=completed]:bg-info"}},{color:"warning",reverse:!1,class:{separator:"group-data-[state=completed]:bg-warning"}},{color:"error",reverse:!1,class:{separator:"group-data-[state=completed]:bg-error"}},{color:"primary",reverse:!0,class:{separator:"group-data-[state=active]:bg-primary group-data-[state=completed]:bg-primary"}},{color:"secondary",reverse:!0,class:{separator:"group-data-[state=active]:bg-secondary group-data-[state=completed]:bg-secondary"}},{color:"success",reverse:!0,class:{separator:"group-data-[state=active]:bg-success group-data-[state=completed]:bg-success"}},{color:"info",reverse:!0,class:{separator:"group-data-[state=active]:bg-info group-data-[state=completed]:bg-info"}},{color:"warning",reverse:!0,class:{separator:"group-data-[state=active]:bg-warning group-data-[state=completed]:bg-warning"}},{color:"error",reverse:!0,class:{separator:"group-data-[state=active]:bg-error group-data-[state=completed]:bg-error"}},{color:"neutral",reverse:!1,class:{separator:"group-data-[state=completed]:bg-inverted"}},{color:"neutral",reverse:!0,class:{separator:"group-data-[state=active]:bg-inverted group-data-[state=completed]:bg-inverted"}},{orientation:"horizontal",size:"3xs",class:{wrapper:"pe-4.5"}},{orientation:"horizontal",size:"2xs",class:{wrapper:"pe-5"}},{orientation:"horizontal",size:"xs",class:{wrapper:"pe-5.5"}},{orientation:"horizontal",size:"sm",class:{wrapper:"pe-6"}},{orientation:"horizontal",size:"md",class:{wrapper:"pe-6.5"}},{orientation:"horizontal",size:"lg",class:{wrapper:"pe-7"}},{orientation:"horizontal",size:"xl",class:{wrapper:"pe-7.5"}},{orientation:"horizontal",size:"2xl",class:{wrapper:"pe-8"}},{orientation:"horizontal",size:"3xl",class:{wrapper:"pe-8.5"}},{orientation:"vertical",size:"3xs",class:{wrapper:"-mt-0.5 pb-4.5"}},{orientation:"vertical",size:"2xs",class:{wrapper:"pb-5"}},{orientation:"vertical",size:"xs",class:{wrapper:"mt-0.5 pb-5.5"}},{orientation:"vertical",size:"sm",class:{wrapper:"mt-1 pb-6"}},{orientation:"vertical",size:"md",class:{wrapper:"mt-1.5 pb-6.5"}},{orientation:"vertical",size:"lg",class:{wrapper:"mt-2 pb-7"}},{orientation:"vertical",size:"xl",class:{wrapper:"mt-2.5 pb-7.5"}},{orientation:"vertical",size:"2xl",class:{wrapper:"mt-3 pb-8"}},{orientation:"vertical",size:"3xl",class:{wrapper:"mt-3.5 pb-8.5"}}],defaultVariants:{size:"md",color:"primary"}},ct=["data-state"],ut={__name:"Timeline",props:ge({as:{type:null,required:!1},items:{type:Array,required:!0},size:{type:null,required:!1},color:{type:null,required:!1},orientation:{type:null,required:!1,default:"vertical"},defaultValue:{type:[String,Number],required:!1},reverse:{type:Boolean,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},{modelValue:{type:[String,Number]},modelModifiers:{}}),emits:["update:modelValue"],setup(i){const t=i,l=ee(),_=ve(i,"modelValue"),p=L(),m=z(()=>R({extend:R(it),...p.ui?.timeline||{}})({orientation:t.orientation,size:t.size,color:t.color,reverse:t.reverse})),v=z(()=>{const r=_.value??t.defaultValue;return typeof r=="string"?t.items.findIndex($=>$.value===r)??-1:t.reverse?r!=null?t.items.length-1-r:-1:r??-1});function h(r){if(v.value!==-1)return r===v.value?"active":t.reverse?r>v.value?"completed":void 0:r<v.value?"completed":void 0}return(r,$)=>(a(),k(f(he),{as:i.as,"data-orientation":i.orientation,class:b(m.value.root({class:[t.ui?.root,t.class]}))},{default:C(()=>[(a(!0),d(A,null,O(i.items,(o,w)=>(a(),d("div",{key:o.value??w,class:b(m.value.item({class:[t.ui?.item,o.ui?.item,o.class]})),"data-state":h(w)},[n("div",{class:b(m.value.container({class:[t.ui?.container,o.ui?.container]}))},[y(te,E({size:i.size,icon:o.icon},{ref_for:!0},typeof o.avatar=="object"?o.avatar:{},{class:m.value.indicator({class:[t.ui?.indicator,o.ui?.indicator]}),ui:{icon:"text-inherit",fallback:"text-inherit"}}),{default:C(()=>[M(r.$slots,o.slot?`${o.slot}-indicator`:"indicator",{item:o})]),_:2},1040,["size","icon","class"]),w<i.items.length-1?(a(),k(f(Ue),{key:0,class:b(m.value.separator({class:[t.ui?.separator,o.ui?.separator]})),orientation:t.orientation},null,8,["class","orientation"])):g("",!0)],2),n("div",{class:b(m.value.wrapper({class:[t.ui?.wrapper,o.ui?.wrapper]}))},[o.date?(a(),d("div",{key:0,class:b(m.value.date({class:[t.ui?.date,o.ui?.date]}))},[M(r.$slots,o.slot?`${o.slot}-date`:"date",{item:o},()=>[N(c(o.date),1)])],2)):g("",!0),o.title||l.title?(a(),d("div",{key:1,class:b(m.value.title({class:[t.ui?.title,o.ui?.title]}))},[M(r.$slots,o.slot?`${o.slot}-title`:"title",{item:o},()=>[N(c(o.title),1)])],2)):g("",!0),o.description||l.description?(a(),d("div",{key:2,class:b(m.value.description({class:[t.ui?.description,o.ui?.description]}))},[M(r.$slots,o.slot?`${o.slot}-description`:"description",{item:o},()=>[N(c(o.description),1)])],2)):g("",!0)],2)],10,ct))),128))]),_:3},8,["as","data-orientation","class"]))}},dt={key:0,class:"bg-muted mb-2 flex flex-col gap-1.5 rounded-lg p-2"},pt={class:"flex cursor-pointer flex-row items-center justify-between text-xs select-none"},mt={class:"flex flex-wrap items-center gap-2"},ft={name:"tools",class:"bg-primary/15 text-primary rounded px-2 py-1 text-xs"},gt={class:"text-md"},vt={name:"tools",class:"bg-primary/15 text-primary rounded px-2 py-1 text-xs"},ht={key:1,class:"bg-secondary rounded px-2 py-1 text-xs"},_t={key:0,class:"bg-background mt-3 rounded p-3"},xt={class:"text-foreground text-md mb-3 font-medium"},yt=S({__name:"reference-mcp-tool-call",props:{toolCalls:{default:()=>[]},messageId:{default:void 0}},setup(i){const{t}=H(),l=_=>{const p=[];return _?.input&&p.push({title:`${t("common.chat.toolCall.startCall")} ${_?.tool?.name}`,description:JSON.stringify(_.input),icon:"tabler:number-1"}),_?.output&&p.push({title:`${t("common.chat.toolCall.finishedCall")} ${_?.tool?.name}`,description:JSON.stringify(_.output),icon:"tabler:number-2"}),p};return(_,p)=>{const m=U,v=ut,h=P;return i.toolCalls&&i.toolCalls.length>0?(a(),d("div",dt,[(a(!0),d(A,null,O(i.toolCalls,(r,$)=>(a(),k(h,{unmountOnHide:!1,class:"group",key:$},{content:C(()=>[r&&r?.tool?(a(),d("div",_t,[n("div",xt,c(r?.tool?.name)+" "+c(f(t)("common.reference.callDetails")),1),y(v,{size:"xs","default-value":l(r).length,items:l(r),ui:{item:"w-[calc(100%-36px)]"}},null,8,["default-value","items"])])):g("",!0)]),default:C(()=>[n("div",pt,[n("div",mt,[!r?.output&&!r?.error?(a(),k(m,{key:0,name:"i-lucide-loader-2",class:"animate-spin"})):g("",!0),p[0]||(p[0]=n("svg",{class:"size-4",width:"195",height:"195",viewBox:"0 0 195 195",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[n("path",{d:"M25 97.8528L92.8823 29.9706C102.255 20.598 117.451 20.598 126.823 29.9706V29.9706C136.196 39.3431 136.196 54.5391 126.823 63.9117L75.5581 115.177",stroke:"currentColor","stroke-width":"12","stroke-linecap":"round"}),n("path",{d:"M76.2653 114.47L126.823 63.9117C136.196 54.5391 151.392 54.5391 160.765 63.9117L161.118 64.2652C170.491 73.6378 170.491 88.8338 161.118 98.2063L99.7248 159.6C96.6006 162.724 96.6006 167.789 99.7248 170.913L112.331 183.52",stroke:"currentColor","stroke-width":"12","stroke-linecap":"round"}),n("path",{d:"M109.853 46.9411L59.6482 97.1457C50.2757 106.518 50.2757 121.714 59.6482 131.087V131.087C69.0208 140.459 84.2168 140.459 93.5894 131.087L143.794 80.8822",stroke:"currentColor","stroke-width":"12","stroke-linecap":"round"})],-1)),n("div",null,c(!r.input&&!r.output?f(t)("common.chat.toolCall.start"):"")+" "+c(r.input&&!r.output?f(t)("common.chat.toolCall.calling"):"")+" "+c(f(t)("common.chat.toolCall.from")),1),n("div",ft,c(r?.mcpServer?.name),1),n("div",gt,c(f(t)("common.chat.toolCall.call")),1),n("div",vt,c(r?.tool?.name),1),n("div",null,c(r.input&&r.output?f(t)("common.chat.toolCall.finished"):""),1),r.duration?(a(),d("div",ht,c(f(t)("common.chat.toolCall.duration"))+c(f(V)(r.duration)),1)):g("",!0)]),y(m,{name:"i-lucide-chevron-down",class:"rotate-270 transition-transform duration-200 group-data-[state=open]:rotate-360"})])]),_:2},1024))),128))])):g("",!0)}}}),bt=S({__name:"chats-bubble",props:{type:{default:"system"},bubbleClass:{default:""},clickable:{type:Boolean},loading:{type:Boolean},timestamp:{}},setup(i){const t=i,l=L(),_=z(()=>{const p="rounded-lg text-sm max-w-full break-words";let m;return t.type==="user"?l.theme.blackAsPrimary||l.ui.colors.primary==="black"?m="bg-primary text-background px-4 py-3":m="bg-primary-400 text-background px-4 py-3":m="text-foreground",[p,m,t.bubbleClass]});return(p,m)=>(a(),d("div",{class:b(_.value)},[M(p.$slots,"default")],2))}}),wt=["data-role"],kt={key:0,class:"flex justify-end"},Ct={key:0,class:"bg-background flex items-center gap-2 rounded-lg"},$t={key:4,class:"flex items-center gap-2 px-4 text-red-500"},zt={class:"prose dark:prose-invert whitespace-pre-wrap"},Mt={key:6,class:"prose dark:prose-invert whitespace-pre-wrap"},Tt={key:0,class:"action flex items-center justify-between pl-4"},At={class:"flex items-center gap-1"},Ot={key:0,class:"text-muted text-xs"},St={key:1,class:"mt-1 flex items-center gap-2"},Pt=S({__name:"chats-messages",props:{messages:{default:()=>[]},assistant:{default:()=>({actions:[]})},error:{},spacingOffset:{default:0},scrollAreaHeight:{default:0}},emits:["file-preview"],setup(i,{emit:t}){const l=i,_=t,{t:p}=H(),{userInfo:m}=_e(),v=ae("lastUserMessageRef"),{height:h}=xe(v),r=ye(be.CHAT_WINDOW_STYLE,{default:()=>"conversation"}),$=z(()=>r.value==="conversation"),o=z(()=>["flex flex-col gap-4",l.spacingOffset>0?`pb-[${l.spacingOffset}px]`:""].filter(Boolean)),w=z(()=>[...l.messages]),B=z(()=>{const s=w.value;return s.length>0&&s[s.length-1]?.role!=="user"}),D=z(()=>{if(!B.value||!l.scrollAreaHeight)return 120;const s=h.value>0?h.value:80,u=l.scrollAreaHeight-s-60;return Math.max(u,120)}),oe=s=>s.role==="user"?m?.avatar||"":s.avatar||"",se=s=>({user:p("common.chat.messages.me"),assistant:s.model?.model||p("common.chat.messages.assistant")})[s.role]||p("common.chat.messages.unknown"),re=s=>!!(s.metadata?.reasoning&&!s.metadata.reasoning.endTime),T=s=>typeof s=="string"?s:Array.isArray(s)&&s.find(u=>u.type==="text")?.text||"",j=s=>Array.isArray(s)?s.filter(u=>u.type==="image_url"&&u.image_url).map(u=>({url:u.image_url?.url||"",detail:u.image_url?.detail})):[],F=s=>Array.isArray(s)?s.filter(u=>u.type==="video_url"&&u.video_url).map(u=>({url:u.video_url?.url||""})):[],J=s=>Array.isArray(s)?s.filter(u=>u.type==="input_audio"&&u.input_audio).map(u=>({url:u.input_audio?.data||"",format:u.input_audio?.format||"mp3"})):[],W=s=>Array.isArray(s)?s.filter(u=>u.type==="file_url"&&u.url&&u.name).map(u=>({name:u.name||"Unknown file",url:u.url||""})):[],ne=(s,u)=>{if(!s)return T(u.content)||p("common.chat.messages.sendFailed");if(typeof s=="string")return s||p("common.chat.messages.sendFailed");if(typeof s=="object"){let q="";try{q=JSON.parse(s.message).message}catch{}return q||s.message||s.content||T(u.content)||p("common.chat.messages.sendFailed")}return JSON.stringify(s)};return(s,u)=>{const q=te,Y=Ae,G=U,le=Pe,ie=lt,ce=yt,K=qe,ue=ke,de=Ie,Q=Ne,pe=bt,X=we("dompurify-html");return a(),d("div",{class:b(o.value)},[(a(!0),d(A,null,O(w.value,(e,I)=>(a(),d("div",{key:e.id,class:b(["flex w-full gap-3",{"flex-row-reverse":$.value&&e.role==="user"}]),"data-role":e.role,ref_for:!0,ref:e.role==="user"&&!f(h)?"lastUserMessageRef":void 0},[e.role==="user"||e.role==="assistant"&&e.avatar?(a(),d("div",{key:0,class:b(["flex-none",{"pt-2":e.role==="assistant"}])},[y(q,{src:oe(e),alt:se(e),size:"xl"},null,8,["src","alt"])],2)):g("",!0),n("div",{class:b(["flex min-w-0 flex-1 flex-col gap-2",$.value&&e.role==="user"?"items-end":"items-start"])},[e.role==="user"&&(W(e.content).length>0||j(e.content).length>0||F(e.content).length>0||J(e.content).length>0)?(a(),d("div",kt,[y(Y,{files:[...W(e.content).map(x=>({...x,mediaType:"file"})),...j(e.content).map(x=>({name:x.url.split("/").pop()||"image",url:x.url,mediaType:"image"})),...F(e.content).map(x=>({name:x.url.split("/").pop()||"video",url:x.url,mediaType:"video"})),...J(e.content).map(x=>({name:x.url.split("/").pop()||`audio.${x.format}`,url:x.url,mediaType:"audio"}))],"show-actions":!1,class:"max-w-[70%] justify-end",onView:u[0]||(u[0]=x=>_("file-preview",x))},null,8,["files"])])):g("",!0),y(pe,{type:e.role==="user"?"user":"system",style:Ce({minHeight:I===w.value.length-1&&e.role!=="user"?`${D.value}px`:"auto",maxWidth:e.role==="user"?"70%":"auto",width:e.role!=="user"?"100%":"auto"})},{default:C(()=>[n("div",{class:b(["rounded-lg",{"bg-background p-4":e.role==="assistant"}])},[e.status==="loading"&&!e.mcpToolCalls?.length&&!Object.keys(e.metadata||{}).length?(a(),d("div",Ct,[y(G,{name:"i-lucide-loader-2",class:"animate-spin"}),n("span",null,c(f(p)("common.chat.messages.thinking")),1)])):g("",!0),e.role==="assistant"&&e.metadata?.reasoning?.content?(a(),k(le,{reasoning:e.metadata.reasoning,"message-id":e.id,"is-thinking":!e.metadata.reasoning.endTime,"default-open":re(e),key:`reasoning-${e.id}-${JSON.stringify(e.metadata.reasoning)}`},null,8,["reasoning","message-id","is-thinking","default-open"])):g("",!0),e.metadata?.references&&e.metadata.references.length>0&&e.role==="assistant"?(a(),k(ie,{key:2,references:e.metadata.references},null,8,["references"])):g("",!0),e.role==="assistant"&&e.mcpToolCalls?.length?(a(),k(ce,{"tool-calls":e.mcpToolCalls,"message-id":e.id,key:`tool-${e.id}-${e.mcpToolCalls.map(x=>x.output)}`},null,8,["tool-calls","message-id"])):g("",!0),e.status==="failed"?(a(),d("div",$t,[y(G,{name:"i-lucide-alert-circle"}),n("span",null,c(ne(i.error,e)),1)])):e.role!=="user"?M(s.$slots,"content",{key:5,message:e,index:I},()=>[Z(n("div",zt,null,512),[[X,T(e.content)]])]):T(e.content)?Z((a(),d("div",Mt,null,512)),[[X,T(e.content)]]):g("",!0)],2),e.role==="assistant"&&i.assistant.actions?.length&&!["active","loading"].includes(e.status||"")?(a(),d("div",Tt,[n("div",At,[y(K,{content:T(e.content),size:"xs",color:"neutral",variant:"ghost"},null,8,["content"]),(a(!0),d(A,null,O(i.assistant.actions,x=>(a(),d(A,null,[x.show?g("",!0):(a(),k(de,{key:0,text:x.label,delay:100},{default:C(()=>[(a(),k(ue,{key:x.label,icon:x.icon,size:"xs",color:"neutral",variant:"ghost",class:"p-2",onClick:qt=>x.onClick?.(e,I)},null,8,["icon","onClick"]))]),_:2},1032,["text"]))],64))),256)),e.status!=="failed"?(a(),d("span",Ot,c(f(p)("ai-chat.frontend.messages.aiDisclaimer")),1)):g("",!0)]),e.createdAt?(a(),k(Q,{key:0,datetime:e.createdAt,mode:"datetime",class:"text-muted-foreground text-xs"},null,8,["datetime"])):g("",!0)])):g("",!0),M(s.$slots,"after-tools",{message:e,index:I})]),_:2},1032,["type","style"]),e.role==="user"?(a(),d("div",St,[e.createdAt?(a(),k(Q,{key:0,datetime:e.createdAt,mode:"datetime",class:"text-muted-foreground text-xs"},null,8,["datetime"])):g("",!0),y(K,{content:T(e.content),size:"xs",color:"neutral",variant:"ghost"},null,8,["content"])])):g("",!0)],2)],10,wt))),128))],2)}}}),Bt={class:"flex items-center justify-center gap-1 opacity-0"},Ut={class:"text-secondary-foreground ml-2 text-sm"},jt=S({inheritAttrs:!1,__name:"index",props:{loading:{type:Boolean,default:!1},hasMore:{type:Boolean,default:!0},threshold:{default:200},loadingText:{default:"Loading..."},contentClass:{}},emits:["loadMore"],setup(i,{emit:t}){const l=i,_=t;let p=null;const m=ae("loadingRef");let v=null;function h(o){if(!o)return null;let w=o.parentElement;for(;w;){const{overflow:B,overflowY:D}=getComputedStyle(w);if(["auto","scroll"].includes(B)||["auto","scroll"].includes(D))return w;w=w.parentElement}return document.documentElement}function r(){!window.IntersectionObserver||!m.value||!l.hasMore||l.loading||(v=new IntersectionObserver(o=>{o[0]?.isIntersecting&&_("loadMore")},{root:p,rootMargin:`${l.threshold}px`,threshold:0}),v.observe(m.value))}function $(){v&&(v.disconnect(),v=null),p?.scrollTop==0&&(p.scrollTop=1),Te(r)}return $e(()=>[l.loading,l.hasMore],()=>{$()}),ze(()=>{r(),p=h(m.value)}),Me(()=>{v?.disconnect(),v=null}),(o,w)=>{const B=U;return a(),d("div",E({class:"relative flex scale-y-[-1] flex-col items-center"},o.$attrs),[n("div",{class:b(["flex scale-y-[-1] flex-col-reverse",i.contentClass])},[M(o.$slots,"default")],2),!l.loading&&l.hasMore?(a(),d("div",{key:0,ref_key:"loadingRef",ref:m,class:"absolute bottom-0 z-[-1] flex h-screen w-full scale-y-[-1] items-center justify-center"},[n("div",Bt,[y(B,{name:"i-ph-spinner-gap-bold",size:"16",class:"text-secondary-foreground animate-spin"}),n("span",Ut,c(l.loadingText),1)])],512)):g("",!0)],16)}}});export{jt as _,Pt as a};
