const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CiVwig2f.js","./5wIHoxV5.js","./Cgyg1gJC.js","./o4ws_w_T.js","./DbqqhwXM.js","./DNSLGqNg.js","./psimjGaX.js","./CuVAPZQ8.js","./B3rWqoNg.js","./EK7Wbu3-.js","./RPflLnqr.js","./TrJvDfxI.js","./jsPNKUA0.js","./4jjeIyfe.js","./cd55qm53.js","./shdu-Ndv.js","./hsuWSsy6.js","./DMoqg0Fd.js","./CtosDvS0.js","./kRIii9yh.js","./Z7qkLoXK.js","./C6Y-ieo6.js","./BFo3vNrE.js","./DeCyaT7k.js","./D4e4FYoF.js","./BCcN9pii.js","./CMKSl-Ng.js","./D7VOTB3C.js","./fhkze2Jn.js","./9Q2Y_nd6.js","./td2xDKru.js","./CRu9at2N.js","./abPSHzII.js","./DGkLjulG.js"])))=>i.map(i=>d[i]);
import{d as A,aM as K,at as W,i as X,n as H,s as g,a2 as $,aN as Q,c as m,o as u,x as t,z as n,g as e,t as f,w as _,_ as G,v as R,A as p,D as J,W as E,F as M,E as I,f as Y,y as V,B as Z,X as N,aX as ee,h as l}from"#entry";import{_ as te}from"./Cie-o9Wa.js";import{_ as se}from"./o4ws_w_T.js";import{u as ae}from"./gu2_Ts15.js";import{u as j}from"./CSy6ZCzT.js";import"./jsPNKUA0.js";import"./abPSHzII.js";const oe={class:"flex h-full w-full flex-col px-6"},ne={class:"flex flex-col justify-center gap-1 pt-4"},le={class:"text-lg! font-bold"},ie={class:"text-muted-foreground text-sm"},re={class:"flex h-full min-h-0 gap-6 py-6"},ce={class:"flex h-full w-1/2 flex-col space-y-6"},de={class:"flex w-full items-center justify-between p-2"},ue={class:"text-muted-foreground text-sm"},me={class:"text-muted-foreground text-xs"},fe={class:"flex h-full min-h-0 flex-col"},_e={class:"mb-2 text-base font-medium"},he=["onClick"],pe={class:"min-w-0 flex-1"},xe={class:"mb-1 flex items-center justify-between"},ge={class:"flex items-center gap-2"},ve={class:"text-muted-foreground ml-2 text-xs"},be={class:"text-muted-foreground text-sm"},ye={class:"w-1/2 flex-none"},ke={class:"bg-muted flex h-full flex-col rounded-lg p-4"},we={class:"mb-4 text-base font-medium"},Ce={key:0,class:"text-muted-foreground flex flex-1 items-center justify-center py-8 text-center"},Te={key:1,class:"flex-1 space-y-4 overflow-auto"},$e={class:"space-y-3"},Re={class:"flex items-center justify-between"},Ee={class:"flex items-center gap-2"},Me={class:"text-sm font-medium"},Ie={class:"text-muted-foreground text-xs"},Ve={class:"flex items-center gap-2"},Ne={class:"text-muted-foreground line-clamp-2 text-sm leading-relaxed"},je={key:0,class:"text-muted-foreground border-default border-t pt-3 text-xs"},De={class:"font-medium"},Ue=A({__name:"test",setup(Fe){const D=E(()=>N(()=>import("./CiVwig2f.js").then(s=>s.c),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32]),import.meta.url)),F=E(()=>N(()=>import("./DGkLjulG.js"),__vite__mapDeps([33,2]),import.meta.url)),{params:L}=K(),k=W(),{t:a}=X(),q=H(()=>L.id),r=g(""),h=g(null),w=Z,C=te,x=g(!1),i=$({retrievalMode:"hybrid",strategy:"weighted_score",topK:3,scoreThreshold:.5,scoreThresholdEnabled:!1,weightConfig:{semanticWeight:.7,keywordWeight:.3},rerankConfig:{enabled:!1}}),v=g([]),B=()=>{const s=$({retrievalMode:i.retrievalMode,strategy:i.strategy,topK:i.topK,scoreThreshold:i.scoreThreshold,scoreThresholdEnabled:i.scoreThresholdEnabled,weightConfig:{...i.weightConfig},rerankConfig:{...i.rerankConfig}});j({title:a("ai-datasets.backend.retrieval.retrievalConfig"),content:ee({setup(){return()=>l("div",{class:"py-4"},[l(F,{modelValue:s,"onUpdate:modelValue":c=>{Object.assign(s,c)}})])}}),confirmText:a("console-common.confirm"),cancelText:a("console-common.cancel"),ui:{content:"!w-2xl"}}).then(()=>{Object.assign(i,s),x.value=!0})},{lockFn:b,isLock:T}=Q(async()=>{if(!r.value.trim()){k.error(a("ai-datasets.backend.test.placeholder"));return}const s=Date.now().toString(),c=new Date().toLocaleString();try{const d={query:r.value,retrievalConfig:x.value?i:void 0};h.value=await ae(q.value,d),v.value.unshift({id:s,query:r.value,timestamp:c,success:!0}),k.success(a("ai-datasets.backend.test.success"))}catch(d){console.error("召回测试失败:",d),v.value.unshift({id:s,query:r.value,timestamp:c,success:!1,error:d instanceof Error?d.message:"未知错误"})}}),S=s=>{r.value=s.query,b()},z=s=>{switch(s){case"vector":return"i-heroicons-squares-2x2";case"fullText":return"i-heroicons-document-text";case"hybrid":return"i-heroicons-squares-2x2"}},O=s=>{switch(s){case"vector":return a("ai-datasets.backend.retrieval.vector");case"fullText":return a("ai-datasets.backend.retrieval.fullText");case"hybrid":return a("ai-datasets.backend.retrieval.hybrid")}};function P(s){j({title:`${a("ai-datasets.backend.segments.chunkDetail")} ${s.chunkIndex!==void 0?` #${s.chunkIndex}`:""}`,content:()=>l("div",{class:"space-y-3"},[l("div",{class:"flex items-center justify-between mb-2"},[l("span",{class:"inline-flex items-center"},[l(w,{name:"i-lucide-grip",class:"size-3 mr-1"}),l("span",{class:"text-sm font-medium"},`Chunks #${s.chunkIndex??"-"}`),l("span",{class:"text-muted-foreground text-xs ml-2"},`${s.contentLength??"-"} character`)]),l("span",{class:"inline-block bg-primary/10 text-primary rounded px-2 py-0.5 text-xs font-semibold"},`SCORE ${s.score?.toFixed(2)??"-"}`)]),l(C,{style:{height:"300px"},class:"rounded-lg border border-default bg-background mt-4",shadow:!1},[l("div",{class:"whitespace-pre-wrap text-sm p-2"},s.content)]),s.fileName?l("div",{class:"text-xs text-muted-foreground mt-2"},[l("span",{class:"font-medium"},`${a("ai-datasets.backend.segments.sourceFile")}:`),` ${s.fileName}`]):null]),ui:{content:"!w-3xl"}})}return(s,c)=>{const d=G,y=se;return u(),m("div",oe,[t("div",ne,[t("h1",le,n(e(a)("ai-datasets.backend.test.title")),1),t("p",ie,n(e(a)("ai-datasets.backend.test.description")),1)]),t("div",re,[t("div",ce,[f(e(D),{"is-loading":e(T),modelValue:e(r),"onUpdate:modelValue":c[0]||(c[0]=o=>J(r)?r.value=o:null),rows:6,placeholder:s.$t("ai-datasets.backend.test.placeholder"),onSubmit:e(b)},{"panel-top":_(()=>[t("div",de,[t("span",ue,n(e(a)("ai-datasets.backend.test.retrievalConfig")),1),f(d,{variant:"outline",size:"sm",icon:z(e(x)?e(i).retrievalMode:"hybrid"),onClick:B},{default:_(()=>[p(n(e(x)?O(e(i).retrievalMode):e(a)("ai-datasets.backend.retrieval.hybrid")),1)]),_:1},8,["icon"])])]),"panel-left":_(()=>[t("div",me,n(e(r).length)+" / 250",1)]),"panel-right":_(()=>[f(d,{loading:e(T),disabled:!e(r).trim(),color:"primary",size:"md",onClick:R(e(b),["stop"])},{default:_(()=>[p(n(e(a)("ai-datasets.backend.test.test")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1},8,["is-loading","modelValue","placeholder","onSubmit"]),t("div",fe,[t("h3",_e,n(e(a)("ai-datasets.backend.test.record")),1),f(e(C),{class:"grid h-full w-full",shadow:!1},{default:_(()=>[(u(!0),m(M,null,I(e(v).slice(0,10),o=>(u(),m("div",{key:o.id,class:"hover:bg-muted/50 mb-2 flex w-full cursor-pointer items-center justify-between rounded-lg border p-3",onClick:U=>S(o)},[t("div",pe,[t("div",xe,[t("div",ge,[c[1]||(c[1]=t("span",{class:"text-sm font-medium"},"Retrieval Test",-1)),f(y,{color:o.success?"success":"error",variant:"soft",size:"xs"},{default:_(()=>[p(n(o.success?e(a)("console-common.messages.success"):e(a)("console-common.messages.failed")),1)]),_:2},1032,["color"])]),t("div",ve,n(o.timestamp),1)]),t("div",be,n(o.success?o.query:o.error),1)])],8,he))),128))]),_:1})])]),t("div",ye,[t("div",ke,[t("h3",we,[p(n(e(h)?`${e(h).chunks.length} ${e(a)("ai-datasets.backend.test.recallParagraph")}`:e(a)("ai-datasets.backend.test.recallResult"))+" ",1),e(h)?.totalTime?(u(),Y(y,{key:0,label:`${e(h)?.totalTime}ms`,color:"primary",variant:"soft"},null,8,["label"])):V("",!0)]),e(h)?(u(),m("div",Te,[t("div",$e,[(u(!0),m(M,null,I(e(h).chunks,o=>(u(),m("div",{key:o.id,class:"bg-background space-y-3 rounded-lg p-4"},[t("div",Re,[t("div",Ee,[f(e(w),{name:"i-lucide-grip",class:"size-3"}),t("span",Me,"Chunks #"+n(o.chunkIndex),1),t("span",Ie,n(o.contentLength)+" character",1)]),t("div",Ve,[f(y,{label:`SCORE ${o.score?.toFixed(2)??"-"}`,color:"primary",variant:"soft"},null,8,["label"]),f(d,{variant:"ghost",size:"sm",icon:"i-lucide-external-link",onClick:R(U=>P(o),["stop"])},{default:_(()=>[p(n(e(a)("console-common.open")),1)]),_:1},8,["onClick"])])]),t("p",Ne,n(o.content),1),o?.fileName?(u(),m("div",je,[t("span",De,n(e(a)("ai-datasets.backend.segments.sourceFile"))+": ",1),p(" "+n(o.fileName),1)])):V("",!0)]))),128))])])):(u(),m("div",Ce,n(e(a)("ai-datasets.backend.test.tip")),1))])])])])}}});export{Ue as default};
