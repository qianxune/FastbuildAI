const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CpRnGpa1.js","./Cgyg1gJC.js","./cd55qm53.js","./D_3bTjYR.js","./D9sX2Qi6.js","./DO9M7gn1.js","./CtosDvS0.js","./CuVAPZQ8.js","./BCcN9pii.js","./CMKSl-Ng.js","./DBEJUH-Z.js","./o4ws_w_T.js","./Ghlq83yM.js","./DQMjdCEn.js","./OUYfsp1i.js","./BFo3vNrE.js","./Z7qkLoXK.js","./CjE5iPSn.js","./D9UsdH-b.js","./MCK2d4XT.js","./EK7Wbu3-.js","./CP6E7Hqt.js","./Co1Njv5N.js","./CAQVAH0V.js","./Deu6qIfg.js","./DD8ySyt7.js","./FTderXKt.js","./DaWZu8wl.js","./aFOgFV2-.js","./DBiaUVBh.js","./JxyxsHxp.js","./D4ebF709.js","./o0-e7Rye.js","./abPSHzII.js"])))=>i.map(i=>d[i]);
import{d as ie,aP as be,l as ve,s as B,k as he,n as z,p as Z,q as de,c as N,o as y,C as P,t,g as l,D,w as u,x as m,f as I,y as S,v as ae,B as ge,_ as ue,A as $,z as k,J as ke,i as we,at as ye,V as _e,aQ as xe,aN as Ve,az as $e,cm as Ce,W as ee,X as le}from"#entry";import{_ as ze}from"./Da83zglB.js";import{_ as Ue}from"./bvMLy1sv.js";import me from"./cd55qm53.js";import{_ as Te}from"./D_3bTjYR.js";import{_ as De}from"./DQQ3dYHz.js";import{_ as Ee}from"./shdu-Ndv.js";import{_ as Re}from"./Iv8N83fp.js";import{_ as ce}from"./CvI6s-qz.js";import{f as Ie,p as A,_ as Se,a as Fe,b as Pe,m as Ae}from"./C5Ha_WGa.js";import{_ as Be}from"./hsuWSsy6.js";import{a as te,e as Ne,$ as qe}from"./DMoqg0Fd.js";import{_ as Le}from"./DD8ySyt7.js";import{g as Me}from"./B9ZIqvFb.js";import{g as Oe,P as se,v as je}from"./C_EXknkZ.js";import{e as ne,b as E,c as re}from"./FTderXKt.js";import"./9Q2Y_nd6.js";import"./td2xDKru.js";import"./RPflLnqr.js";import"./TrJvDfxI.js";import"./jsPNKUA0.js";import"./abPSHzII.js";import"./D9sX2Qi6.js";import"./CAQVAH0V.js";import"./Deu6qIfg.js";import"./Dh3Mo9T6.js";import"./DNSLGqNg.js";import"./CuVAPZQ8.js";import"./BFo3vNrE.js";import"./sTbVUDyT.js";import"./CtosDvS0.js";import"./kRIii9yh.js";import"./D4e4FYoF.js";import"./CMKSl-Ng.js";import"./Z7qkLoXK.js";import"./DeCyaT7k.js";import"./BstbYvQo.js";import"./Cie-o9Wa.js";import"./MCK2d4XT.js";import"./EK7Wbu3-.js";import"./C6Y-ieo6.js";import"./BCcN9pii.js";import"./psimjGaX.js";import"./DaWZu8wl.js";const He={class:"mb-2 flex items-center justify-between"},Ye={class:"flex items-center space-x-2"},Ge={class:"flex items-center space-x-1"},Ke={key:0,class:"b mt-2 pt-2"},Je={class:"b mt-2 flex justify-between gap-2 pt-2"},Qe={class:"flex gap-2"},We=ie({__name:"index",props:{modelValue:{default:""},dateStyle:{default:"medium"},timeStyle:{default:"medium"},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},clearable:{type:Boolean,default:!0},size:{default:"md"},showTime:{type:Boolean,default:!1},timeFormat:{default:"HH:mm:ss"},defaultTime:{default:""},icon:{default:"i-lucide-calendar"},placement:{default:"bottom"},variant:{},color:{},ui:{}},emits:["update:modelValue","confirm","cancel","focus","blur","clear","open","close","change"],setup(i,{emit:q}){const{$i18n:L}=be(),{t:f,locale:M}=L,s=i,p=q,a=ve(!1),n=B(null),b=B(null),_=he("timePickerRef"),x=z(()=>n.value?n.value:new te(new Date().getFullYear(),new Date().getMonth()+1,new Date().getDate())),o=[{value:1,label:f("common.month.january")},{value:2,label:f("common.month.february")},{value:3,label:f("common.month.march")},{value:4,label:f("common.month.april")},{value:5,label:f("common.month.may")},{value:6,label:f("common.month.june")},{value:7,label:f("common.month.july")},{value:8,label:f("common.month.august")},{value:9,label:f("common.month.september")},{value:10,label:f("common.month.october")},{value:11,label:f("common.month.november")},{value:12,label:f("common.month.december")}],U=z({get:()=>x.value.month,set:e=>{n.value?n.value=n.value.set({month:e}):n.value=x.value.set({month:e})}}),T=z({get:()=>x.value.year,set:e=>{n.value?n.value=n.value.set({year:e}):n.value=x.value.set({year:e})}}),O=z(()=>{const e=new Date().getFullYear(),r=[];for(let w=e-100;w<=e+10;w++)r.push({value:w,label:`${w} year`});return r}),C=z(()=>Ie(s.modelValue,M.value,s.dateStyle,s.timeStyle,s.showTime)),R=()=>{if(n.value=Pe(s.modelValue),s.showTime){if(s.modelValue){const e=A(s.modelValue),r=new Ne("zh-CN",{dateStyle:void 0,timeStyle:s.timeStyle});b.value=r.format(e)}else if(s.defaultTime){const e=A(s.defaultTime);e&&(b.value=e,_.value&&_.value.setTime(e))}}},j=e=>{e?(p("open"),ke(()=>{R()})):p("close")},H=e=>{!s.disabled&&!s.readonly&&p("focus",e)},Y=e=>{p("blur",e)},G=e=>{e.stopPropagation(),n.value=null,b.value=null,p("update:modelValue",null),p("clear"),p("change",null),a.value=!1},F=()=>{a.value=!1;let e=b.value;s.showTime&&!e&&s.defaultTime&&(e=A(s.defaultTime));const r=Ae(n?.value?.toDate(qe()),e);p("update:modelValue",r),p("confirm",r),p("change",r)},K=()=>{a.value=!1,p("cancel"),p("change",null)},J=()=>{n.value?n.value=n.value.subtract({months:1}):n.value=x.value.subtract({months:1})},Q=()=>{n.value?n.value=n.value.add({months:1}):n.value=x.value.add({months:1})},c=()=>{const e=new Date;n.value=new te(e.getFullYear(),e.getMonth()+1,e.getDate()),s.showTime&&(b.value=new Date(e),_.value&&_.value.setTime(e)),F()};return Z(()=>s.modelValue,async e=>{e&&R()}),Z(()=>n.value,()=>{if(s.showTime&&n.value&&!b.value&&s.defaultTime){const e=A(s.defaultTime);e&&(b.value=e,_.value&&_.value.setTime(e))}}),Z(()=>a.value,e=>{j(e)},{immediate:!1}),de(R),(e,r)=>{const w=ge,v=ue,V=me,h=ce,W=Se,X=Be;return y(),N("div",{class:P(["bd-date-picker relative inline-flex w-full",[i.size,{"cursor-not-allowed opacity-60":i.disabled}]])},[t(X,{open:l(a),"onUpdate:open":r[6]||(r[6]=g=>D(a)?a.value=g:null),disabled:i.disabled||i.readonly,placement:i.placement,popper:{placement:i.placement,strategy:"fixed"},ui:{content:"w-auto"},"prevent-close":!0},{content:u(()=>[m("div",{class:"bd-date-picker-panel bg-default w-[320px] p-4",onClick:r[5]||(r[5]=ae(()=>{},["stop"]))},[m("div",He,[m("div",Ye,[t(h,{modelValue:l(T),"onUpdate:modelValue":r[1]||(r[1]=g=>D(T)?T.value=g:null),items:l(O),"option-attribute":"value",ui:{base:"min-w-[100px] py-1"},size:"sm"},null,8,["modelValue","items"]),t(h,{modelValue:l(U),"onUpdate:modelValue":r[2]||(r[2]=g=>D(U)?U.value=g:null),items:o,"option-attribute":"value",ui:{base:"min-w-[100px] py-1"},size:"sm"},null,8,["modelValue"])]),m("div",Ge,[t(v,{icon:"i-lucide-chevron-left",variant:"ghost",color:"neutral",size:"sm",padded:!1,onClick:J}),t(v,{icon:"i-lucide-chevron-right",variant:"ghost",color:"neutral",size:"sm",padded:!1,onClick:Q})])]),t(W,{modelValue:l(n),"onUpdate:modelValue":r[3]||(r[3]=g=>D(n)?n.value=g:null),"month-controls":!1,"year-controls":!1,color:"primary",size:"sm"},null,8,["modelValue"]),i.showTime?(y(),N("div",Ke,[t(Fe,{ref_key:"timePickerRef",ref:_,modelValue:l(b),"onUpdate:modelValue":r[4]||(r[4]=g=>D(b)?b.value=g:null),format:i.timeFormat,disabled:i.disabled,readonly:i.readonly,clearable:!1,size:"sm",ui:{root:"w-full"}},null,8,["modelValue","format","disabled","readonly"])])):S("",!0),m("div",Je,[m("div",null,[t(v,{size:"sm",variant:"soft",onClick:c},{default:u(()=>[$(k(l(f)("common.now")),1)]),_:1})]),m("div",Qe,[t(v,{size:"sm",variant:"ghost",icon:"i-lucide-x",onClick:K}),t(v,{size:"sm",icon:"i-lucide-check",disabled:!l(n)&&!i.disabled,onClick:F},null,8,["disabled"])])])])]),default:u(()=>[m("div",{class:P(["relative w-full",i.ui?.root])},[t(V,{modelValue:l(C),"onUpdate:modelValue":r[0]||(r[0]=g=>D(C)?C.value=g:null),placeholder:l(f)("common.placeholder.dateSelect"),disabled:i.disabled,readonly:!0,size:i.size,color:i.color,variant:i.variant,class:P({"cursor-default":i.readonly}),ui:{...i.ui,root:i.ui?.root||"w-full",base:`${l(a)?"ring-2 ring-inset ring-primary":""} text-left ${i.ui?.base}`},onFocus:H,onBlur:Y},{leading:u(()=>[t(w,{name:i.icon,class:P(l(C)?"text-highlighted":"text-dimmed")},null,8,["name","class"])]),trailing:u(()=>[i.clearable&&l(C)&&!i.disabled&&!i.readonly?(y(),I(v,{key:0,color:"neutral",variant:"ghost",icon:"i-lucide-x",padded:!1,size:"xs",onClick:ae(G,["stop"])})):S("",!0)]),_:1},8,["modelValue","placeholder","disabled","size","color","variant","class","ui"])],2)]),_:1},8,["open","disabled","placement","popper"])],2)}}}),Xe={class:"grid grid-cols-1 gap-8 p-1 lg:grid-cols-3"},Ze={class:"shadow-default h-fit rounded-lg lg:col-span-1"},el={class:"flex flex-col items-center space-y-4",style:{padding:"80px 24px 40px"}},ll={class:"border-default relative rounded-full border border-dashed p-2"},al={class:"mt-6 px-12 text-center text-xs"},ol={class:"text-muted-foreground"},tl={class:"mt-6 flex w-full items-center justify-between"},sl={class:"text-secondary-foreground text-sm font-medium"},nl={class:"text-muted-foreground mt-2 text-xs"},rl={key:0,class:"mt-4 w-full"},il={class:"shadow-default space-y-6 rounded-lg p-6 lg:col-span-2"},dl={class:"grid grid-cols-1 gap-6 md:grid-cols-2"},ul={class:"text-muted-foreground text-xs"},ml={class:"grid grid-cols-1 gap-6 md:grid-cols-2"},cl={class:"grid grid-cols-2 gap-6"},fl={class:"text-muted-foreground text-xs"},pl={class:"grid grid-cols-2 gap-6"},bl={class:"flex justify-end gap-4"},na=ie({__name:"user-form",props:{isEdit:{type:Boolean,default:!1},id:{default:null},initialData:{default:()=>({})}},emits:["submit-success","cancel","refresh"],setup(i,{emit:q}){const L=ee(()=>le(()=>import("./CpRnGpa1.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]),import.meta.url)),f=ee(()=>le(()=>import("./CP6E7Hqt.js"),__vite__mapDeps([21,2,1,3,4,22,6,23,8,9,24,10,7,25,12,13,14,15,16,17,18,19,20,26,27]),import.meta.url)),M=ee(()=>le(()=>import("./aFOgFV2-.js"),__vite__mapDeps([28,29,1,11,30,31,32,33,12,13,14,15,7,16,17,18,19,20]),import.meta.url)),s=i,p=q,{t:a}=we(),n=ye(),b=_e(),{userNo:_,...x}=s.initialData||{},o=xe({username:"",nickname:"",email:"",phone:"",phoneAreaCode:Oe(),avatar:"",password:"",roleId:void 0,status:1,source:0,level:"",levelEndTime:"",...x}),U=B([]),T=B([]),O=z(()=>se.map(c=>({label:`${c.flag} ${a(c.i18nKey)} +${c.areaCode}`,value:c.areaCode}))),C=z(()=>{const c={username:E().required(a("user.backend.form.usernameRequired")).matches(/^[a-zA-Z0-9_]*$/,a("user.backend.form.usernameFormat")),nickname:E().required(a("user.backend.form.nicknameRequired")),email:E().email(a("user.backend.form.emailFormat")).nullable(),phone:E().test("phone-format",a("user.backend.form.phoneFormat"),function(e){if(!e)return!0;const r=se.find(w=>w.areaCode===o.phoneAreaCode);return r?je(e,r.code):!1}).nullable(),phoneAreaCode:E().matches(/^\d{1,4}$/,a("user.backend.form.areaCodeFormat")).nullable(),status:ne().required(a("user.backend.form.statusRequired")),source:ne().required(a("user.backend.form.sourceRequired"))};return s.isEdit?re(c):re({...c,password:E().required(a("user.backend.form.passwordRequired")).min(6,a("user.backend.form.passwordMinLength"))})}),R=async()=>{try{const c=await Ce();U.value=[{label:a("user.backend.form.noRole"),value:"null"},...c.map(e=>({label:e.name,value:e.id}))]}catch(c){console.error("Get role list failed:",c),n.error(a("user.backend.form.getRoleListFailed"))}},j=async()=>{try{const c=await Me();T.value=[{label:"普通用户",value:null},...c.filter(e=>e.status).map(e=>({label:e.name,value:e.id}))]}catch(c){console.error("Get level list failed:",c),n.error("获取会员等级列表失败")}},H=()=>{Object.keys(o).forEach(c=>{const e=c;typeof o[e]=="string"?o[e]="":typeof o[e]=="number"&&(o[e]=c==="status"?1:0)}),n.info(a("user.backend.form.formReset"))},Y=async()=>{if(!s.id)return;await b.create(f).open({user:{id:s.id,power:o.power}}).result&&p("refresh")},G=async()=>{if(!s.id)return;await b.create(L).open({userid:s.id}).result},F=()=>{G()},{isLock:K,lockFn:J}=Ve(async()=>{try{o.roleId==="null"&&(o.roleId=void 0),p("submit-success",{...o})}catch(c){return console.error(a("user.backend.form.formValidationFailed")+":",c),!1}}),Q=()=>{if(!s.id)return;b.create(M).open({userId:s.id})};return de(()=>{R(),j()}),(c,e)=>{const r=ze,w=Ue,v=ue,V=me,h=Te,W=De,X=Ee,g=Re,oe=ce,fe=We,pe=Le;return y(),N("div",null,[t(pe,{state:l(o),schema:l(C),class:"space-y-8",onSubmit:l(J)},{default:u(()=>[m("div",Xe,[m("div",Ze,[m("div",el,[m("div",ll,[t(r,{modelValue:l(o).avatar,"onUpdate:modelValue":e[0]||(e[0]=d=>l(o).avatar=d),class:"bg-muted h-32 w-32 overflow-hidden rounded-full! border-none!",text:l(a)("user.backend.form.addAvatar"),icon:"i-lucide-camera",accept:".jpg,.png,.jpeg",maxCount:1,single:!0},null,8,["modelValue","text"])]),m("div",al,[m("p",ol,k(l(a)("user.backend.form.avatarFormats")),1)]),m("div",tl,[m("div",null,[m("h4",sl,k(l(a)("user.backend.form.statusLabel")),1),m("p",nl,k(l(a)("user.backend.form.statusHelp")),1)]),t(w,{"model-value":!!l(o).status,"unchecked-icon":"i-lucide-x","checked-icon":"i-lucide-check",size:"xl",onChange:e[1]||(e[1]=d=>l(o).status=l(o).status?0:1)},null,8,["model-value"])]),s.isEdit?(y(),N("div",rl,[t(h,{label:l(a)("user.backend.form.power"),name:"power"},{default:u(()=>[t(V,{modelValue:l(o).power,"onUpdate:modelValue":e[2]||(e[2]=d=>l(o).power=d),disabled:!0,variant:"subtle",size:"xl",class:"w-full",type:"number"},{trailing:u(()=>[t(v,{class:"cursor-pointer",color:"primary",variant:"link",size:"sm",icon:"i-lucide-edit","aria-label":"Clear input",onClick:Y})]),_:1},8,["modelValue"])]),_:1},8,["label"])])):S("",!0)])]),m("div",il,[m("div",dl,[t(h,{label:l(a)("user.backend.form.username"),name:"username",required:""},$e({default:u(()=>[t(V,{modelValue:l(o).username,"onUpdate:modelValue":e[3]||(e[3]=d=>l(o).username=d),placeholder:l(a)("user.backend.form.usernameInput"),size:"xl",disabled:s.isEdit,class:"w-full"},null,8,["modelValue","placeholder","disabled"])]),_:2},[s.isEdit?void 0:{name:"hint",fn:u(()=>[m("span",ul,k(l(a)("user.backend.form.usernameHelp")),1)]),key:"0"}]),1032,["label"]),t(h,{label:l(a)("user.backend.form.nickname"),name:"nickname",required:""},{default:u(()=>[t(V,{modelValue:l(o).nickname,"onUpdate:modelValue":e[4]||(e[4]=d=>l(o).nickname=d),placeholder:l(a)("user.backend.form.nicknameInput"),size:"xl",class:"w-full"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),m("div",ml,[t(h,{label:l(a)("user.backend.form.phone"),name:"phone"},{default:u(()=>[t(V,{modelValue:l(o).phone,"onUpdate:modelValue":e[7]||(e[7]=d=>l(o).phone=d),placeholder:l(a)("user.backend.form.phoneInput"),size:"xl",autocomplete:"off",ui:{root:"w-full",base:"!pl-28"}},{leading:u(()=>[m("div",{class:"flex items-center text-sm",onClick:e[6]||(e[6]=ae(()=>{},["stop","prevent"]))},[t(W,{modelValue:l(o).phoneAreaCode,"onUpdate:modelValue":e[5]||(e[5]=d=>l(o).phoneAreaCode=d),items:l(O),"trailing-icon":"heroicons:chevron-up-down-20-solid",class:"w-fit",size:"lg",ui:{base:"!ring-0",content:"z-999 w-64"},"value-key":"value"},{default:u(()=>[$(" + "+k(l(o).phoneAreaCode),1)]),item:u(({item:d})=>[$(k(d.label),1)]),_:1},8,["modelValue","items"])]),t(X,{class:"h-1/2",orientation:"vertical"})]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),t(h,{label:l(a)("user.backend.form.email"),name:"email"},{default:u(()=>[t(V,{modelValue:l(o).email,"onUpdate:modelValue":e[8]||(e[8]=d=>l(o).email=d),placeholder:l(a)("user.backend.form.emailInput"),size:"xl",type:"email",class:"w-full"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),m("div",cl,[s.isEdit?S("",!0):(y(),I(h,{key:0,label:l(a)("user.backend.form.password"),name:"password",required:""},{hint:u(()=>[m("span",fl,k(l(a)("user.backend.form.passwordHelp")),1)]),default:u(()=>[t(g,{modelValue:l(o).password,"onUpdate:modelValue":e[9]||(e[9]=d=>l(o).password=d),placeholder:l(a)("user.backend.form.passwordInput"),size:"xl",type:"password",class:"w-full"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])),t(h,{label:l(a)("user.backend.form.role"),name:"roleId"},{default:u(()=>[t(oe,{modelValue:l(o).roleId,"onUpdate:modelValue":e[10]||(e[10]=d=>l(o).roleId=d),"label-key":"label","value-key":"value",items:l(U),placeholder:l(a)("user.backend.form.roleSelect"),size:"xl",class:"w-full"},null,8,["modelValue","items","placeholder"])]),_:1},8,["label"]),t(h,{label:l(a)("user.backend.form.realName"),name:"realName"},{default:u(()=>[t(V,{modelValue:l(o).realName,"onUpdate:modelValue":e[11]||(e[11]=d=>l(o).realName=d),placeholder:l(a)("user.backend.form.realNameInput"),size:"xl",class:"w-full"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),m("div",pl,[t(h,{label:l(a)("user.backend.membership.level"),name:"level"},{default:u(()=>[t(oe,{modelValue:l(o).level,"onUpdate:modelValue":e[12]||(e[12]=d=>l(o).level=d),items:l(T),"label-key":"label","value-key":"value",placeholder:l(a)("user.backend.membership.normalUser"),size:"xl",class:"w-full",disabled:!0},null,8,["modelValue","items","placeholder"])]),_:1},8,["label"]),t(h,{label:l(a)("user.backend.membership.validity"),name:"levelEndTime"},{default:u(()=>[t(fe,{modelValue:l(o).levelEndTime,"onUpdate:modelValue":e[13]||(e[13]=d=>l(o).levelEndTime=d),"show-time":"",size:"xl",class:"w-full",ui:{root:"w-full"},disabled:!0},null,8,["modelValue"])]),_:1},8,["label"])]),m("div",bl,[t(v,{color:"neutral",variant:"outline",size:"lg",onClick:e[14]||(e[14]=d=>p("cancel")),class:"px-8"},{default:u(()=>[$(k(l(a)("console-common.cancel")),1)]),_:1}),s.id?(y(),I(v,{key:0,color:"neutral",variant:"outline",size:"lg",onClick:Q,class:"px-8"},{default:u(()=>[$(k(l(a)("user.backend.subscriptionRecords.title")),1)]),_:1})):S("",!0),s.id?(y(),I(v,{key:1,color:"neutral",size:"lg",onClick:F,class:"px-8"},{default:u(()=>[$(k(l(a)("user.backend.password.resetTab")),1)]),_:1})):(y(),I(v,{key:2,color:"neutral",size:"lg",onClick:H,class:"px-8"},{default:u(()=>[$(k(l(a)("console-common.reset")),1)]),_:1})),t(v,{color:"primary",size:"lg",loading:l(K),type:"submit",class:"px-8"},{default:u(()=>[$(k(s.isEdit?l(a)("console-common.update"):l(a)("console-common.create")),1)]),_:1},8,["loading"])])])])]),_:1},8,["state","schema","onSubmit"])])}}});export{na as default};
