import{_ as K}from"./DBiaUVBh.js";import{_ as C}from"./o4ws_w_T.js";import{d as $,i as D,at as I,l as b,a2 as N,n as V,h as a,q as j,f as y,o as i,w as A,c as f,y as M,x as c,t as g,A as P,B as F,z as d,g as r,bP as q}from"#entry";import{_ as E}from"./JxyxsHxp.js";import{_ as G}from"./D4ebF709.js";import{_ as O}from"./Ghlq83yM.js";import"./o0-e7Rye.js";import"./abPSHzII.js";import"./DQMjdCEn.js";import"./OUYfsp1i.js";import"./BFo3vNrE.js";import"./CuVAPZQ8.js";import"./Z7qkLoXK.js";import"./CjE5iPSn.js";import"./D9UsdH-b.js";import"./MCK2d4XT.js";import"./EK7Wbu3-.js";const H={key:0,class:"flex h-48 items-center justify-center"},J={class:"text-muted-foreground flex items-center gap-2 text-sm"},L={key:1,class:"flex h-48 items-center justify-center"},Q={class:"text-muted-foreground text-center"},W={key:3,class:"border-default bg-background sticky bottom-0 z-10 flex items-center justify-between gap-3 border-t py-4"},X={class:"text-muted text-sm"},Y={class:"flex items-center gap-1.5"},ve=$({__name:"user-subscription-records-modal",props:{userId:{}},setup(h,{expose:x}){const{t:s}=D(),k=h,R=I(),l=b(!0);x({open:()=>{l.value=!0},close:()=>{l.value=!1}});const u=b(!1),p=b([]),o=N({page:1,pageSize:10,total:0}),_=K,z=C,S=V(()=>[{accessorKey:"level",header:s("user.backend.subscriptionRecords.level"),cell:({row:e})=>{const t=e.original.level;return t?a("span",t.name):a("span","-")}},{accessorKey:"duration",header:s("user.backend.subscriptionRecords.duration"),cell:({row:e})=>{const t=e.original.duration;return a("span",t||"-")}},{accessorKey:"endTime",header:s("user.backend.subscriptionRecords.validity"),cell:({row:e})=>{const t=e.original.endTime;return t?a(_,{datetime:t,mode:"datetime"}):a("span","-")}},{accessorKey:"sourceDesc",header:s("user.backend.subscriptionRecords.source"),cell:({row:e})=>a("span",e.original.sourceDesc)},{accessorKey:"createdAt",header:s("user.backend.subscriptionRecords.recordTime"),cell:({row:e})=>a(_,{datetime:e.original.createdAt,mode:"datetime"})},{accessorKey:"refundStatus",header:s("user.backend.subscriptionRecords.refundStatus"),cell:({row:e})=>{const t=e.original.refundStatus,m=s(t===1?"user.backend.subscriptionRecords.refunded":"user.backend.subscriptionRecords.notRefunded");return a(z,{color:t===1?"warning":"neutral",variant:"soft"},()=>m)}}]),v=async()=>{u.value=!0;try{const e=await q(k.userId,{page:o.page,pageSize:o.pageSize});p.value=e.items,o.total=e.total}catch(e){console.error(s("user.backend.subscriptionRecords.loadFailed"),e),R.error(s("user.backend.subscriptionRecords.loadFailed"))}finally{u.value=!1}},w=()=>{v()};return j(()=>{v()}),(e,t)=>{const m=F,B=E,T=G,U=O;return i(),y(U,{open:l.value,"onUpdate:open":t[2]||(t[2]=n=>l.value=n),title:r(s)("user.backend.subscriptionRecords.title"),ui:{content:"max-w-4xl"},"show-footer":!1},{default:A(()=>[u.value&&p.value.length===0?(i(),f("div",H,[c("div",J,[g(m,{name:"i-lucide-loader-2",class:"size-4 animate-spin"}),P(" "+d(r(s)("user.backend.subscriptionRecords.loading")),1)])])):!u.value&&p.value.length===0?(i(),f("div",L,[c("div",Q,[g(m,{name:"i-lucide-inbox",class:"mx-auto mb-2 size-12"}),c("p",null,d(r(s)("user.backend.subscriptionRecords.empty")),1)])])):(i(),y(B,{key:2,data:p.value,columns:r(S),ui:{base:"table-fixed border-separate border-spacing-0",thead:"[&>tr]:bg-elevated/50 [&>tr]:after:content-none",tbody:"[&>tr]:last:[&>td]:border-b-0",th:"py-2 whitespace-nowrap first:rounded-l-lg last:rounded-r-lg border-y border-default first:border-l last:border-r",td:"border-b border-default",tr:"[&:has(>td[colspan])]:hidden"}},null,8,["data","columns"])),o.total>0?(i(),f("div",W,[c("div",X,d(r(s)("console-common.total"))+" "+d(o.total)+" "+d(r(s)("console-common.items")),1),c("div",Y,[g(T,{page:o.page,"onUpdate:page":t[0]||(t[0]=n=>o.page=n),size:o.pageSize,"onUpdate:size":t[1]||(t[1]=n=>o.pageSize=n),total:o.total,onChange:w},null,8,["page","size","total"])])])):M("",!0)]),_:1},8,["open","title"])}}});export{ve as default};
