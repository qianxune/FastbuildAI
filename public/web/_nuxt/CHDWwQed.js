const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BeSHkTur.js","./C_x_FjTj.js","./Cgyg1gJC.js","./Dh3Mo9T6.js","./DNSLGqNg.js","./CuVAPZQ8.js","./BFo3vNrE.js","./sTbVUDyT.js","./CtosDvS0.js","./CAQVAH0V.js","./kRIii9yh.js","./D4e4FYoF.js","./CMKSl-Ng.js","./Deu6qIfg.js","./C6Y-ieo6.js","./shdu-Ndv.js","./cd55qm53.js","./D_3bTjYR.js","./D9sX2Qi6.js","./Iv8N83fp.js","./DD8ySyt7.js","./u_h4lk84.js","./FTderXKt.js","./DaWZu8wl.js","./BzLCLO6P.js","./BaSWMwLN.js","./DrNYMppE.js","./abPSHzII.js","./B-cZF5FC.js","./5zyK1A70.js","./hsuWSsy6.js","./DMoqg0Fd.js","./Z7qkLoXK.js","./DeCyaT7k.js","./BCcN9pii.js","./psimjGaX.js","./BsmA9PJf.js","./CSy6ZCzT.js","./Bj2WLib9.js","./MWOdvIVj.js","./Y67jy4iF.js","./CjasYwqF.js","./DBEJUH-Z.js"])))=>i.map(i=>d[i]);
import{d as T,n as M,c as h,F as D,E as Y,o as i,f as L,y as C,x as l,z as w,aZ as G,s as ee,q as j,g as e,au as J,W as V,X as B,at as te,j as z,l as k,a2 as oe,aN as H,t as m,w as y,D as se,A as $,v as ne,_ as W,cK as ie,bV as le,a_ as K,ai as Q,C as ae,cL as re,B as ce,cM as ue,i as de,m as me}from"#entry";import{_ as X}from"./shdu-Ndv.js";import{L as pe}from"./BaSWMwLN.js";import{_ as ge}from"./C_x_FjTj.js";import _e from"./cd55qm53.js";import{_ as fe}from"./D_3bTjYR.js";import{_ as he}from"./DD8ySyt7.js";import{M as q}from"./u_h4lk84.js";import{c as ye,b as Z}from"./FTderXKt.js";import{s as be}from"./BzLCLO6P.js";import{u as ve}from"./B-cZF5FC.js";const R={BIND:"bind-login",SUCCESS:"success-login"},v={CODE_ERROR:-1,INVALID:0,NORMAL:1,SCANNED_CODE:2,LOGIN_FAIL:3,LOGIN_SUCCESS:4},xe={LOGIN:"YZMDL",BIND_MOBILE:"BDSJHM",CHANGE_MOBILE:"BGSJHM",FIND_PASSWORD:"ZHDLMM",REGISTER:"YZMZC"},F={ACCOUNT:1,WECHAT:3},Se={class:"footer-copyright flex items-center justify-center gap-4 py-4"},Ce=["href"],Le=T({__name:"footer-copyright",props:{copyright:{}},setup(U){const n=U,g=M(()=>n.copyright?Array.isArray(n.copyright)?n.copyright.filter(c=>c!=null&&c.url):typeof n.copyright=="object"&&n.copyright.url?[n.copyright]:[]:[]);return(c,_)=>{const p=G;return i(),h("footer",Se,[(i(!0),h(D,null,Y(g.value,s=>(i(),h("a",{key:s.url,class:"hover:text-primary-500 flex items-center gap-1 text-xs text-gray-500 transition-colors",href:s.url,target:"_blank",rel:"noopener noreferrer"},[s.iconUrl?(i(),L(p,{key:0,src:s.iconUrl,alt:s.displayName,class:"inline-block h-4 w-4 align-middle"},null,8,["src","alt"])):C("",!0),l("span",null,w(s.displayName),1)],8,Ce))),128))])}}}),we=T({__name:"account",emits:["success","update:showLoginMethods"],setup(U,{emit:n}){const g=V(()=>B(()=>import("./BeSHkTur.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]),import.meta.url)),c=V(()=>B(()=>import("./5zyK1A70.js"),__vite__mapDeps([29,2,16,17,18,19,30,31,8,10,4,32,14,6,33,11,34,12,5,35,20,22,23,36,37,15,25,26,27,1,3,7,9,13,21,24,28]),import.meta.url)),_=V(()=>B(()=>import("./Bj2WLib9.js"),__vite__mapDeps([38,2,16,17,18,19,30,31,8,10,4,32,14,6,33,11,34,12,5,35,20,22,23,36,37]),import.meta.url)),p=n,s=ee("account-login"),a={"account-login":c,"account-register":_,"account-forget":g};function f(d){s.value=d,p("update:showLoginMethods",d==="account-login")}function u(d){p("success",d)}return j(()=>{p("update:showLoginMethods",!0)}),(d,N)=>(i(),L(J(a[e(s)]),{key:e(s),onSuccess:u,onSwitchComponent:f},null,32))}}),ke={class:"p-8"},Ie={class:"mt-10"},Me=T({__name:"login-bind",emits:["updateStyle","update:showLoginMethods","success"],setup(U,{emit:n}){const g=n,c=te(),_=z(),p=k([{value:"中国大陆",label:"86"}]),s=k(p.value[0]),a=k({isCounting:!1,text:"获取验证码"}),f=ye({mobile:Z().min(8,"手机号不能少于11位").required("请输入手机号码"),code:Z().min(4,"验证码不能少于4位").required("请输入验证码")}),u=oe({mobile:"",code:""}),{lockFn:d,isLock:N}=H(async()=>{if(a.value.isCounting!==!0){a.value.text="正在发送中";try{await le({scene:xe.BIND_MOBILE,mobile:u.mobile}),c.success("验证码已发送，请注意查收",{title:"发送成功"}),a.value.isCounting=!0;let o=60;a.value.text=`${o}s`;const t=be(()=>{o--,a.value.text=`${o}s`,o===0&&(clearInterval(t),a.value.isCounting=!1,a.value.text="重新发送")},1e3)}catch{a.value.isCounting=!1,a.value.text="重新发送"}}}),{lockFn:x,isLock:O}=H(async()=>{try{await ie({type:"bind",...u}),g("success",{token:_.token,hasBind:!0})}catch(o){console.error("绑定失败:",o)}});return j(()=>{g("updateStyle",{width:"400px",height:"330px"}),g("update:showLoginMethods",!1)}),(o,t)=>{const r=ge,A=X,I=_e,E=fe,b=W,P=he;return i(),h("div",ke,[m(e(q),{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{type:"tween",stiffness:300,damping:30}},{default:y(()=>[...t[4]||(t[4]=[l("h2",{class:"mb-2 text-2xl font-bold"},"绑定手机号",-1),l("p",{class:"text-muted-foreground mb-2 text-sm"},"请输入手机号码，我们将向您发送验证码",-1)])]),_:1}),m(e(q),{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{type:"tween",stiffness:300,damping:30,delay:.4},class:"relative"},{default:y(()=>[m(P,{schema:e(f),state:e(u),onSubmit:e(x)},{default:y(()=>[m(E,{label:"手机号",name:"mobile",required:""},{default:y(()=>[m(I,{modelValue:e(u).mobile,"onUpdate:modelValue":t[2]||(t[2]=S=>e(u).mobile=S),class:"w-full",size:"lg",placeholder:"请输入手机号码",autocomplete:"off",ui:{base:"!pl-24"}},{leading:y(()=>[l("div",{class:"flex items-center text-sm",onClick:t[1]||(t[1]=ne(()=>{},["stop","prevent"]))},[t[5]||(t[5]=l("span",{class:"mr-[1px] pb-[1px]"},"+",-1)),m(r,{modelValue:e(s),"onUpdate:modelValue":t[0]||(t[0]=S=>se(s)?s.value=S:null),"trailing-icon":"heroicons:chevron-up-down-20-solid",ui:{base:"!ring-0",content:"z-999 w-34"},class:"w-16",items:e(p)},{item:y(({item:S})=>[$(w(S.value)+" +"+w(S.label),1)]),_:1},8,["modelValue","items"])]),m(A,{class:"h-1/2",orientation:"vertical"})]),_:1},8,["modelValue"])]),_:1}),m(E,{label:"验证码",name:"code",class:"mt-2",required:""},{default:y(()=>[m(I,{id:"code",modelValue:e(u).code,"onUpdate:modelValue":t[3]||(t[3]=S=>e(u).code=S),size:"lg",placeholder:"请输入验证码",autocomplete:"off",ui:{root:"w-full",trailing:"pr-0"}},{trailing:y(()=>[m(A,{class:"h-1/2",orientation:"vertical"}),m(b,{variant:"link",ui:{base:"w-[90px] justify-center"},disabled:e(N),onClick:e(d)},{default:y(()=>[$(w(e(a).text),1)]),_:1},8,["disabled","onClick"])]),_:1},8,["modelValue"])]),_:1}),l("div",Ie,[m(b,{color:"primary",type:"submit",size:"lg",ui:{base:"w-full justify-center"},loading:e(O)},{default:y(()=>[...t[6]||(t[6]=[$(" 立即绑定 ",-1)])]),_:1},8,["loading"])])]),_:1},8,["schema","state","onSubmit"])]),_:1})])}}}),Ne={class:"flex flex-col items-center justify-between"},Oe={class:"relative flex h-70 w-70 items-center justify-center overflow-hidden rounded-lg border p-1 dark:border-gray-700"},Ae={key:0,class:"h-70 w-70 animate-pulse rounded bg-gray-200 dark:bg-gray-700"},Ee={key:1,class:"absolute inset-0 z-30 flex flex-col items-center justify-center bg-white/40 backdrop-blur-sm dark:bg-gray-800/60"},Ue={key:2,class:"absolute inset-0 z-10 flex flex-col items-center justify-center bg-white/40 backdrop-blur-sm dark:bg-gray-800/60"},De={class:"mb-3 text-sm text-gray-700 dark:text-gray-300"},$e={class:"mt-2 mb-8 text-left"},Te=T({__name:"wechat",emits:["update:showLoginMethods","success"],setup(U,{emit:n}){const g=V(()=>B(()=>import("./MWOdvIVj.js"),__vite__mapDeps([39,2,40,41,9,42,5,12,34,8,13,18]),import.meta.url)),c=n,_=K(),p=z(),s=k(""),a=k(""),f=k(v.NORMAL),u=k(!1),d=M(()=>({[v.LOGIN_SUCCESS]:{icon:"i-lucide-check-circle",color:"text-green-500",message:"登录成功，正在跳转..."},[v.INVALID]:{icon:"i-lucide-alert-circle",color:"text-red-500",message:"二维码已过期，请刷新",showRefresh:!0},[v.LOGIN_FAIL]:{icon:"i-lucide-alert-circle",color:"text-red-500",message:"登录失败，请重试",showRefresh:!0},[v.CODE_ERROR]:{icon:"i-lucide-alert-circle",color:"text-red-500",message:"获取二维码失败，请重试",showRefresh:!0}})[f.value]||{message:"",icon:"",color:""}),{start:N,clear:x}=ve(async t=>{if(!a.value){t();return}try{const r=await ue({key:a.value});r.is_scan&&(f.value=v.LOGIN_SUCCESS,x(),o(r.user))}catch(r){console.error("检查登录状态失败:",r),x(),f.value=v.INVALID}},{interval:2e3,maxWaitTime:300*1e3,onEnded:()=>{f.value===v.NORMAL&&(f.value=v.INVALID)}});async function O(){try{u.value=!0,x(),f.value=v.NORMAL;const t=await re();s.value=t.url,a.value=t.key||"",N()}catch(t){console.error("获取微信二维码失败:",t),f.value=v.CODE_ERROR}finally{u.value=!1}}function o(t){c("success",t)}return j(()=>{c("update:showLoginMethods",!0),O()}),Q(x),(t,r)=>{const A=G,I=ce,E=W;return i(),h("div",Ne,[r[3]||(r[3]=l("p",{class:"text-muted-foreground mb-4 text-sm"},"请使用微信扫描二维码登录",-1)),l("div",Oe,[u.value?(i(),h("div",Ae)):(i(),h(D,{key:1},[s.value?(i(),L(A,{key:0,src:s.value,alt:"微信登录二维码",class:"pointer-events-none h-full w-full select-none"},null,8,["src"])):C("",!0),!e(p).isAgreed&&e(_).loginWay.loginAgreement&&e(_).loginSettings?.showPolicyAgreement?(i(),h("div",Ee,[m(I,{name:"i-lucide-alert-triangle",class:"mb-2 text-5xl text-yellow-500"}),r[1]||(r[1]=l("p",{class:"text-sm text-gray-700 dark:text-gray-300"},"请先阅读并勾选协议",-1))])):C("",!0),d.value.message?(i(),h("div",Ue,[m(I,{name:d.value.icon,class:ae([d.value.color,"mb-2 text-5xl"])},null,8,["name","class"]),l("p",De,w(d.value.message),1),d.value.showRefresh?(i(),L(E,{key:0,size:"xs",onClick:O},{default:y(()=>[...r[2]||(r[2]=[$(" 刷新二维码 ",-1)])]),_:1})):C("",!0)])):C("",!0)],64))]),l("div",$e,[e(_).loginSettings?.showPolicyAgreement?(i(),L(e(g),{key:0,modelValue:e(p).isAgreed,"onUpdate:modelValue":r[0]||(r[0]=b=>e(p).isAgreed=b)},null,8,["modelValue"])):C("",!0)])])}}}),Re={class:"login-container flex h-screen flex-col overflow-y-auto bg-[#f9f9f9] dark:bg-[#000]"},Ve={class:"fixed top-8 left-8 flex items-center"},Be={class:"ml-2 text-3xl font-bold"},je={class:"flex h-auto items-center justify-center pt-[15vh]"},Pe={class:"w-[370px] px-4"},Fe={class:"mb-8 space-y-3 text-center"},Ge={class:"text-3xl font-bold"},ze={class:"text-muted-foreground"},We={class:"flex flex-col justify-center gap-4"},He=T({__name:"index",setup(U){const n=K(),g=z(),{t:c}=de(),_=M(()=>({[F.ACCOUNT]:{component:we,icon:"tabler:lock",label:c("login.continueWithAccount")},[F.WECHAT]:{component:Te,icon:"tabler:brand-wechat",label:c("login.continueWithWechat")},[R.BIND]:{component:Me,icon:"",label:c("login.bindMobile")}})),p=n?.loginSettings?.defaultLoginMethod||F.ACCOUNT,s=k(p),a=k(!0),f=M(()=>Object.fromEntries(Object.entries(_.value).filter(([t])=>n?.loginSettings?.allowedLoginMethods.includes(Number(t))))),u=M(()=>Object.entries(f.value).filter(([o])=>o!==R.BIND&&o!==R.SUCCESS).map(([o,t])=>({name:o,...t}))),d=M(()=>_.value[s.value]?.component),N=M(()=>_.value[s.value]);function x(o){_.value[o]&&(s.value=o)}function O(o){if(n.loginWay.coerceMobile*1&&!o.hasBind&&!o.mobile){g.tempLogin(o.token),s.value=R.BIND;return}g.login(o.token)}return j(()=>{n.loginSettings||n.getLoginSettings()}),Q(()=>{g.isAgreed=!1}),(o,t)=>{const r=G,A=W,I=X,E=Le;return i(),h("div",Re,[l("h1",Ve,[e(n).siteConfig?.webinfo.logo?(i(),h(D,{key:0},[m(r,{src:e(n).siteConfig?.webinfo.logo,alt:"Logo",class:"size-12"},null,8,["src"]),l("span",Be,w(e(n).siteConfig?.webinfo.name),1)],64)):(i(),L(e(pe),{key:1,class:"text-foreground h-8",filled:"",fontControlled:!1}))]),l("div",je,[l("div",Pe,[l("div",Fe,[l("h1",Ge,w(e(c)("login.title")),1),l("p",ze,w(e(c)("login.subtitle")),1)]),l("div",We,[(i(!0),h(D,null,Y(e(u),(b,P)=>(i(),h(D,{key:P},[b.name!=e(s)?(i(),L(A,{key:0,"leading-icon":b.icon,variant:"outline",color:"neutral",size:"lg",ui:{base:"flex-1 justify-center bg-transparent p-3"},onClick:S=>x(b.name)},{default:y(()=>[$(w(b.label),1)]),_:2},1032,["leading-icon","onClick"])):C("",!0)],64))),128))]),e(u).length>1?(i(),L(I,{key:0,label:o.$t("login.orLoginTo"),ui:{root:"py-5",label:"text-xs text-foreground/60"}},null,8,["label"])):C("",!0),l("div",null,[e(d)?(i(),L(J(e(d)),me({key:0},e(N),{onSuccess:O,onSwitchTo:x,"onUpdate:showLoginMethods":t[0]||(t[0]=b=>a.value=b)}),null,16)):C("",!0)]),m(E,{copyright:e(n).siteConfig?.copyright},null,8,["copyright"])])])])}}}),nt=Object.freeze(Object.defineProperty({__proto__:null,default:He},Symbol.toStringTag,{value:"Module"}));export{F as L,xe as S,nt as i};
