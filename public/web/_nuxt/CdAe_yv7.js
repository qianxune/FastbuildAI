import{d as I,i as N,at as T,l as m,p as E,c as R,o as X,x as o,t as g,B as $,w as S,A as h,z as c,g as s,_ as A,C as U}from"#entry";import{u as P}from"./9Q2Y_nd6.js";import"./td2xDKru.js";const B={class:"flex flex-col items-center space-y-2"},j={class:"flex w-full items-center justify-center"},G={class:"text-muted-foreground text-sm"},M=["accept"],V={class:"text-muted-foreground mt-2 text-sm"},H=I({__name:"index",props:{fileList:{}},emits:["update:fileList"],setup(D,{emit:y}){const d=Object.freeze({PENDING:"pending",UPLOADING:"uploading",SUCCESS:"success",ERROR:"error"}),x=y,b=D,r=Object.freeze({maxSize:15,maxCount:10,supportedTypes:["TXT","MARKDOWN","DOCX","PDF","XLSX","XLS"],accept:".txt,.md,.docx,.pdf,.xlsx,.xls"}),{t:i}=N(),C=T(),v=m(),u=m(!1),l=m([]);E(()=>b.fileList,t=>{t&&t.length!==l.value.length&&(l.value=[...t])},{immediate:!0});const w=()=>`file_${Date.now()}_${Math.random().toString(36).slice(2)}`,z=t=>{const e=t.name.split(".").pop()?.toUpperCase()||"";return["TXT","MD","DOCX","PDF","XLSX","XLS"].includes(e)?t.size>r.maxSize*1024*1024?{valid:!1,error:i("ai-datasets.backend.create.file.fileTooLarge",{maxSize:r.maxSize})}:{valid:!0}:{valid:!1,error:i("ai-datasets.backend.create.file.unsupportedFileType",{ext:e})}},p=(t,e)=>{const a=l.value.find(n=>n.id===t);a&&Object.assign(a,e)},_=async t=>{if(l.value.length+t.length>r.maxCount)throw new Error(`最多只能上传 ${r.maxCount} 个文件`);const e=t.map(a=>{const{valid:n,error:f}=z(a);return n?{id:w(),file:a,status:d.PENDING,progress:0}:(C.warning(`${a.name}: ${f}`),null)}).filter(Boolean);l.value.push(...e),x("update:fileList",[...l.value]),await k(e)},k=async t=>{for(const e of t){if(!e.file||!e.id){console.warn("文件对象或ID缺失，跳过上传");continue}try{p(e.id,{status:d.UPLOADING,progress:0});const a=await P({file:e.file,description:"datasets files"},{onProgress:n=>{e.id&&p(e.id,{progress:n})}});p(e.id,{status:d.SUCCESS,progress:100,id:a.id,url:a.url,originalName:a.originalName,size:a.size,type:a.type,extension:a.extension})}catch(a){console.error(`上传失败: ${e.file.name}`,a),p(e.id,{status:d.ERROR,error:i("common.message.uploadFailed")})}}x("update:fileList",[...l.value])},F=t=>{const e=t.target,a=Array.from(e.files||[]);a.length&&_(a),e.value=""},L=t=>{t.preventDefault(),u.value=!1,_(Array.from(t.dataTransfer?.files||[]))},O=t=>{t.preventDefault(),u.value=!0};return(t,e)=>{const a=$,n=A;return X(),R("div",null,[o("div",{class:U(["bg-muted rounded-lg border border-dashed p-6 text-center transition-all duration-200",[s(u)?"border-primary bg-primary-50":"border-default hover:border-primary"]]),onDrop:L,onDragover:O,onDragleave:e[1]||(e[1]=f=>u.value=!1)},[o("div",B,[o("div",j,[g(a,{name:"i-heroicons-cloud-arrow-up",class:"text-muted-foreground size-6"}),g(n,{color:"neutral",variant:"link"},{default:S(()=>[h(c(s(i)("ai-datasets.backend.create.file.dragOrSelectFiles")),1)]),_:1}),g(n,{color:"primary",variant:"link",onClick:e[0]||(e[0]=f=>s(v)?.click())},{default:S(()=>[h(c(s(i)("ai-datasets.backend.create.file.chooseFile")),1)]),_:1})]),o("div",G,[o("p",null,c(s(i)("ai-datasets.backend.create.file.supportedTypes",{types:s(r).supportedTypes.join(", ")})),1),o("p",null,c(s(i)("ai-datasets.backend.create.file.fileSizeLimit",{maxSize:s(r).maxSize})),1)])]),o("input",{ref_key:"fileInputRef",ref:v,type:"file",multiple:"",class:"hidden",accept:s(r).accept,onChange:F},null,40,M)],34),o("div",V,c(s(i)("ai-datasets.backend.create.file.comingSoon")),1)])}}});export{H as default};
