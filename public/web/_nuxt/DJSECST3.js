import{d as M,i as R,at as j,j as L,l as v,n as w,aN as N,p as E,b_ as O,f as I,o as A,w as l,x as g,t,g as e,bD as y,v as _,_ as T,z as h,A as C,r as G,D as H}from"#entry";import J from"./cd55qm53.js";import{_ as Q}from"./D_3bTjYR.js";import{_ as W}from"./Ghlq83yM.js";import"./D9sX2Qi6.js";import"./DQMjdCEn.js";import"./OUYfsp1i.js";import"./BFo3vNrE.js";import"./CuVAPZQ8.js";import"./Z7qkLoXK.js";import"./CjE5iPSn.js";import"./D9UsdH-b.js";import"./MCK2d4XT.js";import"./EK7Wbu3-.js";const X={class:"space-y-4 py-2"},Y={class:"text-muted-foreground text-xs"},Z={class:"flex justify-end gap-2"},me=M({__name:"password-modal",props:{loading:{type:Boolean}},emits:["success"],setup($,{emit:U}){const q=$,z=U,{t:r}=R(),b=j(),B=L(),d=v(!1),o=v({oldPassword:"",newPassword:"",confirmPassword:""}),i=v({old:!1,new:!1,confirm:!1}),u=w(()=>{const s={};return o.value.oldPassword.trim()||(s.oldPassword=r("user.frontend.profile.oldPasswordRequired")),o.value.newPassword.trim()?o.value.newPassword.length<6&&(s.newPassword=r("user.frontend.profile.passwordMinLength")):s.newPassword=r("user.frontend.profile.newPasswordRequired"),o.value.confirmPassword.trim()?o.value.confirmPassword!==o.value.newPassword&&(s.confirmPassword=r("user.frontend.profile.passwordMismatch")):s.confirmPassword=r("user.frontend.profile.confirmPasswordRequired"),s}),x=w(()=>Object.keys(u.value).length>0),F=w(()=>!o.value.oldPassword.trim()&&!o.value.newPassword.trim()&&!o.value.confirmPassword.trim()),k=w(()=>S.value||q.loading===!0),K=w(()=>F.value||x.value||k.value);function V(){o.value={oldPassword:"",newPassword:"",confirmPassword:""},i.value={old:!1,new:!1,confirm:!1}}E(()=>d.value,s=>{s&&V()});const{lockFn:c,isLock:S}=N(async()=>{if(x.value){const s=Object.values(u.value)[0];b.warning(s);return}try{await O({oldPassword:o.value.oldPassword,newPassword:o.value.newPassword,confirmPassword:o.value.confirmPassword}),b.success(r("user.frontend.profile.passwordChangeSuccess")),z("success"),d.value=!1,B.logout(),V()}catch(s){throw console.error("修改密码失败:",s),s}});function m(s){i.value[s]=!i.value[s]}return(s,n)=>{const f=T,p=J,P=Q,D=W;return A(),I(D,{open:e(d),"onUpdate:open":n[7]||(n[7]=a=>H(d)?d.value=a:null),title:e(r)("user.frontend.profile.changePassword"),ui:{content:"max-w-md"},"show-footer":!0},{trigger:l(()=>[G(s.$slots,"default")]),footer:l(()=>[g("div",Z,[t(f,{variant:"soft",onClick:n[6]||(n[6]=a=>d.value=!1)},{default:l(()=>[C(h(e(r)("console-common.cancel")),1)]),_:1}),t(f,{disabled:e(K),color:"primary",loading:e(k),onClick:e(c)},{default:l(()=>[C(h(e(r)("console-common.save")),1)]),_:1},8,["disabled","loading","onClick"])])]),default:l(()=>[g("div",X,[t(P,{label:e(r)("user.frontend.profile.oldPassword"),size:"lg",required:"",error:e(u).oldPassword},{default:l(()=>[t(p,{modelValue:e(o).oldPassword,"onUpdate:modelValue":n[1]||(n[1]=a=>e(o).oldPassword=a),type:e(i).old?"text":"password",placeholder:e(r)("user.frontend.profile.oldPasswordPlaceholder"),ui:{root:"w-full"},onKeydown:y(_(e(c),["prevent"]),["enter"])},{trailing:l(()=>[t(f,{variant:"ghost",size:"xs",icon:e(i).old?"i-lucide-eye-off":"i-lucide-eye",onClick:n[0]||(n[0]=a=>m("old"))},null,8,["icon"])]),_:1},8,["modelValue","type","placeholder","onKeydown"])]),_:1},8,["label","error"]),t(P,{label:e(r)("user.frontend.profile.newPassword"),size:"lg",required:"",error:e(u).newPassword},{default:l(()=>[t(p,{modelValue:e(o).newPassword,"onUpdate:modelValue":n[3]||(n[3]=a=>e(o).newPassword=a),type:e(i).new?"text":"password",placeholder:e(r)("user.frontend.profile.newPasswordPlaceholder"),ui:{root:"w-full"},onKeydown:y(_(e(c),["prevent"]),["enter"])},{trailing:l(()=>[t(f,{variant:"ghost",size:"xs",icon:e(i).new?"i-lucide-eye-off":"i-lucide-eye",onClick:n[2]||(n[2]=a=>m("new"))},null,8,["icon"])]),_:1},8,["modelValue","type","placeholder","onKeydown"])]),_:1},8,["label","error"]),t(P,{label:e(r)("user.frontend.profile.confirmPassword"),size:"lg",required:"",error:e(u).confirmPassword},{default:l(()=>[t(p,{modelValue:e(o).confirmPassword,"onUpdate:modelValue":n[5]||(n[5]=a=>e(o).confirmPassword=a),type:e(i).confirm?"text":"password",placeholder:e(r)("user.frontend.profile.confirmPasswordPlaceholder"),ui:{root:"w-full"},onKeydown:y(_(e(c),["prevent"]),["enter"])},{trailing:l(()=>[t(f,{variant:"ghost",size:"xs",icon:e(i).confirm?"i-lucide-eye-off":"i-lucide-eye",onClick:n[4]||(n[4]=a=>m("confirm"))},null,8,["icon"])]),_:1},8,["modelValue","type","placeholder","onKeydown"])]),_:1},8,["label","error"]),g("div",Y,h(e(r)("user.frontend.profile.passwordRequirement")),1)])]),_:3},8,["open","title"])}}});export{me as default};
