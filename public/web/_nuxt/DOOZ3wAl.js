import{_ as re}from"./o4ws_w_T.js";import{d as ce,i as de,j as ue,s as M,k as me,l as O,n as z,p as fe,q as pe,f as p,o as n,w as f,t as h,_ as ve,m as he,v as H,g as t,x as a,y as _,c as g,z as m,A as D,B as _e,C as y,D as J,F as K,E as W,G as ge,T as ye,H as xe,I as be,J as we,K as ke}from"#entry";import Me from"./cd55qm53.js";import{_ as Se}from"./DbqqhwXM.js";import{_ as Be}from"./Cub7JM7Q.js";import{_ as Ce}from"./hsuWSsy6.js";import{_ as Ue}from"./Cie-o9Wa.js";import{a as Ve,b as Ie}from"./D7VOTB3C.js";import{a as Le}from"./B0g9CpkI.js";const ze={class:"flex min-w-0 flex-1 items-center gap-1"},Re={class:"inline-block w-12 truncate text-left sm:block sm:w-full"},$e={key:1,class:"flex flex-none items-center gap-1"},Te={class:"flex flex-none items-center gap-2"},Ae={class:"bg-background w-fit min-w-80 overflow-hidden rounded-lg shadow-lg"},De={class:"p-2"},Pe={key:0,class:"text-muted-foreground col-span-full py-10 text-center"},Ee={key:1,class:"text-muted-foreground col-span-full py-10 text-center"},je=["onClick"],qe={class:"flex flex-row items-center gap-2"},Fe={class:"text-secondary-foreground text-sm font-semibold"},Ge={class:"overflow-hidden"},Ne=["data-model-id","onClick"],Oe={class:"w-full overflow-hidden"},He={class:"flex items-start justify-between gap-2"},Je={class:"flex items-center gap-1.5"},Ke=["src"],We={key:0},Qe={key:0,class:"text-muted-foreground mt-0.5 line-clamp-1 text-xs"},it=ce({__name:"model-select",props:{modelValue:{},disabled:{type:Boolean},showDescription:{type:Boolean,default:!0},defaultSelected:{type:Boolean,default:!0},console:{type:Boolean,default:!1},supportedModelTypes:{},buttonUi:{},showBillingRule:{type:Boolean,default:!1},openLocalStorage:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(Q,{emit:X}){const i=Q,P=X,{t:v}=de(),Y=ue(),S=M(!1),x=M(!1),B=M(""),w=M([]),l=M(null),E=me("scrollAreaRef"),k=O({}),U=O(!1),j=M([]),q=z(()=>Y.userInfo?.membershipLevelId??null),V=z(()=>w.value.flatMap(e=>e.models??[])),R=z(()=>{const e=B.value.trim().toLowerCase();return e?w.value.map(s=>({...s,models:s.models?.filter(r=>[r.name,r.model,s.name,s.provider].some(d=>d.toLowerCase().includes(e)))})).filter(s=>s.models?.length):w.value});function F(e){return(e.membershipLevel?.length??0)>0}function C(e){return i.console||!F(e)?!0:q.value!==null&&(e.membershipLevel?.includes(q.value)??!1)}function I(e){return C(e)}function L(e){if(e.membershipLevel?.length)for(const s of e.membershipLevel){const r=j.value.find(d=>d.id===s);if(r?.icon)return r.icon}}function $(e){!i.console&&e&&!I(e)||(l.value=e,i.openLocalStorage&&localStorage.setItem("modelId",e?.id||""),P("update:modelValue",e?.id||""),P("change",e),x.value=!1,B.value="",T(e))}function Z(e){k.value[e]=!k.value[e]}function G(e){return k.value[e]??!1}function T(e){if(!e)return;const s=w.value.find(r=>r.models?.some(d=>d.id===e.id));s&&(k.value[s.id]=!0)}async function ee(){if(!S.value){S.value=!0;try{const[e,s,r]=await Promise.all([Ve({supportedModelTypes:i.supportedModelTypes}),Le().catch(()=>[]),Ie().catch(()=>null)]);w.value=e,j.value=s,w.value.forEach(u=>{u.id in k.value||(k.value[u.id]=!1)});const d=u=>V.value.find(A=>A.id===u);if(!i.defaultSelected){l.value=d(i.modelValue)??null,T(l.value);return}const b=i.console?V.value:V.value.filter(I);l.value=(i.openLocalStorage?b.find(u=>u.id===localStorage.getItem("modelId")):null)??b.find(u=>u.id===i.modelValue)??b.find(u=>u.id===r?.id)??b.find(u=>u.isDefault)??b[0]??null,l.value&&($(l.value),T(l.value))}catch(e){console.error("Failed to load models",e)}finally{S.value=!1}}}const te=z(()=>V.value.find(e=>e.id===i.modelValue)),oe=async()=>{if(!l.value||!x.value)return;await we();const e=document.querySelector(`[data-model-id="${l.value.id}"]`);e&&E.value&&e.scrollIntoView({behavior:"instant",block:"center"})};fe(x,e=>{e&&oe()});const se=ke(()=>{U.value=!1},200),le=()=>{U.value=!0,se()};return pe(ee),(e,s)=>{const r=re,d=_e,b=ve,u=Me,A=ge,ne=Se,ae=Be,N=Ce,ie=Ue;return n(),p(N,{open:t(x),"onUpdate:open":s[3]||(s[3]=c=>J(x)?x.value=c:null),disabled:i.disabled},{content:f(()=>[a("div",Ae,[a("div",De,[h(u,{modelValue:t(B),"onUpdate:modelValue":s[2]||(s[2]=c=>J(B)?B.value=c:null),placeholder:t(v)("common.placeholder.searchModel"),size:"lg",variant:"soft",ui:{root:"w-full"}},{leading:f(()=>[h(d,{name:"i-lucide-search"})]),_:1},8,["modelValue","placeholder"])]),a("div",{class:y(["flex h-[calc((100vh-15rem)/3)] flex-col gap-3 px-2 pt-1 pb-2",{"md:grid-cols-2":t(R).length>1}])},[h(ie,{ref_key:"scrollAreaRef",ref:E,class:"h-full",type:"hover",shadow:!1,onScroll:le},{default:f(()=>[t(S)?(n(),g("div",Pe,m(t(v)("common.loading"))+"... ",1)):t(R).length?_("",!0):(n(),g("div",Ee,m(t(v)("common.empty")),1)),(n(!0),g(K,null,W(t(R),c=>(n(),g("section",{key:c.id,class:"mb-2 space-y-2"},[a("div",{class:"hover:bg-muted/50 bg-background sticky top-0 z-10 flex cursor-pointer flex-row items-center justify-between rounded-md py-1 pr-2 backdrop-blur-sm transition-colors",onClick:o=>Z(c.id)},[a("div",qe,[h(d,{name:G(c.id)?"i-lucide-chevron-down":"i-lucide-chevron-right",class:"text-muted-foreground transition-transform",size:"sm"},null,8,["name"]),h(A,{src:c.iconUrl,alt:c.name,ui:{fallback:"text-inverted"},class:y(c.iconUrl?"":"bg-primary"),size:"2xs"},null,8,["src","alt","class"]),a("h3",Fe,m(c.name),1)]),h(r,{variant:"soft",color:"neutral",size:"sm"},{default:f(()=>[D(m(c.models?.length)+m(t(v)("common.unit.general.item"))+m(t(v)("common.ai.model")),1)]),_:2},1024)],8,je),h(ye,{"enter-active-class":"transition-all duration-200 ease-out","leave-active-class":"transition-all duration-200 ease-in","enter-from-class":"opacity-0 max-h-0","enter-to-class":"opacity-100 max-h-[2000px]","leave-from-class":"opacity-100 max-h-[2000px]","leave-to-class":"opacity-0 max-h-0"},{default:f(()=>[xe(a("ul",Ge,[(n(!0),g(K,null,W(c.models,o=>(n(),p(N,{key:o.id,mode:t(U)?void 0:"hover",disabled:t(U),content:{align:"center",side:"left",sideOffset:15}},{content:f(()=>[h(ae,{model:o,provider:c,"show-billing-rule":i.showBillingRule},null,8,["model","provider","show-billing-rule"])]),default:f(()=>[a("li",{"data-model-id":o.id,class:y(["group flex items-center justify-between gap-2 rounded-md px-2 py-1.5 ring-1 ring-transparent transition-colors",[I(o)?"cursor-pointer":"cursor-not-allowed opacity-50",t(l)?.id===o.id?"bg-primary/10 dark:bg-primary/20 hover:bg-primary/15 dark:hover:bg-primary/25":I(o)?"hover:bg-muted":""]]),onClick:Xe=>$(o)},[a("div",Oe,[a("div",He,[a("div",Je,[a("p",{class:y(["max-w-54 text-sm font-medium break-all whitespace-normal",t(l)?.id===o.id?"text-primary":"text-secondary-foreground"])},m(o.name),3),F(o)?(n(),p(ne,{key:0,text:C(o)?t(v)("common.membership.hasAccess"):t(v)("common.membership.required")},{default:f(()=>[L(o)?.startsWith("i-")?(n(),p(d,{key:0,name:L(o)??"i-lucide-crown",class:y(["h-3.5 w-3.5 shrink-0",C(o)?"text-amber-500":"text-muted-foreground"])},null,8,["name","class"])):L(o)?(n(),g("img",{key:1,src:L(o),class:y(["h-3.5 w-3.5 shrink-0",C(o)?"":"opacity-50 grayscale"])},null,10,Ke)):(n(),p(d,{key:2,name:"i-lucide-crown",class:y(["h-3.5 w-3.5 shrink-0",C(o)?"text-amber-500":"text-muted-foreground"])},null,8,["class"]))]),_:2},1032,["text"])):_("",!0)]),i.showBillingRule?(n(),g("div",We,[o.billingRule.power===0?(n(),p(r,{key:0,variant:"soft",color:"neutral",size:"sm"},{default:f(()=>[D(m(t(v)("common.free")),1)]),_:1})):(n(),g("span",{key:1,class:y(["text-inverted flex w-fit items-center gap-1 rounded-full px-2 py-0.5 text-[10px] font-medium",t(l)?.id===o.id?"bg-primary dark:bg-primary-800":"bg-primary/10 text-primary"])},[a("span",null,m(o.billingRule.power)+m(t(v)("common.unit.points")),1),s[4]||(s[4]=a("span",null,"/",-1)),a("span",null,m(o.billingRule.tokens)+"Tokens",1)],2))])):_("",!0)]),i.showDescription&&o.description?(n(),g("p",Qe,m(o.description),1)):_("",!0)])],10,Ne)]),_:2},1032,["mode","disabled"]))),128))],512),[[be,G(c.id)]])]),_:2},1024)]))),128))]),_:1},512)],2)])]),default:f(()=>[h(b,he({color:"neutral",variant:"soft",class:"flex items-center justify-between",loading:t(S),disabled:i.disabled},i.buttonUi,{onClick:s[1]||(s[1]=H(()=>{},["stop"]))}),{default:f(()=>[a("div",ze,[a("span",Re,m(t(l)?.name||t(te)?.name||t(v)("common.placeholder.modelSelect")),1),t(l)?.modelConfig?.mode?(n(),p(r,{key:0,variant:"outline",color:"neutral",size:"sm"},{default:f(()=>[D(m(String(t(l).modelConfig.mode).toUpperCase()),1)]),_:1})):_("",!0),t(l)&&(t(l).features?.includes("vision")||t(l).features?.includes("video")||t(l).features?.includes("audio"))?(n(),g("div",$e,[t(l)?.features?.includes("vision")?(n(),p(r,{key:0,icon:"i-lucide-eye",size:"sm",variant:"outline",color:"neutral"})):_("",!0),t(l)?.features?.includes("video")?(n(),p(r,{key:1,icon:"i-lucide-video",size:"sm",variant:"outline",color:"neutral"})):_("",!0),t(l)?.features?.includes("audio")?(n(),p(r,{key:2,icon:"i-lucide-audio-lines",size:"sm",variant:"outline",color:"neutral"})):_("",!0)])):_("",!0)]),a("div",Te,[t(l)?.name&&i.console?(n(),p(d,{key:0,name:"i-lucide-x",onClick:s[0]||(s[0]=H(c=>$(null),["stop"]))})):_("",!0),h(d,{name:"i-lucide-chevron-down",class:y({"rotate-180":t(x)})},null,8,["class"])])]),_:1},16,["loading","disabled"])]),_:1},8,["open","disabled"])}}});export{it as _};
