const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BSli64Ga.js","./Cgyg1gJC.js","./Ghlq83yM.js","./DQMjdCEn.js","./OUYfsp1i.js","./BFo3vNrE.js","./CuVAPZQ8.js","./Z7qkLoXK.js","./CjE5iPSn.js","./D9UsdH-b.js","./MCK2d4XT.js","./EK7Wbu3-.js"])))=>i.map(i=>d[i]);
import{d as G,i as H,at as X,V as J,s as h,a2 as Q,n as p,aN as V,p as Y,f as Z,o as ee,w as d,x as a,t as c,B as se,z as m,g as e,bD as C,v as F,_ as oe,D as re,A as M,bM as ae,bN as ne,W as te,X as ie}from"#entry";import de from"./cd55qm53.js";import{_ as ce}from"./D_3bTjYR.js";import{_ as le}from"./DO9M7gn1.js";import{_ as ue}from"./Ghlq83yM.js";import{d as we}from"./MCK2d4XT.js";import"./D9sX2Qi6.js";import"./CtosDvS0.js";import"./CuVAPZQ8.js";import"./BCcN9pii.js";import"./CMKSl-Ng.js";import"./DBEJUH-Z.js";import"./o4ws_w_T.js";import"./DQMjdCEn.js";import"./OUYfsp1i.js";import"./BFo3vNrE.js";import"./Z7qkLoXK.js";import"./CjE5iPSn.js";import"./D9UsdH-b.js";import"./EK7Wbu3-.js";const me={class:"space-y-4"},pe={class:"space-y-4 pt-4"},fe={class:"text-muted-foreground text-xs"},ge={class:"space-y-4 pt-4"},_e={class:"rounded-lg border border-orange-200 bg-orange-50 p-4 dark:border-orange-800 dark:bg-orange-950"},be={class:"flex items-start gap-3"},ve={class:"space-y-2"},he={class:"font-medium text-orange-800 dark:text-orange-200"},Pe={class:"text-sm text-orange-700 dark:text-orange-300"},ke={class:"ml-4 list-disc space-y-1 text-sm text-orange-600 dark:text-orange-400"},ye={class:"flex justify-end gap-2"},Oe=G({__name:"edit-password",props:{userid:{}},emits:["close"],setup(U,{emit:$}){const B=te(()=>ie(()=>import("./BSli64Ga.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]),import.meta.url)),_=U,D=$,{t:s}=H(),l=X(),L=J(),i=h("change"),n=Q({newPassword:"",confirmPassword:""}),g=h(!1),w=h({new:!1,confirm:!1}),T=p(()=>[{value:"change",label:s("user.backend.password.changeTab"),icon:"i-lucide-edit",slot:"change"},{value:"reset",label:s("user.backend.password.resetTab"),icon:"i-lucide-refresh-cw",slot:"reset"}]),b=p(()=>{const o={};if(i.value==="change"){const r=n.newPassword.trim(),t=n.confirmPassword.trim();r&&r.length<6&&(o.newPassword=s("user.backend.password.validation.passwordMinLength")),t&&r&&(r.length<6||t!==r&&(o.confirmPassword=s("user.backend.password.validation.passwordMismatch")))}return o}),z=p(()=>Object.keys(b.value).length>0),E=p(()=>{if(i.value==="reset")return!1;const o=n.newPassword.trim(),r=n.confirmPassword.trim();return!o||!r});function P(){n.newPassword="",n.confirmPassword="",w.value={new:!1,confirm:!1}}function k(o){w.value[o]=!w.value[o]}const{lockFn:I,isLock:y}=V(async()=>{const o=n.newPassword.trim(),r=n.confirmPassword.trim();if(!o){l.warning(s("user.backend.password.validation.newPasswordRequired"));return}if(o.length<6){l.warning(s("user.backend.password.validation.passwordMinLength"));return}if(!r){l.warning(s("user.backend.password.validation.confirmPasswordRequired"));return}if(r!==o){l.warning(s("user.backend.password.validation.passwordMismatch"));return}try{await ae(_.userid||"",o),l.success(s("user.backend.password.messages.changeSuccess")),f()}catch(t){console.error("修改密码失败:",t),l.error(t instanceof Error?t.message:s("user.backend.password.messages.changeFailed"))}}),q=o=>{L.create(B).open({password:o})},K=async()=>{if(!_.userid){l.error(s("user.backend.password.validation.userIdRequired"));return}try{g.value=!0;const{password:o}=await ne(_.userid||"");q(o),f()}catch(o){console.error("重置密码失败:",o),l.error(o instanceof Error?o.message:s("user.backend.password.messages.resetFailed"))}finally{g.value=!1}},{lockFn:N}=V(K);function v(){i.value==="change"?I():N()}const f=()=>{P(),D("close")};Y(i,()=>{P()});const S=p(()=>{const o=y.value||g.value;return i.value==="change"&&(E.value||z.value)||o});we({escape:f});const A=p(()=>y.value||g.value);return(o,r)=>{const t=oe,x=de,R=ce,O=se,W=le,j=ue;return ee(),Z(j,{title:e(s)("user.backend.password.title"),ui:{content:"max-w-md overflow-y-auto h-fit"},"show-footer":!0,onClose:r[5]||(r[5]=u=>f())},{footer:d(()=>[a("div",ye,[c(t,{variant:"soft",color:"neutral",onClick:f},{default:d(()=>[M(m(e(s)("user.backend.password.cancel")),1)]),_:1}),c(t,{disabled:e(S),color:e(i)==="reset"?"warning":"primary",loading:e(A),onClick:v},{default:d(()=>[M(m(e(i)==="change"?e(s)("user.backend.password.changePassword"):e(s)("user.backend.password.confirmReset")),1)]),_:1},8,["disabled","color","loading"])])]),default:d(()=>[a("div",me,[c(W,{modelValue:e(i),"onUpdate:modelValue":r[4]||(r[4]=u=>re(i)?i.value=u:null),items:e(T),class:"w-full"},{change:d(()=>[a("div",pe,[c(R,{label:e(s)("user.backend.password.newPassword"),size:"lg",required:"",error:e(b).newPassword},{default:d(()=>[c(x,{modelValue:e(n).newPassword,"onUpdate:modelValue":r[1]||(r[1]=u=>e(n).newPassword=u),type:e(w).new?"text":"password",placeholder:e(s)("user.backend.password.newPasswordPlaceholder"),ui:{root:"w-full"},onKeydown:C(F(v,["prevent"]),["enter"])},{trailing:d(()=>[c(t,{variant:"ghost",size:"xs",icon:e(w).new?"i-lucide-eye-off":"i-lucide-eye",onClick:r[0]||(r[0]=u=>k("new"))},null,8,["icon"])]),_:1},8,["modelValue","type","placeholder","onKeydown"])]),_:1},8,["label","error"]),c(R,{label:e(s)("user.backend.password.confirmPassword"),size:"lg",required:"",error:e(b).confirmPassword},{default:d(()=>[c(x,{modelValue:e(n).confirmPassword,"onUpdate:modelValue":r[3]||(r[3]=u=>e(n).confirmPassword=u),type:e(w).confirm?"text":"password",placeholder:e(s)("user.backend.password.confirmPasswordPlaceholder"),ui:{root:"w-full"},onKeydown:C(F(v,["prevent"]),["enter"])},{trailing:d(()=>[c(t,{variant:"ghost",size:"xs",icon:e(w).confirm?"i-lucide-eye-off":"i-lucide-eye",onClick:r[2]||(r[2]=u=>k("confirm"))},null,8,["icon"])]),_:1},8,["modelValue","type","placeholder","onKeydown"])]),_:1},8,["label","error"]),a("div",fe,m(e(s)("user.backend.password.passwordHelp")),1)])]),reset:d(()=>[a("div",ge,[a("div",_e,[a("div",be,[c(O,{name:"i-lucide-alert-triangle",class:"mt-0.5 size-5 text-orange-600 dark:text-orange-400"}),a("div",ve,[a("h4",he,m(e(s)("user.backend.password.resetConfirmTitle")),1),a("p",Pe,m(e(s)("user.backend.password.resetConfirmDesc")),1),a("ul",ke,[a("li",null,m(e(s)("user.backend.password.resetWarning1")),1),a("li",null,m(e(s)("user.backend.password.resetWarning2")),1)])])])])])]),_:1},8,["modelValue","items"])])]),_:1},8,["title"])}}});export{Oe as default};
