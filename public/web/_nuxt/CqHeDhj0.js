import{d as W,i as X,s as x,l as Y,k as ee,n as A,p as z,q as te,f as w,o as a,g as l,D as N,w as _,t as i,_ as se,m as oe,v as L,x as r,c,F as I,y as V,E as P,z as d,B as le,A as D,C,aZ as ae,J as ne}from"#entry";import{_ as re}from"./o4ws_w_T.js";import ie from"./cd55qm53.js";import{_ as ce}from"./Cie-o9Wa.js";import{_ as de}from"./hsuWSsy6.js";import{a as ue}from"./B0g9CpkI.js";const me={class:"flex flex-1 items-center gap-1.5 overflow-hidden text-left"},fe={class:"truncate"},pe={class:"ml-1 flex shrink-0 items-center gap-2"},_e={class:"border-border bg-background w-[320px] rounded-lg border shadow-lg"},he={class:"p-3"},ve={class:"grid h-full"},ye={key:0,class:"text-muted-foreground flex flex-col items-center justify-center py-12"},ge={class:"text-sm"},xe={key:1,class:"text-muted-foreground flex flex-col items-center justify-center py-12"},we={class:"text-sm font-medium"},be={class:"mt-1 text-xs"},ke={key:2,class:"space-y-1 py-1"},Se=["data-level-id","onClick"],Ae={class:"flex-none"},Ve={key:1,class:"bg-primary/10 text-primary flex h-8 w-8 items-center justify-center rounded-full"},Ce={class:"min-w-0 flex-1"},Be={class:"flex items-center gap-2"},Le={key:0,class:"text-muted-foreground mt-0.5 line-clamp-1 text-xs"},Ie={key:1,class:"text-muted-foreground mt-1 flex items-center gap-1 text-xs"},Ue={class:"flex-none"},De=W({__name:"membership-level-select",props:{modelValue:{},disabled:{type:Boolean},showDescription:{type:Boolean,default:!0},defaultSelected:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},buttonUi:{},showBenefits:{type:Boolean,default:!1},placeholder:{default:""}},emits:["update:modelValue","change"],setup(E,{emit:M}){const o=E,b=M,{t:p}=X(),g=x(!1),h=x(!1),v=x(""),f=x([]),u=x(null),m=Y(new Set),U=ee("scrollAreaRef"),$=A(()=>{const e=v.value.trim().toLowerCase();return e?f.value.filter(t=>t.name.toLowerCase().includes(e)||t.description?.toLowerCase().includes(e)):f.value}),k=A(()=>o.multiple?f.value.filter(e=>m.value.has(e.id)):u.value?[u.value]:[]),T=A(()=>k.value.slice(0,3)),R=A(()=>Math.max(0,k.value.length-3));function q(e){o.disabled||(o.multiple?j(e):B(null))}function B(e){o.multiple||(u.value=e,b("update:modelValue",e?.id||""),b("change",e),h.value=!1,v.value="")}function j(e){if(!o.multiple){B(e);return}const t=new Set(m.value);t.has(e.id)?t.delete(e.id):t.add(e.id),m.value=t;const n=f.value.filter(y=>t.has(y.id));b("update:modelValue",Array.from(t)),b("change",n)}function S(e){return o.multiple?m.value.has(e):u.value?.id===e}async function F(){if(!g.value){g.value=!0;try{f.value=await ue();const e=t=>f.value.find(n=>n.id===t);if(o.multiple)Array.isArray(o.modelValue)?m.value=new Set(o.modelValue):o.modelValue&&(m.value=new Set([o.modelValue]));else{const t=Array.isArray(o.modelValue)?o.modelValue[0]:o.modelValue;if(!o.defaultSelected){u.value=e(t)??null;return}u.value=e(t)??f.value[0]??null,u.value&&B(u.value)}}catch(e){console.error("Failed to load membership levels:",e)}finally{g.value=!1}}}async function O(){if(!h.value||!U.value)return;const e=o.multiple?Array.from(m.value)[0]:u.value?.id;if(!e)return;await ne(),document.querySelector(`[data-level-id="${e}"]`)?.scrollIntoView({behavior:"smooth",block:"center"})}return z(h,e=>{e&&O()}),z(()=>o.modelValue,e=>{if(!(g.value||!f.value.length))if(o.multiple)Array.isArray(e)?m.value=new Set(e):e?m.value=new Set([e]):m.value=new Set;else{const t=Array.isArray(e)?e[0]:e,n=f.value.find(y=>y.id===t);n&&(u.value=n)}}),te(F),(e,t)=>{const n=le,y=re,G=se,J=ie,K=ae,Z=ce,H=de;return a(),w(H,{open:l(h),"onUpdate:open":t[3]||(t[3]=s=>N(h)?h.value=s:null),disabled:o.disabled},{content:_(()=>[r("div",_e,[r("div",he,[i(J,{modelValue:l(v),"onUpdate:modelValue":t[2]||(t[2]=s=>N(v)?v.value=s:null),placeholder:l(p)("common.placeholder.searchLevel"),size:"sm",class:"w-full",ui:{base:"bg-muted/30 border-border/50 focus:border-primary/50 focus:ring-primary/20"}},{leading:_(()=>[i(n,{name:"i-lucide-search",class:"text-muted-foreground h-4 w-4"})]),_:1},8,["modelValue","placeholder"])]),r("div",ve,[i(Z,{ref_key:"scrollAreaRef",ref:U,class:"max-h-[350px] min-h-[150px] px-2 pb-2",type:"hover",shadow:!1},{default:_(()=>[l(g)?(a(),c("div",ye,[i(n,{name:"i-lucide-loader-2",class:"mb-2 h-6 w-6 animate-spin"}),r("span",ge,d(l(p)("common.loading")),1)])):l($).length?(a(),c("div",ke,[(a(!0),c(I,null,P(l($),s=>(a(),c("div",{key:s.id,"data-level-id":s.id,class:C(["group hover:bg-muted/50 flex cursor-pointer items-center gap-3 rounded-lg px-3 py-2.5 transition-colors",{"bg-primary/10 hover:bg-primary/15":S(s.id)}]),onClick:Q=>j(s)},[r("div",Ae,[s.icon?(a(),w(K,{key:0,src:s.icon,alt:s.name,class:"h-8 w-8 rounded-full object-cover"},null,8,["src","alt"])):(a(),c("div",Ve,[i(n,{name:"i-lucide-crown",class:"h-4 w-4"})]))]),r("div",Ce,[r("div",Be,[r("span",{class:C(["truncate font-medium",{"text-primary":S(s.id),"text-foreground":!S(s.id)}])},d(s.name),3),i(y,{variant:"soft",color:"neutral",size:"xs"},{default:_(()=>[D(" Lv."+d(s.level),1)]),_:2},1024)]),o.showDescription&&s.description?(a(),c("p",Le,d(s.description),1)):V("",!0),s.givePower>0?(a(),c("div",Ie,[i(n,{name:"i-lucide-zap",class:"h-3 w-3"}),r("span",null,d(l(p)("common.givePower"))+": "+d(s.givePower),1)])):V("",!0)]),r("div",Ue,[S(s.id)?(a(),w(n,{key:0,name:"i-lucide-check",class:"text-primary h-4 w-4"})):V("",!0)])],10,Se))),128))])):(a(),c("div",xe,[i(n,{name:"i-lucide-crown",class:"mb-3 h-8 w-8 opacity-50"}),r("span",we,d(l(v)?l(p)("common.noSearchResults"):l(p)("common.empty")),1),r("span",be,d(l(v)?l(p)("common.tryOtherKeywords"):l(p)("common.noAvailableLevels")),1)]))]),_:1},512)])])]),default:_(()=>[i(G,oe({color:"neutral",variant:"ghost",class:"flex min-h-8 w-full items-center justify-between py-2",loading:l(g),disabled:o.disabled},o.buttonUi,{onClick:t[1]||(t[1]=L(()=>{},["stop"]))}),{default:_(()=>[r("div",me,[l(k).length>0?(a(),c(I,{key:0},[(a(!0),c(I,null,P(l(T),s=>(a(),w(y,{key:s.id,variant:"outline",color:"neutral",class:"flex shrink-0 items-center gap-1",onClick:t[0]||(t[0]=L(()=>{},["stop"]))},{default:_(()=>[r("span",fe,d(s.name),1),i(n,{name:"i-lucide-x",class:"hover:text-primary h-3 w-3 cursor-pointer",onClick:L(Q=>q(s),["stop"])},null,8,["onClick"])]),_:2},1024))),128)),l(R)>0?(a(),w(y,{key:0,variant:"soft",color:"neutral",class:"shrink-0"},{default:_(()=>[D(" +"+d(l(R))+"... ",1)]),_:1})):V("",!0)],64)):(a(),c("span",{key:1,class:C(["truncate",{"text-muted-foreground":!l(k).length}])},d(o.placeholder||l(p)("common.placeholder.levelSelect")),3))]),r("div",pe,[i(n,{name:"i-lucide-chevron-down",class:C(["text-muted-foreground h-4 w-4",{"rotate-180":l(h)}])},null,8,["class"])])]),_:1},16,["loading","disabled"])]),_:1},8,["open","disabled"])}}});export{De as _};
