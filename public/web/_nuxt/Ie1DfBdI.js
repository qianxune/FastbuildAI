const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BFe3D1TQ.js","./CvI6s-qz.js","./Cgyg1gJC.js","./CtosDvS0.js","./CAQVAH0V.js","./DNSLGqNg.js","./BFo3vNrE.js","./DeCyaT7k.js","./D4e4FYoF.js","./Z7qkLoXK.js","./BstbYvQo.js","./CuVAPZQ8.js","./cd55qm53.js","./sTbVUDyT.js","./kRIii9yh.js","./CMKSl-Ng.js","./Deu6qIfg.js","./B3rWqoNg.js","./EK7Wbu3-.js","./Ghlq83yM.js","./DQMjdCEn.js","./OUYfsp1i.js","./CjE5iPSn.js","./D9UsdH-b.js","./MCK2d4XT.js","./gu2_Ts15.js"])))=>i.map(i=>d[i]);
import{d as L,aM as j,av as F,at as N,i as q,k as G,V as H,n as h,aQ as Q,p as X,K as W,q as J,c as Y,o as Z,x as u,t as b,z as A,g as o,w as ee,_ as ae,j as se,h as s,G as te,B as oe,W as re,l as $,aX as ne,X as le}from"#entry";import{_ as ie}from"./o4ws_w_T.js";import{_ as ce}from"./CBTz8tdX.js";import de from"./cd55qm53.js";import{_ as me}from"./hsuWSsy6.js";import{_ as ue}from"./DQQ3dYHz.js";import be from"./4jjeIyfe.js";import{_ as pe}from"./JxyxsHxp.js";import{_ as fe}from"./D4ebF709.js";import{p as ge,q as ve,r as ke,s as he}from"./gu2_Ts15.js";import{u as xe}from"./ZDOPDbaX.js";import{u as x}from"./CSy6ZCzT.js";import{u as _e}from"./CxvgZo8z.js";import"./DMoqg0Fd.js";import"./CtosDvS0.js";import"./kRIii9yh.js";import"./DNSLGqNg.js";import"./Z7qkLoXK.js";import"./C6Y-ieo6.js";import"./BFo3vNrE.js";import"./DeCyaT7k.js";import"./D4e4FYoF.js";import"./BCcN9pii.js";import"./CMKSl-Ng.js";import"./CuVAPZQ8.js";import"./psimjGaX.js";import"./B3rWqoNg.js";import"./EK7Wbu3-.js";import"./Dh3Mo9T6.js";import"./sTbVUDyT.js";import"./CAQVAH0V.js";import"./Deu6qIfg.js";import"./o0-e7Rye.js";import"./abPSHzII.js";const we={class:"flex h-full w-full flex-col px-6"},ye={class:"flex flex-col justify-center gap-1 pt-4"},Ae={class:"text-lg! font-bold"},$e={class:"text-muted-foreground text-sm"},Re={class:"flex w-full justify-between gap-4 py-6 backdrop-blur-sm"},Ie={class:"flex items-center gap-2 md:ml-auto"},Ue={class:"mt-auto flex items-center justify-end gap-3 py-4"},da=L({__name:"members",setup(Se){const R=re(()=>le(()=>import("./BFe3D1TQ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]),import.meta.url)),p=ae,_=ie,w=ce,I=de,U=te,S=me,C=oe,{params:V}=j(),M=F(),f=N(),{t:a}=q(),g=G("table"),T=H(),v=h(()=>V.id),d=Q({datasetId:v.value||"",username:"",role:void 0,isActive:void 0}),m=h(()=>({user:a("ai-datasets.backend.members.table.user"),role:a("ai-datasets.backend.members.table.role"),status:a("console-common.status"),createdAt:a("ai-datasets.backend.members.table.createdAt"),lastActiveAt:a("ai-datasets.backend.members.table.lastActiveAt"),actions:a("console-common.operation")})),{paging:l,getLists:i}=xe({fetchFun:ge,params:d}),y=h(()=>l.items.find(e=>e.oneself)),D={owner:{label:a("ai-datasets.backend.members.role.owner"),color:"error"},manager:{label:a("ai-datasets.backend.members.role.manager"),color:"warning"},editor:{label:a("ai-datasets.backend.members.role.editor"),color:"primary"},viewer:{label:a("ai-datasets.backend.members.role.viewer"),color:"neutral"}},O=[{accessorKey:"user",header:()=>s("p",{class:""},`${m.value.user}`),cell:({row:e})=>s("div",{class:"flex items-center gap-3"},[s(U,{src:e.original.user?.avatar,alt:e.original.user?.username||e.original.userId,size:"sm"}),s("div",void 0,[s("div",{class:"flex items-center gap-2"},[s("p",{class:"font-medium text-highlighted"},e.original.user?.nickname||e.original.user?.username||e.original.userId),e.original.oneself?s(_,{color:"primary",variant:"subtle",size:"xs"},()=>a("ai-datasets.backend.members.self")):null]),e.original.user?.username?s("p",{class:"text-sm text-muted-foreground truncate max-w-xs"},e.original.user.username):null,e.original.note?s("p",{class:"text-sm text-muted-foreground mt-1"},`${a("ai-datasets.backend.members.note")}: ${e.original.note}`):null])])},{accessorKey:"role",header:()=>s("div",{class:"flex items-center gap-2"},[s("p",{class:""},`${m.value.role}`),s(S,{mode:"hover",openDelay:200,content:{align:"start",side:"bottom",sideOffset:8}},{default:()=>s(C,{name:"i-lucide-info",class:"text-muted-foreground size-4 cursor-help"}),content:()=>s("div",{class:"w-80 space-y-3 p-4"},[s("h3",{class:"text-sm font-semibold mb-3"},a("ai-datasets.backend.members.rolePermissionDescription")),s("ul",{class:"space-y-2.5 text-sm"},[s("li",{class:"flex flex-col gap-1"},[s("span",{class:"font-medium"},`${a("ai-datasets.backend.members.role.owner")}:`),s("span",{class:"text-muted-foreground"},a("ai-datasets.backend.members.roleOwnerDescription"))]),s("li",{class:"flex flex-col gap-1"},[s("span",{class:"font-medium"},`${a("ai-datasets.backend.members.role.manager")}:`),s("span",{class:"text-muted-foreground"},a("ai-datasets.backend.members.roleManagerDescription"))]),s("li",{class:"flex flex-col gap-1"},[s("span",{class:"font-medium"},`${a("ai-datasets.backend.members.role.editor")}:`),s("span",{class:"text-muted-foreground"},a("ai-datasets.backend.members.roleEditorDescription"))]),s("li",{class:"flex flex-col gap-1"},[s("span",{class:"font-medium"},`${a("ai-datasets.backend.members.role.viewer")}:`),s("span",{class:"text-muted-foreground"},a("ai-datasets.backend.members.roleViewerDescription"))])])])})]),cell:({row:e})=>{const t=e.getValue("role"),n=D[t];return s(_,{color:n.color,variant:"subtle"},()=>n.label)}},{accessorKey:"createdAt",header:({column:e})=>{const t=e.getIsSorted();return s(p,{color:"neutral",variant:"ghost",label:m.value.createdAt,icon:t?t==="asc"?"i-lucide-arrow-up-narrow-wide":"i-lucide-arrow-down-wide-narrow":"i-lucide-arrow-up-down",class:"-mx-2.5",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc")})},cell:({row:e})=>{const t=e.getValue("createdAt");return s("span",{class:"text-sm"},new Date(t).toLocaleDateString())}},{accessorKey:"lastActiveAt",header:()=>s("p",{class:""},`${m.value.lastActiveAt}`),cell:({row:e})=>{const t=e.getValue("lastActiveAt");return s("span",{class:"text-sm text-muted-foreground"},t?new Date(t).toLocaleDateString():"-")}},{id:"actions",header:()=>s("p",{class:""},`${m.value.actions}`),size:80,enableSorting:!1,enableHiding:!1,cell:({row:e})=>{const t=z(e);return t.length===0?null:s(w,{items:t},()=>s(p,{icon:"i-lucide-ellipsis-vertical",color:"neutral",variant:"ghost",class:"ml-auto"},()=>""))}}];function z(e){return[e.original.isCurrentUserOwner&&e.original.role!=="owner"?{label:a("ai-datasets.backend.members.transferOwnership"),icon:"i-lucide-crown",onClick:()=>{E(e.original)}}:null,e.original.canOperate&&!e.original.oneself?{label:a("ai-datasets.backend.members.updateRole"),icon:"i-lucide-pen-line",onClick:()=>{B(e.original)}}:null,e.original.canOperate?{label:e.original.oneself?a("ai-datasets.backend.members.exit"):a("ai-datasets.backend.members.removeMember"),icon:e.original.oneself?"i-lucide-log-out":"i-lucide-trash",color:"error",onSelect(){K(e)}}:null].filter(Boolean)}X(()=>[d.username,d.role,d.isActive],()=>{W(()=>{l.page=1,i()},300)()},{deep:!0});const P=async()=>{await T.create(R).open({modelValue:!0,datasetId:v.value||""}).result&&i()},B=async e=>{try{const t=$(e.role),n=$(e.note||""),k=[{label:a("ai-datasets.backend.members.role.manager"),value:"manager"},{label:a("ai-datasets.backend.members.role.editor"),value:"editor"},{label:a("ai-datasets.backend.members.role.viewer"),value:"viewer"}],r=ne({setup(){return()=>s("div",{class:"space-y-4"},[s("div",{class:"text-sm text-gray-600 mb-3"},[a("console-common.update"),s("span",{class:"text-red-500"},e.user?.username||e.userId),a("ai-datasets.backend.members.roleTip")]),s("div",{},[s("label",{class:"block text-sm font-medium mb-2"},`${a("ai-datasets.backend.members.newRole")}:`),s(ue,{modelValue:t.value,"onUpdate:modelValue":c=>t.value=c,items:k,labelKey:"label",valueKey:"value",class:"w-full"})]),s("div",{},[s("label",{class:"block text-sm font-medium mb-2"},`${a("ai-datasets.backend.members.note")}:`),s(be,{modelValue:n.value,"onUpdate:modelValue":c=>n.value=c,placeholder:a("ai-datasets.backend.members.notePlaceholder"),class:"w-full",rows:3})])])}});await x({title:a("ai-datasets.backend.members.updateRoleModal"),content:r,confirmText:a("console-common.update"),cancelText:a("console-common.cancel"),ui:{content:"!w-md"}}),(t.value!==e.role||n.value!==(e.note||""))&&(await ve({memberId:e.id,role:t.value,note:n.value||void 0}),f.success(a("ai-datasets.backend.members.updateRoleSuccess")),i())}catch(t){console.error("更新角色失败:",t)}},K=async e=>{try{if(await x({color:"error",title:e.original.oneself?a("ai-datasets.backend.members.confirmExit"):a("ai-datasets.backend.members.confirmRemove"),content:e.original.oneself?a("ai-datasets.backend.members.confirmExitContent"):a("ai-datasets.backend.members.confirmRemoveContent"),confirmText:e.original.oneself?a("console-common.exit"):a("console-common.remove"),ui:{content:"!w-sm"}}),await ke({memberId:e.original.id}),e.original.oneself){M.push(_e("ai-datasets:list")),f.success(a("ai-datasets.backend.members.exitSuccess"));return}f.success(a("ai-datasets.backend.members.removeSuccess")),i()}catch(t){console.error("移除失败:",t)}},E=async e=>{try{await x({color:"warning",title:a("ai-datasets.backend.members.transferOwnership"),content:s("div",{class:"text-sm text-gray-600"},[s("p",{class:"mb-2"},[a("ai-datasets.backend.members.confirmTransferContent"),s("span",{class:"text-red-500"},e.user?.username||e.userId)," ？"]),s("p",{class:"text-red-500"},a("ai-datasets.backend.members.confirmTransferContent2"))]),confirmText:a("ai-datasets.backend.members.confirmTransfer"),ui:{content:"!w-sm"}}),await he({datasetId:v.value||"",newOwnerId:e.userId}),f.success(a("ai-datasets.backend.members.confirmTransferSuccess")),i()}catch(t){console.error("转移所有权失败:",t)}};return J(()=>i()),(e,t)=>{const n=pe,k=fe;return Z(),Y("div",we,[u("div",ye,[u("h1",Ae,A(o(a)("ai-datasets.backend.members.title")),1),u("p",$e,A(o(a)("ai-datasets.backend.members.description")),1)]),u("div",Re,[b(o(I),{modelValue:o(d).username,"onUpdate:modelValue":t[0]||(t[0]=r=>o(d).username=r),placeholder:e.$t("ai-datasets.backend.members.searchPlaceholder"),class:"w-80",icon:"i-lucide-search"},null,8,["modelValue","placeholder"]),u("div",Ie,[b(o(w),{items:o(g)?.tableApi?.getAllColumns().filter(r=>r.getCanHide()).map(r=>({label:o(m)[r.id]||r.columnDef.header,type:"checkbox",checked:r.getIsVisible(),onUpdateChecked(c){o(g)?.tableApi?.getColumn(r.id)?.toggleVisibility(!!c)},onSelect(c){c?.preventDefault()}})),content:{align:"end"}},{default:ee(()=>[b(o(p),{label:e.$t("console-common.showColumns"),color:"neutral",variant:"outline","trailing-icon":"i-lucide-chevron-down"},null,8,["label"])]),_:1},8,["items"]),b(o(p),{label:e.$t("ai-datasets.backend.members.addMember"),disabled:!("useUserStore"in e?e.useUserStore:o(se))().userInfo?.isRoot&&o(y)?.role!=="owner"&&o(y)?.role!=="manager","leading-icon":"i-lucide-plus",color:"primary",onClick:P},null,8,["label","disabled"])])]),b(n,{loading:o(l).loading,data:o(l).items,columns:O,class:"shrink-0",ref_key:"table",ref:g,selectable:"",ui:{base:"table-fixed border-separate border-spacing-0",thead:"[&>tr]:bg-elevated/50 [&>tr]:after:content-none",tbody:"[&>tr]:last:[&>td]:border-b-0",th:"py-2 first:rounded-l-lg last:rounded-r-lg border-y border-default first:border-l last:border-r",td:"border-b border-default",tr:"hover:bg-elevated/50"}},null,8,["loading","data"]),u("div",Ue,[b(k,{page:o(l).page,"onUpdate:page":t[1]||(t[1]=r=>o(l).page=r),size:o(l).pageSize,"onUpdate:size":t[2]||(t[2]=r=>o(l).pageSize=r),total:o(l).total,onChange:o(i)},null,8,["page","size","total","onChange"])])])}}});export{da as default};
