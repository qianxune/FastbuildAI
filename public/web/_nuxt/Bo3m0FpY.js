import{d as E,i as M,at as A,s as b,a2 as w,q as S,f as C,o as i,w as g,x as t,c as l,aZ as T,t as p,B as q,z as c,g as s,F as D,E as G,y as P,A as k,_ as R}from"#entry";import{_ as Z}from"./o4ws_w_T.js";import{_ as H}from"./CqHeDhj0.js";import{_ as J}from"./Ghlq83yM.js";import{h as K,i as O}from"./CsRstiIM.js";import"./cd55qm53.js";import"./Cie-o9Wa.js";import"./jsPNKUA0.js";import"./abPSHzII.js";import"./hsuWSsy6.js";import"./DMoqg0Fd.js";import"./CtosDvS0.js";import"./kRIii9yh.js";import"./DNSLGqNg.js";import"./Z7qkLoXK.js";import"./C6Y-ieo6.js";import"./BFo3vNrE.js";import"./DeCyaT7k.js";import"./D4e4FYoF.js";import"./BCcN9pii.js";import"./CMKSl-Ng.js";import"./CuVAPZQ8.js";import"./psimjGaX.js";import"./B0g9CpkI.js";import"./DQMjdCEn.js";import"./OUYfsp1i.js";import"./CjE5iPSn.js";import"./D9UsdH-b.js";import"./MCK2d4XT.js";import"./EK7Wbu3-.js";const Q={class:"space-y-4"},W={class:"bg-muted/30 flex items-center gap-3 rounded-lg p-3"},X={key:1,class:"bg-primary/10 flex h-10 w-10 items-center justify-center rounded-lg"},Y={class:"font-medium"},ee={class:"text-muted-foreground text-sm"},te={key:0,class:"flex items-center justify-center py-12"},oe={key:1,class:"text-muted-foreground flex flex-col items-center justify-center py-12"},se={class:"text-sm"},ne={key:2,class:"space-y-3"},ie={class:"mb-3"},ae={class:"flex items-center gap-2"},ce={class:"font-medium"},re={key:0,class:"text-muted-foreground mt-1 text-sm"},le={class:"flex items-center gap-3"},de={class:"min-w-0 flex-1"},me={class:"text-muted-foreground mt-2 text-xs"},Ge=E({__name:"feature-config",props:{extension:{}},emits:["close"],setup(r,{emit:B}){const L=r,$=B,{t:a}=M(),x=A(),u=b(!1),f=w({}),d=b([]),_=w({});async function F(){if(!u.value){u.value=!0;try{d.value=await K(L.extension.identifier),d.value.forEach(e=>{_[e.id]=e.membershipLevels.map(o=>o.id)})}catch(e){console.error("加载功能列表失败:",e),x.error(a("console-common.messages.failed"))}finally{u.value=!1}}}async function I(e){if(!f[e.id]){f[e.id]=!0;try{const o=_[e.id]||[],h=await O(e.id,o),m=d.value.findIndex(v=>v.id===e.id);m!==-1&&(d.value[m]=h),x.success(a("console-common.messages.success"))}catch(o){console.error("保存失败:",o),x.error(a("console-common.messages.failed"))}finally{f[e.id]=!1}}}function U(e,o){_[e]=Array.isArray(o)?o:o?[o]:[]}function V(){$("close")}return S(F),(e,o)=>{const h=T,m=q,v=Z,z=H,N=R,j=J;return i(),C(j,{title:s(a)("extensions.featureConfig.title"),description:r.extension.name,ui:{content:"max-w-xl"},onClose:V},{default:g(()=>[t("div",Q,[t("div",W,[r.extension.icon?(i(),C(h,{key:0,src:r.extension.icon,alt:r.extension.name,class:"h-10 w-10 rounded-lg object-cover"},null,8,["src","alt"])):(i(),l("div",X,[p(m,{name:"i-lucide-puzzle",class:"text-primary h-5 w-5"})])),t("div",null,[t("div",Y,c(r.extension.name),1),t("div",ee,c(r.extension.identifier),1)])]),s(u)?(i(),l("div",te,[p(m,{name:"i-lucide-loader-2",class:"text-muted-foreground h-6 w-6 animate-spin"})])):s(d).length?(i(),l("div",ne,[(i(!0),l(D,null,G(s(d),n=>(i(),l("div",{key:n.id,class:"border-border rounded-lg border p-4"},[t("div",ie,[t("div",ae,[t("span",ce,c(n.name),1),p(v,{variant:"soft",color:"neutral",size:"sm"},{default:g(()=>[k(c(n.featureCode),1)]),_:2},1024)]),n.description?(i(),l("p",re,c(n.description),1)):P("",!0)]),t("div",le,[t("div",de,[p(z,{"model-value":s(_)[n.id],multiple:"",placeholder:s(a)("extensions.featureConfig.levelPlaceholder"),"button-ui":{class:"w-full border border-border rounded-md"},"onUpdate:modelValue":y=>U(n.id,y)},null,8,["model-value","placeholder","onUpdate:modelValue"])]),p(N,{color:"primary",size:"sm",loading:s(f)[n.id],onClick:y=>I(n)},{default:g(()=>[k(c(s(a)("console-common.save")),1)]),_:1},8,["loading","onClick"])]),t("p",me,c(s(a)("extensions.featureConfig.levelTip")),1)]))),128))])):(i(),l("div",oe,[p(m,{name:"i-lucide-box",class:"mb-3 h-10 w-10 opacity-50"}),t("span",se,c(s(a)("extensions.featureConfig.empty")),1)]))])]),_:1},8,["title","description"])}}});export{Ge as default};
