import{d as S,k as T,i as V,V as P,aQ as B,n as K,p as h,K as z,q as D,c as j,o as R,x as r,t as c,g as a,w as F,_ as L,h as s,B as N}from"#entry";import{_ as M}from"./o4ws_w_T.js";import{_ as q}from"./CBTz8tdX.js";import E from"./cd55qm53.js";import{_ as G}from"./DBiaUVBh.js";import{_ as H}from"./JxyxsHxp.js";import{_ as O}from"./D4ebF709.js";import{e as Q}from"./Dm8J87dm.js";import{_ as J}from"./CgbDwyGn.js";import{u as W}from"./ZDOPDbaX.js";import{f as _}from"./DUoaAyrs.js";const X={class:"flex h-full w-full flex-col"},Y={class:"flex h-full flex-1 flex-col"},Z={class:"flex w-full justify-between gap-4 py-4 backdrop-blur-sm"},ee={class:"flex items-center gap-2"},te={class:"flex items-center gap-2 md:ml-auto"},ae={class:"flex h-full flex-1 flex-col"},se={class:"table h-full"},oe={class:"flex items-center justify-end gap-3 py-4"},ne={class:"flex items-center gap-1.5"},_e=S({__name:"chat-records",props:{agentId:{}},setup(b){const m=L,x=M,w=q,v=N,k=E,y=G,p=b,g=T("table"),{t:n}=V(),C=P(),d=B({agentId:p.agentId,keyword:""}),i=K(()=>({select:n("console-common.select"),title:n("ai-agent.backend.logs.dialogTitle"),user:n("ai-agent.backend.logs.user"),messageCount:n("ai-agent.backend.logs.messageCount"),totalTokens:n("ai-agent.backend.logs.totalTokens"),consumedPower:n("ai-agent.backend.logs.consumedPower"),updatedAt:n("ai-agent.backend.logs.updatedAt")})),{paging:l,getLists:u}=W({fetchFun:Q,params:d}),I=[{accessorKey:"title",header:()=>s("p",{class:""},`${i.value.title}`),cell:({row:t})=>s("div",{class:"flex items-center gap-3"},[s(v,{name:"i-lucide-message-circle",class:"text-primary size-5"}),s("div",{class:"flex-1 grid"},[s("p",{class:"font-medium text-highlighted truncate",title:t.original.title},t.original.title)])])},{accessorKey:"user",header:()=>s("p",{class:""},`${i.value.user}`),cell:({row:t})=>{const e=t.original.user;return e?s("div",{class:"flex items-center gap-3"},[e.avatar?s("img",{src:e.avatar,alt:e.nickname||e.username,class:"w-8 h-8 rounded-full object-cover flex-none"}):s("div",{class:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-none"},[s("span",{class:"text-xs font-medium text-primary"},(e.nickname||e.username).charAt(0).toUpperCase())]),s("div",{class:"flex flex-col min-w-0"},[s("span",{class:"text-sm font-medium truncate",title:e.nickname||e.username},e.nickname||e.username)])]):s("span",{class:"text-muted-foreground"},t.original.anonymousIdentifier)}},{accessorKey:"messageCount",header:()=>s("p",{class:"whitespace-nowrap"},`${i.value.messageCount}`),cell:({row:t})=>{const e=t.getValue("messageCount");return s(x,{color:"primary",variant:"subtle"},()=>e.toString())}},{accessorKey:"totalTokens",header:()=>s("p",{class:"whitespace-nowrap"},`${i.value.totalTokens}`),cell:({row:t})=>{const e=t.original.totalTokens||0;return s("span",{class:"text-sm text-primary"},`${_(e)}`)}},{accessorKey:"consumedPower",header:()=>s("p",{class:"whitespace-nowrap"},`${i.value.consumedPower}`),cell:({row:t})=>{const e=t.original.consumedPower||0;return s("span",{class:"text-sm text-orange-600 font-medium"},`${_(e)}`)}},{accessorKey:"updatedAt",header:({column:t})=>{const e=t.getIsSorted();return s(m,{color:"neutral",variant:"ghost",label:i.value.updatedAt,icon:e?e==="asc"?"i-lucide-arrow-up-narrow-wide":"i-lucide-arrow-down-wide-narrow":"i-lucide-arrow-up-down",class:"-mx-2.5",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc")})},cell:({row:t})=>{const e=t.getValue("updatedAt");return s(y,{datetime:e,mode:"datetime"})}}];h(()=>d.keyword,()=>{z(()=>{l.page=1,u()},300)()},{deep:!0});const $=t=>{C.create(J).open({open:!0,recordId:t.original.id,agentId:p.agentId})};return h(()=>p.agentId,t=>{d.agentId=t,l.page=1,u()}),D(()=>u()),(t,e)=>{const A=H,U=O;return R(),j("div",X,[r("div",Y,[r("div",Z,[r("div",ee,[c(a(k),{modelValue:a(d).keyword,"onUpdate:modelValue":e[0]||(e[0]=o=>a(d).keyword=o),placeholder:a(n)("ai-agent.backend.logs.dialogSearchPlaceholder"),class:"w-80",icon:"i-lucide-search"},null,8,["modelValue","placeholder"])]),r("div",te,[c(a(w),{items:a(g)?.tableApi?.getAllColumns().filter(o=>o.getCanHide()).map(o=>({label:a(i)[o.id]||o.columnDef.header,type:"checkbox",checked:o.getIsVisible(),onUpdateChecked(f){a(g)?.tableApi?.getColumn(o.id)?.toggleVisibility(!!f)},onSelect(f){f?.preventDefault()}})),content:{align:"end"}},{default:F(()=>[c(a(m),{label:a(n)("console-common.showColumns"),color:"neutral",variant:"outline","trailing-icon":"i-lucide-chevron-down"},null,8,["label"])]),_:1},8,["items"]),c(a(m),{label:a(n)("console-common.refresh"),color:"neutral",variant:"outline","leading-icon":"i-lucide-refresh-cw",onClick:a(u)},null,8,["label","onClick"])])]),r("div",ae,[r("div",se,[c(A,{loading:a(l).loading,data:a(l).items,columns:I,class:"h-full",ref_key:"table",ref:g,sticky:"",selectable:"",ui:{base:"table-fixed border-separate border-spacing-0",thead:"[&>tr]:bg-elevated/50 [&>tr]:after:content-none",tbody:"[&>tr]:last:[&>td]:border-b-0",th:"py-2 first:rounded-l-lg last:rounded-r-lg border-y border-default first:border-l last:border-r",td:"border-b border-default",tr:"hover:bg-elevated/50 cursor-pointer"},onSelect:$},null,8,["loading","data"])])]),r("div",oe,[r("div",ne,[c(U,{page:a(l).page,"onUpdate:page":e[1]||(e[1]=o=>a(l).page=o),size:a(l).pageSize,"onUpdate:size":e[2]||(e[2]=o=>a(l).pageSize=o),total:a(l).total,onChange:a(u)},null,8,["page","size","total","onChange"])])])])])}}});export{_e as _};
