const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BAfPBoQJ.js","./Cgyg1gJC.js","./o4ws_w_T.js","./DBiaUVBh.js","./Ghlq83yM.js","./DQMjdCEn.js","./OUYfsp1i.js","./BFo3vNrE.js","./CuVAPZQ8.js","./Z7qkLoXK.js","./CjE5iPSn.js","./D9UsdH-b.js","./MCK2d4XT.js","./EK7Wbu3-.js","./BdGWwroR.js"])))=>i.map(i=>d[i]);
import{d as K,at as M,i as q,V as H,k as O,aQ as j,s as Q,n as W,l as b,aN as x,q as X,c as J,o as Y,x as f,t as i,g as o,w as y,_ as Z,A as ee,z as V,h as t,B as se,W as oe,X as te}from"#entry";import{_ as ae}from"./o4ws_w_T.js";import{_ as re}from"./CBTz8tdX.js";import{_ as ie}from"./DBiaUVBh.js";import ne from"./cd55qm53.js";import{_ as le}from"./B5gsc-Ax.js";import{_ as ce}from"./JxyxsHxp.js";import{b as de,c as pe,d as me}from"./BdGWwroR.js";import{u as ue}from"./BlyoSzaa.js";import"./DMoqg0Fd.js";import"./CtosDvS0.js";import"./kRIii9yh.js";import"./DNSLGqNg.js";import"./Z7qkLoXK.js";import"./C6Y-ieo6.js";import"./BFo3vNrE.js";import"./DeCyaT7k.js";import"./D4e4FYoF.js";import"./BCcN9pii.js";import"./CMKSl-Ng.js";import"./CuVAPZQ8.js";import"./psimjGaX.js";import"./B3rWqoNg.js";import"./EK7Wbu3-.js";const ge={class:"permission-list-container pb-5"},fe={class:"bg-background sticky top-0 z-10 flex flex-wrap gap-4 pb-4"},ye={class:"flex items-end gap-2 md:ml-auto"},he={class:"border-default mt-auto flex items-center justify-between gap-3 border-t pt-4"},_e={class:"text-muted text-sm"},ve={class:"flex items-center gap-1.5"},He=K({__name:"list",setup(be){const D=oe(()=>te(()=>import("./BAfPBoQJ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]),import.meta.url)),l=Z,h=ae,k=re,$=se,G=ie,C=M(),{t:a}=q(),{hasAccessByCodes:S}=ue(),E=H(),_=O("table"),d=j({code:"",name:"",group:""}),P=Q({}),c=W(()=>({code:a("system-perms.permission.code"),name:a("system-perms.permission.name"),description:a("system-perms.permission.describe"),group:a("system-perms.permission.group"),isDeprecated:a("system-perms.permission.isDeprecated"),createdAt:a("console-common.createAt"),actions:a("console-common.operation")})),I=[{id:"expander",header:({table:e})=>t(l,{variant:"ghost",color:"neutral",icon:e.getExpandedDepth()?"i-lucide-minus-square":"i-lucide-plus-square",size:"xs",onClick:s=>{s.stopPropagation(),e.toggleAllRowsExpanded(!e.getExpandedDepth())}}),enableHiding:!1,cell:({row:e})=>e.getCanExpand()?t(l,{variant:"ghost",color:"neutral",icon:e.getIsExpanded()?"i-lucide-minus":"i-lucide-plus",size:"xs",onClick:s=>{s.stopPropagation(),e.toggleExpanded()}}):null},{accessorKey:"name",header:()=>t("p",{class:""},`${c.value.name}`),cell:({row:e})=>{e.depth;const s=e.original.isGroup,n=[];s&&n.push(t($,{name:"i-lucide-folder",class:"text-primary size-5 flex-none mr-2"}));const g=s?e.original.groupName:`@${e.original.name}`;return n.push(t("span",{class:"truncate"},g)),t("div",{class:"flex items-center"},n)}},{accessorKey:"description",header:()=>t("p",{class:""},`${c.value.description}`),cell:({row:e})=>{const s=e.getValue("description");return e.original.isGroup?t("div",{class:"text-muted-foreground"},"-"):t("div",{class:"max-w-xs truncate"},s||"-")}},{accessorKey:"group",header:()=>t("p",{class:""},`${c.value.group}`),cell:({row:e})=>{if(e.original.isGroup)return t("div",{class:"text-muted-foreground"},"-");const s=e.getValue("group");return t("div",{class:""},[t(h,{color:"primary",variant:"subtle"},()=>s)])}},{accessorKey:"isDeprecated",header:()=>t("p",{class:""},`${c.value.isDeprecated}`),cell:({row:e})=>{if(e.original.isGroup)return t("div",{class:"text-muted-foreground"},"-");const s=e.getValue("isDeprecated");return t("div",{class:""},[s?t(h,{color:"error",variant:"subtle"},()=>a("system-perms.permission.yes")):t(h,{color:"success",variant:"subtle"},()=>a("system-perms.permission.no"))])}},{accessorKey:"createdAt",header:({column:e})=>{const s=e.getIsSorted();return t(l,{color:"neutral",variant:"ghost",label:c.value.createdAt,icon:s?s==="asc"?"i-lucide-arrow-up-narrow-wide":"i-lucide-arrow-down-wide-narrow":"i-lucide-arrow-up-down",class:"-mx-2.5",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc")})},cell:({row:e})=>{if(e.original.isGroup)return t("div",{class:"text-muted-foreground"},"-");const s=e.getValue("createdAt");return t(G,{datetime:s,mode:"datetime"})}},{id:"actions",header:()=>t("p",{class:""},`${c.value.actions}`),size:80,enableSorting:!1,enableHiding:!1,cell:({row:e})=>e.original.isGroup?t("div",{class:"text-muted-foreground"},"-"):t(k,{items:L(e)},()=>t(l,{icon:"i-lucide-ellipsis-vertical",color:"neutral",variant:"ghost",class:"ml-auto"},()=>""))}];function L(e){return[S(["permission:info"])?{label:a("console-common.check"),icon:"i-lucide-eye",onSelect(){T(e.original.code)}}:null].filter(Boolean)}const m=b([]),u=b([]),U=b(!0),w=e=>e.map(s=>({id:`group-${s.code}`,code:s.code,name:s.name,groupName:s.name,description:"",group:s.code,isGroup:!0,createdAt:"",updatedAt:"",children:s.permissions.map(n=>({...n,isGroup:!1,groupName:s.name}))})),{lockFn:p,isLock:A}=x(async()=>{try{const e={keyword:d.name||void 0,group:d.group||void 0,isGrouped:U.value},s=await de(e);Array.isArray(s)?s.length>0&&s[0]&&"permissions"in s[0]?(u.value=s,m.value=w(u.value)):(m.value=s.map(n=>({...n,isGroup:!1})),u.value=[]):(u.value=[s],m.value=w(u.value))}catch(e){console.error("获取权限列表失败:",e)}}),{lockFn:B,isLock:N}=x(async()=>{try{const e=await pe();C.success(a("system-perms.permission.syncSuccess",{added:e.added,updated:e.updated,isDeprecated:e.deprecated,total:e.total})),await p()}catch(e){console.error("同步权限失败:",e)}}),{lockFn:R,isLock:z}=x(async()=>{try{const e=await me();C.success(a("system-perms.permission.cleanupSuccess",{removed:e.removed})),await p()}catch(e){console.error("清理权限失败:",e)}}),T=e=>{E.create(D).open({code:e})};return X(()=>p()),(e,s)=>{const n=ne,g=le,F=ce;return Y(),J("div",ge,[f("div",fe,[i(n,{modelValue:o(d).name,"onUpdate:modelValue":s[0]||(s[0]=r=>o(d).name=r),placeholder:o(a)("system-perms.permission.nameInput"),onChange:o(p)},null,8,["modelValue","placeholder","onChange"]),i(n,{modelValue:o(d).group,"onUpdate:modelValue":s[1]||(s[1]=r=>o(d).group=r),placeholder:o(a)("system-perms.permission.groupInput"),ui:{root:"max-w-xs w-full"},onChange:o(p)},null,8,["modelValue","placeholder","onChange"]),f("div",ye,[i(g,{codes:["permission:sync"]},{default:y(()=>[i(o(l),{color:"info",variant:"outline",label:o(a)("system-perms.permission.sync"),icon:"i-lucide-refresh-cw",loading:o(N),onClick:o(B)},null,8,["label","loading","onClick"])]),_:1}),i(g,{codes:["permission:cleanup"]},{default:y(()=>[i(o(l),{color:"warning",variant:"outline",label:o(a)("system-perms.permission.cleanup"),icon:"i-lucide-trash-2",loading:o(z),onClick:o(R)},null,8,["label","loading","onClick"])]),_:1}),i(o(k),{items:o(_)?.tableApi?.getAllColumns().filter(r=>r.getCanHide()).map(r=>({label:o(c)[r.id]||r.columnDef.header,type:"checkbox",checked:r.getIsVisible(),onUpdateChecked(v){o(_)?.tableApi?.getColumn(r.id)?.toggleVisibility(!!v)},onSelect(v){v?.preventDefault()}})),content:{align:"end"}},{default:y(()=>[i(o(l),{label:e.$t("console-common.showColumns"),color:"neutral",variant:"outline","trailing-icon":"i-lucide-chevron-down"},null,8,["label"])]),_:1},8,["items"]),i(g,{codes:["permission:list"]},{default:y(()=>[i(o(l),{icon:"i-lucide-list-filter",color:"primary",variant:"outline",onClick:o(p),loading:o(A)},{default:y(()=>[ee(V(o(a)("system-perms.permission.refresh")),1)]),_:1},8,["onClick","loading"])]),_:1})])]),i(F,{loading:o(A),data:o(m),columns:I,class:"shrink-0",ref_key:"table",ref:_,selectable:"",expanded:o(P),getSubRows:r=>r.children,ui:{base:"table-fixed border-separate border-spacing-0",thead:"[&>tr]:bg-elevated/50 [&>tr]:after:content-none",tbody:"[&>tr]:last:[&>td]:border-b-0",th:"py-2 first:rounded-l-lg last:rounded-r-lg border-y border-default first:border-l last:border-r",td:"border-b border-default",tr:"[&:has(>td[colspan])]:hidden"}},null,8,["loading","data","expanded","getSubRows"]),f("div",he,[f("div",_e,V(o(a)("system-perms.permission.totalCount",{count:o(m).length})),1),f("div",ve,[i(o(l),{size:"xs",color:"gray",variant:"ghost",label:o(a)("system-perms.permission.groupView"),icon:"i-lucide-layers",onClick:()=>{}},null,8,["label"])])])])}}});export{He as default};
