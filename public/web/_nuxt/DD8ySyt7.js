import{b7 as T,n as E,bg as D,a3 as V,ac as W,ct as P,l as v,q as Y,cu as G,a2 as O,ai as M,J as H,bi as h,a8 as I,cv as Q,cw as X,f as Z,o as ee,w as te,r as ae,v as re,C as ne,g as N,au as se,bk as ie,cx as oe}from"#entry";function le(t){return t.validate&&t.__isYupSchema__}function ue(t){return t.inner!==void 0}function ce(t){return"schema"in t&&typeof t.coercer=="function"&&typeof t.validator=="function"&&typeof t.refiner=="function"}function de(t){return t.validateAsync!==void 0&&t.id!==void 0}function fe(t){return t.isJoi===!0}function me(t){return"~standard"in t}async function pe(t,n){const s=await n["~standard"].validate(t);return s.issues?{errors:s.issues?.map(r=>({name:r.path?.map(o=>typeof o=="object"?o.key:o).join(".")||"",message:r.message}))||[],result:null}:{errors:null,result:s.value}}async function ye(t,n){try{return{errors:null,result:await n.validate(t,{abortEarly:!1})}}catch(s){if(ue(s))return{errors:s.inner.map(o=>({name:o.path??"",message:o.message})),result:null};throw s}}async function ve(t,n){const[s,r]=n.validate(t);return s?{errors:s.failures().map(b=>({message:b.message,name:b.path.join(".")})),result:null}:{errors:null,result:r}}async function he(t,n){try{return{errors:null,result:await n.validateAsync(t,{abortEarly:!1})}}catch(s){if(fe(s))return{errors:s.details.map(o=>({name:o.path.join("."),message:o.message})),result:null};throw s}}function we(t,n){if(me(n))return pe(t,n);if(de(n))return he(t,n);if(le(n))return ye(t,n);if(ce(n))return ve(t,n);throw new Error("Form validation failed: Unsupported form schema")}class w extends Error{formId;errors;children;constructor(n,s,r){super("Form validation exception"),this.formId=n,this.errors=s,this.children=r,Object.setPrototypeOf(this,w.prototype)}}const be={base:""},Se={__name:"Form",props:{id:{type:[String,Number],required:!1},schema:{type:null,required:!1},state:{type:Object,required:!0},validate:{type:Function,required:!1},validateOn:{type:Array,required:!1,default(){return["input","blur","change"]}},disabled:{type:Boolean,required:!1},validateOnInputDelay:{type:Number,required:!1,default:300},transform:{type:null,required:!1,default:()=>!0},attach:{type:Boolean,required:!1,default:!0},loadingAuto:{type:Boolean,required:!1,default:!0},class:{type:null,required:!1},onSubmit:{type:Function,required:!1}},emits:["submit","error"],setup(t,{expose:n,emit:s}){const r=t,o=s,b=T(),R=E(()=>D({extend:D(be),...b.ui?.form||{}})),d=r.id??V(),j=G(`form-${d}`),f=r.attach&&W(P,void 0);h(P,j);const q=v(new Map);Y(async()=>{j.on(async e=>{e.type==="attach"?q.value.set(e.formId,{validate:e.validate}):e.type==="detach"?q.value.delete(e.formId):r.validateOn?.includes(e.type)&&!u.value&&(e.type!=="input"?await m({name:e.name,silent:!0,nested:!1}):(e.eager||x.has(e.name))&&await m({name:e.name,silent:!0,nested:!1})),e.type==="blur"&&x.add(e.name),(e.type==="change"||e.type==="input"||e.type==="blur"||e.type==="focus")&&A.add(e.name),(e.type==="change"||e.type==="input")&&g.add(e.name)})}),M(()=>{j.reset()}),Y(async()=>{f&&(await H(),f.emit({type:"attach",validate:m,formId:d}))}),M(()=>{f&&f.emit({type:"detach",formId:d})});const i=v([]);h(ie,i);const F=v({});h(oe,F);const g=O(new Set),A=O(new Set),x=O(new Set);function _(e){return e.map(a=>({...a,id:a?.name?F.value[a.name]?.id:void 0}))}const B=v(null);async function C(){let e=r.validate?await r.validate(r.state)??[]:[];if(r.schema){const{errors:a,result:l}=await we(r.state,r.schema);a?e=e.concat(a):B.value=l}return _(e)}async function m(e={silent:!1,nested:!0,transform:!1}){const a=e.name&&!Array.isArray(e.name)?[e.name]:e.name,l=!a&&e.nested?Array.from(q.value.values()).map(({validate:p})=>p(e).then(()=>{}).catch(y=>{if(!(y instanceof w))throw y;return y})):[];if(a){const p=new Set(a),y=a.map(c=>F.value?.[c]?.pattern).filter(Boolean),K=c=>c.name?p.has(c.name)?!0:y.some(L=>L.test(c.name)):!1,z=await C(),U=i.value.filter(c=>!K(c)),$=z.filter(K);i.value=U.concat($)}else i.value=await C();const S=(await Promise.all(l)).filter(p=>p!==void 0);if(i.value.length+S.length>0){if(e.silent)return!1;throw new w(d,i.value,S)}return e.transform&&Object.assign(r.state,B.value),r.state}const u=v(!1);h(Q,I(u));async function k(e){u.value=r.loadingAuto&&!0;const a=e;try{a.data=await m({nested:!0,transform:r.transform}),await r.onSubmit?.(a),g.clear()}catch(l){if(!(l instanceof w))throw l;const S={...a,errors:l.errors,children:l.children};o("error",S)}finally{u.value=!1}}const J=E(()=>r.disabled||u.value);return h(X,E(()=>({disabled:J.value,validateOnInputDelay:r.validateOnInputDelay}))),n({validate:m,errors:i,setErrors(e,a){a?i.value=i.value.filter(l=>a instanceof RegExp?!(l.name&&a.test(l.name)):l.name!==a).concat(_(e)):i.value=_(e)},async submit(){await k(new Event("submit"))},getErrors(e){return e?i.value.filter(a=>e instanceof RegExp?a.name&&e.test(a.name):a.name===e):i.value},clear(e){e?i.value=i.value.filter(a=>e instanceof RegExp?!(a.name&&e.test(a.name)):a.name!==e):i.value=[]},disabled:J,loading:u,dirty:E(()=>!!g.size),dirtyFields:I(g),blurredFields:I(x),touchedFields:I(A)}),(e,a)=>(ee(),Z(se(N(f)?"div":"form"),{id:N(d),class:ne(R.value({class:r.class})),onSubmit:re(k,["prevent"])},{default:te(()=>[ae(e.$slots,"default",{errors:i.value,loading:u.value})]),_:3},40,["id","class"]))}};export{Se as _};
