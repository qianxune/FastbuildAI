const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Bu9SiL2T.js","./Cie-o9Wa.js","./Cgyg1gJC.js","./jsPNKUA0.js","./abPSHzII.js","./Ghlq83yM.js","./DQMjdCEn.js","./OUYfsp1i.js","./BFo3vNrE.js","./CuVAPZQ8.js","./Z7qkLoXK.js","./CjE5iPSn.js","./D9UsdH-b.js","./MCK2d4XT.js","./EK7Wbu3-.js"])))=>i.map(i=>d[i]);
import{d as P,i as q,at as K,k as G,aR as J,V as W,s as v,a2 as X,n as Q,p as Y,q as Z,ai as ee,c as _,o as c,t as n,w as p,x as a,B as te,z as f,g as s,_ as oe,f as C,A as se,ac as ae,y,F as ne,aS as le,D as ce,J as re,W as ie,X as de}from"#entry";import{_ as fe}from"./shdu-Ndv.js";import{_ as ue}from"./vMXLMQMq.js";import{_ as me,a as _e}from"./CMrwRwXe.js";import{_ as pe}from"./Cie-o9Wa.js";import{_ as ge}from"./mTXQFtMl.js";import{f as he}from"./Dm8J87dm.js";const xe={class:"flex h-full w-full flex-col"},ve={class:"flex items-center justify-between p-4"},ye={class:"flex items-center gap-3"},we={class:"text-lg font-semibold"},ke={class:"flex h-full min-h-0 flex-1 flex-col"},Ce={key:0,class:"flex h-full items-center justify-center"},Me={class:"text-muted-foreground flex items-center gap-2 text-sm"},Be={key:1,class:"flex h-full items-center justify-center"},be={class:"text-muted-foreground text-center"},Ae={class:"my-2 flex items-center gap-1"},Re={class:"text-muted-foreground flex-none text-xs"},Ee={key:1,class:"mt-2 flex items-center gap-1"},Ie={class:"text-muted-foreground flex-none text-xs"},Le=P({__name:"chat-record-modal",props:{open:{type:Boolean},recordId:{},agentId:{}},emits:["update:open"],setup(A,{emit:R}){const E=ie(()=>de(()=>import("./Bu9SiL2T.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]),import.meta.url)),u=A,I=R,{t:r}=q(),S=K(),m=G("scrollAreaRef"),{height:T}=J(m),$=W(),i=v([]),d=v(!1),g=X({page:1,pageSize:20}),h=v(!1),M=v(!0),z=ae("agents"),x=Q({get:()=>u.open,set:o=>I("update:open",o)}),w=o=>{const e=o.target,l=40;M.value=e.scrollHeight-(e.scrollTop+e.clientHeight)<=l},B=async(o=!1)=>{if(u.recordId){o&&(g.page=1,i.value=[]),d.value=!0;try{const e=await he(u.recordId,g),l=(e.items||[]).reverse();i.value=o?l:[...l,...i.value],h.value=e.total>i.value.length}catch(e){console.error("加载消息失败:",e)}finally{d.value=!1}}},V=async()=>{if(!(!h.value||d.value)){g.page++;try{await B(!1)}catch{g.page--,h.value=!0}}},k=async(o=!0)=>{await re(),console.log("scrollToBottom",m.value),m.value?.scrollToBottom(o)},U=o=>{$.create(E).open({context:o})};return Y(()=>[u.recordId,u.open],async([o,e])=>{e&&o&&(await B(!0),await k(!1))},{immediate:!0}),Z(()=>{const o=m.value?.getViewportElement()?.viewportElement;if(o){o.addEventListener("scroll",w,{passive:!0}),w({target:o});const e=new MutationObserver(()=>{M.value&&k(!1)});e.observe(o,{childList:!0,subtree:!0,characterData:!0}),ee(()=>{o.removeEventListener("scroll",w),e.disconnect()})}}),(o,e)=>{const l=te,D=oe,b=fe,L=le("KnowledgeReferenceFiles"),O=ue,j=_e,F=me,N=pe,H=ge;return c(),_("div",null,[n(H,{open:s(x),"onUpdate:open":e[2]||(e[2]=t=>ce(x)?x.value=t:null),"set-background-color-on-scale":!1,direction:"right","should-scale-background":"","handle-only":!0,class:"bg-muted w-full max-w-xl"},{content:p(()=>[a("div",xe,[a("div",ve,[a("div",ye,[n(l,{name:"i-lucide-message-circle",class:"text-primary size-5"}),a("h2",we,f(s(r)("ai-agent.backend.logs.dialogMessage")),1)]),n(D,{icon:"i-lucide-x",color:"neutral",variant:"ghost",onClick:e[0]||(e[0]=t=>x.value=!1)})]),a("div",ke,[s(d)&&s(i).length===0?(c(),_("div",Ce,[a("div",Me,[n(l,{name:"i-lucide-loader-2",class:"size-4 animate-spin"}),se(" "+f(s(r)("console-ai-agent.logs.loadingMessages")),1)])])):!s(d)&&s(i).length===0?(c(),_("div",Be,[a("div",be,[n(l,{name:"i-lucide-message-circle-x",class:"mx-auto mb-2 size-12"}),a("p",null,f(s(r)("console-ai-agent.logs.noMessages")),1)])])):(c(),C(N,{key:2,class:"h-full min-h-0 w-full",type:"auto",ref_key:"scrollAreaRef",ref:m,onInView:e[1]||(e[1]=t=>k(!1))},{default:p(()=>[n(F,{loading:s(d),"has-more":s(h),threshold:500,"content-class":"max-w-full w-full space-y-3 px-4",onLoadMore:V},{default:p(()=>[n(j,{messages:s(i),"scroll-area-height":s(T),assistant:{actions:[{label:s(r)("console-ai-agent.configuration.chatContext"),icon:"i-lucide-file-type",show:!s(z)?.value?.showContext,onClick:t=>{t?.metadata?.context?U(t.metadata.context):s(S).error(s(r)("console-ai-agent.configuration.noChatContext"))}}]},"spacing-offset":160},{content:p(({message:t})=>[t.content.length||t.metadata?.references&&t.metadata.references.length?(c(),C(O,{key:0,content:t.content.toString(),class:"mb-2"},{after:p(()=>[t.metadata?.references&&t.metadata.references.length>0&&t.role==="assistant"?(c(),_(ne,{key:0},[a("div",Ae,[a("span",Re,f(s(r)("console-ai-agent.configuration.referenceTitle")),1),t.metadata?.references&&t.metadata.references.length>0&&t.role==="assistant"?(c(),C(b,{key:0,size:"xs",type:"dashed"})):y("",!0)]),n(L,{references:t.metadata.references},null,8,["references"])],64)):y("",!0),t.metadata?.annotations&&t.role==="assistant"?(c(),_("div",Ee,[a("span",Ie,f(t.metadata?.annotations?.createdBy)+" "+f(s(r)("console-ai-agent.configuration.editedAnswer")),1),n(b,{size:"xs",type:"dashed"})])):y("",!0)]),_:2},1032,["content"])):y("",!0)]),_:1},8,["messages","scroll-area-height","assistant"])]),_:1},8,["loading","has-more"])]),_:1},512))])])]),_:1},8,["open"])])}}});export{Le as _};
