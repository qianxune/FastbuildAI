import{d as Q,at as L,aM as A,n as R,i as Y,aQ as T,aN as j,q as G,f as w,o as h,w as c,c as K,g as e,t as r,B as W,x as p,A as g,z as k,_ as X}from"#entry";import Z from"./cd55qm53.js";import{_ as ee}from"./D_3bTjYR.js";import oe from"./4jjeIyfe.js";import{_ as ae}from"./CvI6s-qz.js";import{_ as re}from"./Da83zglB.js";import{_ as te}from"./bvMLy1sv.js";import{_ as le}from"./DD8ySyt7.js";import{_ as se}from"./hsuWSsy6.js";import{_ as ie}from"./Ghlq83yM.js";import{b as ne,c as ce,d as de,e as me}from"./Cj1H12mz.js";import{c as E,b as U}from"./FTderXKt.js";import"./D9sX2Qi6.js";import"./CtosDvS0.js";import"./CAQVAH0V.js";import"./DNSLGqNg.js";import"./BFo3vNrE.js";import"./DeCyaT7k.js";import"./D4e4FYoF.js";import"./Z7qkLoXK.js";import"./BstbYvQo.js";import"./CuVAPZQ8.js";import"./9Q2Y_nd6.js";import"./td2xDKru.js";import"./RPflLnqr.js";import"./TrJvDfxI.js";import"./jsPNKUA0.js";import"./abPSHzII.js";import"./Deu6qIfg.js";import"./DMoqg0Fd.js";import"./kRIii9yh.js";import"./C6Y-ieo6.js";import"./BCcN9pii.js";import"./CMKSl-Ng.js";import"./psimjGaX.js";import"./DQMjdCEn.js";import"./OUYfsp1i.js";import"./CjE5iPSn.js";import"./D9UsdH-b.js";import"./MCK2d4XT.js";import"./EK7Wbu3-.js";import"./DaWZu8wl.js";const pe={key:0,class:"flex items-center justify-center",style:{height:"400px"}},ue={class:"flex flex-col gap-4 pb-2"},fe={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},be={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},ve={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},ke={class:"space-y-4"},_e={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},ge={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},ye={class:"py-4"},he={class:"bottom-0 z-10 flex justify-end gap-2 pt-4"},Ue={class:"pb-2"},$e={class:"flex flex-col gap-4 p-4"},Ve={class:"flex flex-col"},je={class:"flex w-fit flex-col items-start gap-2"},we={class:"flex w-full items-start gap-1 rounded-lg bg-blue-50 p-2 text-sm text-blue-800 dark:bg-blue-900/30 dark:text-blue-200"},xe={class:"bottom-0 z-10 flex justify-end gap-2 pt-4"},Se=`{
    "mcpServers": {
        "Your MCP Server Name": {
            "url": "xxxxx",
            // type: sse or streamable-http
            "type": "sse or streamable-http",
            "headers": {
                "Content-Type": "application/json",
                "Authorization": "Bearer Your Token"
                ...
            },
            ...
        }
    }
}`,_o=Q({__name:"edit",props:{id:{},isJsonImport:{type:Boolean}},emits:["close","change-update"],setup(x,{emit:N}){const $=L(),M=A(),O=x,f=N,v=R(()=>O.id||M.query.id||null),{t:o}=Y(),t=T({name:"",providerName:"",description:"",icon:"",isDisabled:!1,url:"",sortOrder:0,communicationType:void 0,isQuickMenu:!1,alias:"",providerUrl:"",customHeaders:""}),y=T({jsonImport:""}),z=E({name:U().required(o("ai-mcp.backend.form.name")),url:U().required(o("ai-mcp.backend.form.baseUrlPlaceholder")).test("is-valid-url",o("ai-mcp.backend.form.baseUrlPlaceholder"),s=>{if(!s)return!1;if(/^(https?:\/\/)?[\w\d-]+(\.[\w\d-]+)+([\w\d\-.,@?^=%&:/~+#]*[\w\d=#])?$/.test(s))return!0;try{return new URL(s),!0}catch{return!1}}),communicationType:U().required(o("ai-mcp.backend.form.communicationType"))}),C=E({jsonImport:U().required(o("ai-mcp.backend.validation.jsonRequired")).test("is-valid-json",o("ai-mcp.backend.validation.jsonFormatError"),s=>{if(!s)return!1;try{return JSON.parse(s),!0}catch{return!1}}).test("validate-required-fields",(s,a)=>{if(!s)return!0;try{const d=JSON.parse(s);if(!d.mcpServers||typeof d.mcpServers!="object")return a.createError({message:o("ai-mcp.backend.validation.missingMcpServers")});const i=d.mcpServers;if(Object.keys(i).length===0)return a.createError({message:o("ai-mcp.backend.validation.emptyMcpServers")});for(const[m,b]of Object.entries(i)){if(!b||typeof b!="object")return a.createError({message:`"${m}" ${o("ai-mcp.backend.validation.invalidConfig")}`});const u=b;if(!u.url)return a.createError({message:`"${m}" ${o("ai-mcp.backend.validation.missingUrl")}`});if(typeof u.url!="string")return a.createError({message:`"${m}" ${o("ai-mcp.backend.validation.invalidUrlType")}`});if(!u.type)return a.createError({message:`"${m}" ${o("ai-mcp.backend.validation.missingType")}`});if(typeof u.type!="string")return a.createError({message:`"${m}" ${o("ai-mcp.backend.validation.invalidTypeValue")}`});if(!["sse","streamable-http"].includes(u.type))return a.createError({message:`"${m}" ${o("ai-mcp.backend.validation.invalidTypeEnum")}`});if(u.headers!==void 0&&(typeof u.headers!="object"||u.headers===null))return a.createError({message:`"${m}" ${o("ai-mcp.backend.validation.invalidHeaders")}`})}return!0}catch{return a.createError({message:o("console-ai-mcp-server.validation.jsonFormatError")})}})}),{lockFn:D,isLock:F}=j(async()=>{try{const s=await ne(v.value);Object.keys(t).forEach(a=>{const d=a,i=s[d];if(i!==void 0)if(d==="customHeaders")if(typeof i=="object"&&i!==null){const n=Object.entries(i).map(([m,b])=>`${m}=${b}`).join(",");t[d]=n}else t[d]=i||"";else typeof i=="object"&&i!==null?Object.keys(i).length>0&&(t[d]=i):t[d]=i})}catch(s){console.error("获取供应商详情失败:",s)}}),q=s=>{if(!s?.trim())return{};const a={};return s.split(/[,\n]/).filter(i=>i.trim()).forEach(i=>{const[n,...m]=i.split("=");if(n?.trim()&&m.length>0){const b=m.join("=");a[n.trim()]=b.trim()}}),a},{lockFn:B,isLock:S}=j(async()=>{const{customHeaders:s,...a}=t,d=q(s),i={...a,customHeaders:d};try{let n="";v.value?(n=(await ce(v.value,i)).id,f("change-update",[n]),$.success(o("ai-mcp.backend.updateSuccess"))):(n=(await de(i)).id,f("change-update",[n]),$.success(o("ai-mcp.backend.createSuccess"))),f("close",!0)}catch(n){console.error("提交失败:",n)}}),{lockFn:H}=j(async()=>{try{const s=await me(y.jsonImport||"");$.success(`${o("ai-mcp.backend.jsonImportTotal")} ${s.total} ${o("ai-mcp.backend.jsonImportUnit")}，
            ${o("console-common.create")} ${s.created} ${o("ai-mcp.backend.jsonImportUnit")}，
            ${o("console-common.update")} ${s.updated} ${o("ai-mcp.backend.jsonImportUnit")}`);const a=s.results.map(d=>d.id);f("change-update",a),f("close",!0)}catch(s){console.error("JSON导入失败:",s)}});return G(async()=>v.value&&await D()),(s,a)=>{const d=W,i=Z,n=ee,m=oe,b=ae,u=re,V=te,_=X,I=le,P=se,J=ie;return h(),w(J,{title:e(v)?e(o)("ai-mcp.backend.editTitle"):e(o)("ai-mcp.backend.addTitle"),description:e(v)?e(o)("ai-mcp.backend.editTitle"):e(o)("ai-mcp.backend.addTitle"),ui:{content:"max-w-2xl overflow-y-auto h-fit"},"onUpdate:modelValue":a[15]||(a[15]=l=>!l&&f("close")),onClose:a[16]||(a[16]=l=>f("close"))},{default:c(()=>[e(F)?(h(),K("div",pe,[r(d,{name:"i-lucide-loader-2",class:"size-8 animate-spin"})])):x.isJsonImport?(h(),w(I,{key:2,state:e(y),schema:e(C),onSubmit:e(H)},{default:c(()=>[p("div",Ue,[r(n,{label:e(o)("ai-mcp.backend.form.jsonImport"),name:"jsonImport",required:""},{hint:c(()=>[r(P,{mode:"click","open-delay":0,"close-delay":0},{content:c(()=>[p("div",$e,[p("div",Ve,[p("div",je,[p("div",we,[r(d,{size:"20",name:"i-tabler-alert-circle"}),p("span",null,k(e(o)("ai-mcp.backend.jsonImportCorrectExample")),1)]),p("pre",{class:"bg-muted w-full overflow-x-auto rounded-lg p-4 text-sm"},[p("code",null,k(Se))])])])])]),default:c(()=>[r(_,{variant:"link",class:"text-primary cursor-pointer text-xs"},{default:c(()=>[g(k(e(o)("ai-mcp.backend.jsonImportExample")),1)]),_:1})]),_:1})]),default:c(()=>[r(m,{modelValue:e(y).jsonImport,"onUpdate:modelValue":a[13]||(a[13]=l=>e(y).jsonImport=l),placeholder:e(o)("ai-mcp.backend.form.jsonImportPlaceholder"),rows:13,ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),p("div",xe,[r(_,{color:"neutral",variant:"soft",size:"lg",onClick:a[14]||(a[14]=l=>f("close"))},{default:c(()=>[g(k(e(o)("console-common.cancel")),1)]),_:1}),r(_,{color:"primary",size:"lg",type:"submit",loading:e(S)},{default:c(()=>[g(k(e(v)?e(o)("console-common.update"):e(o)("console-common.create")),1)]),_:1},8,["loading"])])]),_:1},8,["state","schema","onSubmit"])):(h(),w(I,{key:1,state:e(t),schema:e(z),onSubmit:e(B)},{default:c(()=>[p("div",ue,[p("div",fe,[r(n,{label:e(o)("ai-mcp.backend.form.name"),name:"name",required:""},{default:c(()=>[r(i,{modelValue:e(t).name,"onUpdate:modelValue":a[0]||(a[0]=l=>e(t).name=l),placeholder:e(o)("ai-mcp.backend.form.name"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(n,{label:e(o)("ai-mcp.backend.form.alias"),name:"alias"},{default:c(()=>[r(i,{modelValue:e(t).alias,"onUpdate:modelValue":a[1]||(a[1]=l=>e(t).alias=l),placeholder:e(o)("ai-mcp.backend.form.alias"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),r(n,{label:e(o)("ai-mcp.backend.form.baseUrl"),name:"url",required:"",description:e(o)("ai-mcp.backend.form.baseUrlTips")},{default:c(()=>[r(m,{modelValue:e(t).url,"onUpdate:modelValue":a[2]||(a[2]=l=>e(t).url=l),placeholder:e(o)("ai-mcp.backend.form.baseUrlPlaceholder"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label","description"]),r(n,{label:e(o)("ai-mcp.backend.form.type"),name:"communicationType",required:""},{default:c(()=>[r(b,{modelValue:e(t).communicationType,"onUpdate:modelValue":a[3]||(a[3]=l=>e(t).communicationType=l),placeholder:e(o)("ai-mcp.backend.form.type"),ui:{base:"w-full"},items:[{label:"sse",value:"sse"},{label:"streamable-http",value:"streamable-http"}]},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(n,{label:e(o)("ai-mcp.backend.form.headers"),name:"headers"},{default:c(()=>[r(m,{modelValue:e(t).customHeaders,"onUpdate:modelValue":a[4]||(a[4]=l=>e(t).customHeaders=l),placeholder:e(o)("ai-mcp.backend.form.customHeadersPlaceholder"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),p("div",be,[r(n,{label:e(o)("ai-mcp.backend.form.providerName"),name:"providerName"},{default:c(()=>[r(i,{modelValue:e(t).providerName,"onUpdate:modelValue":a[5]||(a[5]=l=>e(t).providerName=l),placeholder:e(o)("ai-mcp.backend.form.providerName"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(n,{label:e(o)("ai-mcp.backend.form.providerUrl"),name:"providerUrl"},{default:c(()=>[r(i,{modelValue:e(t).providerUrl,"onUpdate:modelValue":a[6]||(a[6]=l=>e(t).providerUrl=l),placeholder:e(o)("ai-mcp.backend.form.providerUrl"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),p("div",ve,[r(n,{label:e(o)("ai-mcp.backend.form.icon"),name:"iconUrl"},{default:c(()=>[r(u,{modelValue:e(t).icon,"onUpdate:modelValue":a[7]||(a[7]=l=>e(t).icon=l),class:"h-24 w-24",text:"上传图标",icon:"i-lucide-upload",accept:".jpg,.png,.svg,.ico",maxCount:1,single:!0,multiple:!1},null,8,["modelValue"])]),_:1},8,["label"]),p("div",ke,[p("div",_e,[r(n,{label:e(o)("ai-mcp.backend.form.isDisabled"),name:"isDisabled"},{default:c(()=>[r(V,{"model-value":!e(t).isDisabled,"onUpdate:modelValue":a[8]||(a[8]=l=>e(t).isDisabled=!l),"unchecked-icon":"i-lucide-x","checked-icon":"i-lucide-check",size:"lg",label:e(t).isDisabled?e(o)("ai-mcp.backend.form.isActiveDisabled"):e(o)("ai-mcp.backend.form.isActiveEnabled")},null,8,["model-value","label"])]),_:1},8,["label"]),r(n,{label:e(o)("ai-mcp.backend.form.isQuickMenu"),name:"isQuickMenu"},{default:c(()=>[r(V,{"model-value":e(t).isQuickMenu,"onUpdate:modelValue":a[9]||(a[9]=l=>e(t).isQuickMenu=l),"unchecked-icon":"i-lucide-x","checked-icon":"i-lucide-check",size:"lg"},null,8,["model-value"])]),_:1},8,["label"])]),p("div",ge,[r(n,{label:e(o)("ai-mcp.backend.form.sortOrder"),name:"sortOrder"},{default:c(()=>[r(i,{modelValue:e(t).sortOrder,"onUpdate:modelValue":a[10]||(a[10]=l=>e(t).sortOrder=l),type:"number",placeholder:e(o)("ai-mcp.backend.form.sortOrder"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])])])])]),p("div",ye,[r(n,{label:e(o)("ai-mcp.backend.form.description"),name:"description"},{default:c(()=>[r(m,{modelValue:e(t).description,"onUpdate:modelValue":a[11]||(a[11]=l=>e(t).description=l),autoresize:"",placeholder:e(o)("ai-mcp.backend.form.descriptionPlaceholder"),rows:3,maxrows:8,ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),p("div",he,[r(_,{color:"neutral",variant:"soft",size:"lg",onClick:a[12]||(a[12]=l=>f("close"))},{default:c(()=>[g(k(e(o)("console-common.cancel")),1)]),_:1}),r(_,{color:"primary",size:"lg",type:"submit",loading:e(S)},{default:c(()=>[g(k(e(v)?e(o)("console-common.update"):e(o)("console-common.create")),1)]),_:1},8,["loading"])])]),_:1},8,["state","schema","onSubmit"]))]),_:1},8,["title","description"])}}});export{_o as default};
