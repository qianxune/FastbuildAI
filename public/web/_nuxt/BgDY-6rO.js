import{d as q,i as O,at as T,s as H,l as J,n as K,aN as k,q as Q,f as W,o as a,w as v,c as d,x as u,g as o,t as c,B as X,z as p,A as _,_ as Y,y as Z,F as V,E as z}from"#entry";import{_ as ee}from"./Y67jy4iF.js";import{_ as se}from"./Ghlq83yM.js";import{b as oe}from"./BdGWwroR.js";import{a as te,b as ie}from"./DPO6KOvV.js";import"./CjasYwqF.js";import"./CAQVAH0V.js";import"./DBEJUH-Z.js";import"./CuVAPZQ8.js";import"./CMKSl-Ng.js";import"./BCcN9pii.js";import"./CtosDvS0.js";import"./Deu6qIfg.js";import"./D9sX2Qi6.js";import"./DQMjdCEn.js";import"./OUYfsp1i.js";import"./BFo3vNrE.js";import"./Z7qkLoXK.js";import"./CjE5iPSn.js";import"./D9UsdH-b.js";import"./MCK2d4XT.js";import"./EK7Wbu3-.js";const ne={key:0,class:"flex items-center justify-center",style:{height:"544px"}},le={key:1},re={class:"mb-4 flex items-center justify-between"},ae={class:"text-muted-foreground text-sm"},ce={class:"flex gap-2"},me={class:"max-h-[40vh] overflow-y-auto"},de={class:"mb-2 flex items-center"},ue={class:"ml-6 grid grid-cols-1 gap-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4"},pe={key:0,class:"text-muted-foreground py-4 text-center"},fe={class:"mt-4 flex justify-end gap-2"},$e=q({__name:"assign-permissions",props:{id:{}},emits:["close"],setup(G,{emit:L}){const g=G,y=L,{t:n}=O(),x=T(),m=H([]),t=J([]),h=K(()=>m.value.flatMap(e=>e.permissions?.map(s=>s.id).filter(Boolean)??[]));function P(e){t.value.includes(e)||t.value.push(e)}function b(e){const s=t.value.indexOf(e);s!==-1&&t.value.splice(s,1)}function S(e){t.value.includes(e)?b(e):P(e)}function U(){t.value=[...h.value]}function A(){t.value=[]}function F(){t.value=h.value.filter(e=>!t.value.includes(e))}const{lockFn:I,isLock:C}=k(async()=>{try{const e=await oe({isDeprecated:!1,isGrouped:!0});m.value=e}catch(e){console.error("加载权限列表失败:",e)}}),{lockFn:N,isLock:w}=k(async()=>{if(g.id)try{const e=await te(g.id);t.value=e.permissions?.map(s=>s.id)??[]}catch(e){console.error("加载角色详情失败:",e)}}),{isLock:$,lockFn:D}=k(async()=>{if(!g.id){x.error(n("system-perms.role.roleIdRequired"));return}try{await ie({id:g.id,permissionIds:t.value}),x.success(n("system-perms.role.assignPermissionsSuccess")),y("close",!0)}catch(e){console.error("分配权限失败:",e)}});function M(e,s){const l=m.value.find(i=>i.code===e);l&&l.permissions.forEach(i=>{s?P(i.id):b(i.id)})}function R(e){const s=m.value.find(l=>l.code===e);return!s||!s.permissions.length?!1:s.permissions.every(l=>t.value.includes(l.id))}function j(e){const s=m.value.find(i=>i.code===e);if(!s||!s.permissions.length)return!1;const l=s.permissions.filter(i=>t.value.includes(i.id)).length;return l>0&&l<s.permissions.length}return Q(async()=>{await Promise.all([I(),N()])}),(e,s)=>{const l=X,i=Y,B=ee,E=se;return a(),W(E,{title:o(n)("system-perms.role.assignPermissions"),description:o(n)("system-perms.role.assignPermissionsDesc"),ui:{content:"max-w-3xl"},onClose:s[1]||(s[1]=r=>y("close",!1))},{default:v(()=>[o(w)||o(C)?(a(),d("div",ne,[c(l,{name:"i-lucide-loader-2",class:"size-8 animate-spin"})])):(a(),d("div",le,[u("div",re,[u("div",ae,p(o(n)("system-perms.role.totalPermissions",{count:o(h).length})),1),u("div",ce,[c(i,{size:"sm",color:"primary",variant:"soft",onClick:U},{default:v(()=>[_(p(o(n)("console-common.selectAll")),1)]),_:1}),c(i,{size:"sm",color:"info",variant:"soft",onClick:A},{default:v(()=>[_(p(o(n)("console-common.selectNone")),1)]),_:1}),c(i,{size:"sm",color:"info",variant:"soft",onClick:F},{default:v(()=>[_(p(o(n)("system-perms.role.invertSelection")),1)]),_:1})])]),u("div",me,[(a(!0),d(V,null,z(o(m),r=>(a(),d("div",{key:r.code,class:"mb-6"},[u("div",de,[c(B,{"model-value":R(r.code)?!0:j(r.code)?"indeterminate":!1,label:r.name,"onUpdate:modelValue":f=>M(r.code,f===!0)},null,8,["model-value","label","onUpdate:modelValue"])]),u("div",ue,[(a(!0),d(V,null,z(r.permissions,f=>(a(),d("div",{key:f.id,class:"flex items-center"},[c(B,{"model-value":o(t).includes(f.id),label:f.name,"onUpdate:modelValue":()=>S(f.id)},null,8,["model-value","label","onUpdate:modelValue"])]))),128))])]))),128)),o(m).length===0?(a(),d("div",pe,p(o(n)("system-perms.role.noPermissions")),1)):Z("",!0)])])),u("div",fe,[c(i,{color:"neutral",variant:"soft",size:"lg",onClick:s[0]||(s[0]=r=>y("close",!1))},{default:v(()=>[_(p(o(n)("console-common.cancel")),1)]),_:1}),c(i,{color:"primary",size:"lg",loading:o($),disabled:o(w)||o(C),onClick:o(D)},{default:v(()=>[_(p(o(n)("console-common.confirm")),1)]),_:1},8,["loading","disabled","onClick"])])]),_:1},8,["title","description"])}}});export{$e as default};
