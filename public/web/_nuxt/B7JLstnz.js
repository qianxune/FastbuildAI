const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CU7SWF6K.js","./Cgyg1gJC.js","./Ghlq83yM.js","./DQMjdCEn.js","./OUYfsp1i.js","./BFo3vNrE.js","./CuVAPZQ8.js","./Z7qkLoXK.js","./CjE5iPSn.js","./D9UsdH-b.js","./MCK2d4XT.js","./EK7Wbu3-.js","./CClQHGwT.js","./shWoA4ks.js","./BPj_g5mx.js","./CWLxgHOx.js","./o4ws_w_T.js","./B8dIIAdq.js","./Cie-o9Wa.js","./jsPNKUA0.js","./abPSHzII.js","./B0g9CpkI.js"])))=>i.map(i=>d[i]);
import{d as ce,a_ as de,i as me,at as ue,av as pe,j as fe,V as _e,a2 as he,b2 as xe,n as _,W as R,ai as be,c as l,g as s,x as r,y as u,t as d,z as n,F as A,f as P,w as h,D as ye,E as O,G as ve,_ as ge,b3 as Ie,X as V,o as i,A as C,B as ke,C as U}from"#entry";import{_ as we}from"./shdu-Ndv.js";import{_ as Pe}from"./o4ws_w_T.js";import{_ as Ce}from"./DO9M7gn1.js";import{_ as Se}from"./Co1Njv5N.js";import{P as Me}from"./CClQHGwT.js";import{b as j,c as Ee}from"./B0g9CpkI.js";import{a as Te,b as F}from"./D5Fk3VIb.js";import{u as Le}from"./B-cZF5FC.js";import"./CtosDvS0.js";import"./CuVAPZQ8.js";import"./BCcN9pii.js";import"./CMKSl-Ng.js";import"./DBEJUH-Z.js";import"./D9sX2Qi6.js";import"./CAQVAH0V.js";import"./Deu6qIfg.js";import"./BzLCLO6P.js";const Re={class:"h-full"},Ae={key:0,class:"flex h-full flex-col space-y-4 px-6 pt-6"},Ve={class:"flex flex-1 flex-col space-y-8 overflow-y-auto"},Ue={key:0,class:"bg-muted flex items-center justify-between rounded-lg p-4"},ze={class:"flex items-center gap-4"},Qe={class:"text-lg font-medium"},$e={class:"text-muted-foreground flex items-center gap-2 text-sm"},Be={key:1},De={class:"text-muted-foreground text-sm"},Oe={class:"text-primary flex items-center gap-1 text-xl font-bold"},je={class:"flex justify-center"},Fe={key:0,class:"text-primary text-xs font-normal"},Ne={key:1,class:"flex justify-center gap-5"},Ge=["onClick"],We={key:0,class:"absolute -top-4 left-0 rounded-tl-md rounded-br-md bg-[#352B00] px-2 py-0.5 text-xs text-[#FFE7B5]"},He={class:"text-sm font-medium"},Xe={class:"mb-3 flex items-baseline gap-1"},qe={class:"text-primary text-xl font-bold"},Je={key:0,class:"text-muted-foreground text-xs line-through"},Ke={class:"mb-3 flex items-start gap-1.5 text-xs"},Ye={key:0,class:"font-medium"},Ze={key:1,class:"text-muted-foreground"},et={class:"space-y-2"},tt={class:"text-muted-foreground"},st={key:1,class:"bg-primary absolute right-0 bottom-0 flex h-7 w-8 items-center justify-center rounded-tl-lg rounded-br-lg text-white"},rt={key:2,class:"text-muted-foreground py-8 text-center"},ot={class:"space-y-4"},nt={class:"text-lg font-medium"},at={class:"flex flex-row items-center justify-start gap-6"},it={class:"flex items-center gap-2"},lt={class:"flex items-center justify-between border-t pt-4"},ct={class:"text-sm"},dt={class:"text-muted-foreground"},mt={class:"flex items-center gap-4"},ut={key:0,class:"text-xl font-bold"},pt={key:1,class:"flex h-full w-full items-center justify-center p-20"},ft={class:"w-full max-w-md p-8 text-center"},_t={class:"mb-2 text-2xl font-bold"},ht={class:"text-muted-foreground text-sm"},zt=ce({__name:"member-center",async setup(xt){let y,z;const N=R(()=>V(()=>import("./CU7SWF6K.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]),import.meta.url)),G=R(()=>V(()=>import("./shWoA4ks.js"),__vite__mapDeps([13,1,14,3,4,5,6,7,8,9]),import.meta.url)),W=R(()=>V(()=>import("./CWLxgHOx.js"),__vite__mapDeps([15,1,16,14,17,18,19,20,2,3,4,5,6,7,8,9,10,11,21]),import.meta.url)),H=de(),{t:c}=me(),S=ue(),Q=pe(),x=fe(),M=_e(),t=he({orderInfo:null,plans:[],paymentMethods:[],selectedPlanIndex:0,selectedLevelIndex:0,selectedPaymentMethod:Me.WECHAT,membershipSuccess:!1,isQrCodeExpired:!1,membershipStatus:!1}),{start:$,clear:E}=Le(async e=>{try{if(!t.orderInfo?.orderId){e();return}(await Te({orderId:t.orderInfo.orderId,from:"membership"})).payState===1&&(e(),await T(),await x.getUser(),Z())}catch(a){console.error("Payment polling error:",a)}},{interval:3e3,maxWaitTime:12e4,stopCondition:()=>t.isQrCodeExpired,onEnded:()=>{t.membershipSuccess||(t.isQrCodeExpired=!0)}}),{data:p}=([y,z]=xe(()=>Ie("memberCenterInfo",()=>j(),{transform:e=>(t.paymentMethods=e.payWayList.map(a=>({value:a.payType,label:a.name,icon:a.logo})),t.plans=e.plans.filter(a=>a.status),t.membershipStatus=e.membershipStatus,e)})),y=await y,z(),y),T=async()=>{try{const e=await j();t.plans=e.plans.filter(a=>a.status)}catch(e){console.error("Failed to refresh member center info:",e)}},v=_(()=>t.plans.length===0?null:t.plans[t.selectedPlanIndex]),g=_(()=>v.value?.billing?v.value.billing.filter(e=>e.status&&e.level):[]),b=_(()=>g.value.length===0?null:g.value[t.selectedLevelIndex]),X=_(()=>t.plans.map(e=>({label:e.name,value:e.id,discount:e.label}))),I=_({get:()=>t.plans[t.selectedPlanIndex]?.id||"",set:e=>{const a=t.plans.findIndex(m=>m.id===e);a!==-1&&J(a)}}),q=_(()=>p.value?.userSubscription?new Date(p.value.userSubscription.endTime).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):""),J=e=>{t.selectedPlanIndex=e,t.selectedLevelIndex=0},K=e=>{t.selectedLevelIndex=e},Y=async()=>{try{if(!v.value||!b.value){S.error(c("membership.frontend.center.noOptionSelected"));return}const e=await Ee({planId:v.value.id,levelId:b.value.levelId,payType:t.selectedPaymentMethod});t.orderInfo=e;const a=await F({from:"membership",orderId:e.orderId,payType:t.selectedPaymentMethod});D(a),t.isQrCodeExpired=!1,t.membershipSuccess=!1,$()}catch(e){console.error("Subscribe failed:",e)}},B=M.create(N),D=async e=>{await B.open({prepaidData:e,orderInfo:t.orderInfo,isQrCodeExpired:t.isQrCodeExpired,onRefreshQrCode:()=>ee()}).result&&(E(),t.isQrCodeExpired=!1,S.warning(c("membership.frontend.center.cancelPay")))},Z=async()=>{const a=M.create(G).open();B.close();const m=await a.result;await T(),m&&Q.push(`/profile/${x.userInfo?.id}/purchase-record`)},ee=async()=>{try{if(E(),!t.orderInfo?.orderId){console.error("Order ID does not exist"),S.error(c("membership.frontend.center.orderNotFound"));return}const e=await F({from:"membership",orderId:t.orderInfo.orderId,payType:t.selectedPaymentMethod});D(e),t.isQrCodeExpired=!1,t.membershipSuccess=!1,$()}catch(e){console.error("Failed to refresh QR code:",e)}},te=async()=>{await M.create(W).open().result&&T()},se=()=>{window.open("/agreement?type=agreement&item=payment","_blank")},re=()=>{Q.push(`/profile/${x.userInfo?.id}/power-detail`)};return be(()=>{E()}),(e,a)=>{const m=ve,oe=we,ne=Pe,f=ke,ae=Ce,ie=Se,L=ge;return i(),l("div",Re,[s(t).membershipStatus?(i(),l("div",Ae,[r("div",Ve,[s(p)?.userSubscription?(i(),l("div",Ue,[r("div",ze,[d(m,{src:s(x).userInfo.avatar,size:"3xl"},null,8,["src"]),r("div",null,[r("div",Qe,[r("span",null,n(s(x).userInfo.nickname||s(c)("user.frontend.profile.notSet")),1)]),r("div",$e,[s(p)?.userSubscription?(i(),l(A,{key:0},[r("span",null,n(s(p).userSubscription.level?.name),1),d(oe,{orientation:"vertical",class:"h-3"}),r("span",null,n(s(c)("membership.frontend.center.expireAt",{time:s(q)})),1),s(p).userSubscription.isExpired?(i(),P(ne,{key:0,color:"error",size:"xs"},{default:h(()=>[C(n(s(c)("membership.frontend.center.expired")),1)]),_:1})):u("",!0)],64)):(i(),l("span",Be,n(s(c)("membership.frontend.center.normalUser")),1)),r("div",{class:"text-primary cursor-pointer pl-4",onClick:te},n(s(c)("membership.frontend.center.subscriptionManagement")),1)])])]),r("div",{class:"flex cursor-pointer items-center gap-1 text-right",onClick:re},[r("div",null,[r("div",De,n(s(c)("membership.frontend.center.myPower")),1),r("div",Oe,[d(f,{name:"i-lucide-sparkles",class:"text-lg"}),r("div",null,n(s(p)?.user.power||0),1),d(f,{name:"i-lucide-chevron-right",class:"text-muted-foreground"})])])])])):u("",!0),r("div",je,[d(ae,{modelValue:s(I),"onUpdate:modelValue":a[0]||(a[0]=o=>ye(I)?I.value=o:null),items:s(X),content:!1,variant:"pill",ui:{label:"text-muted-foreground dark:text-white px-2",list:"gap-4 rounded-full",indicator:"rounded-full bg-white dark:bg-black font-extrabold",trigger:"px-2 py-1.5 text-sm font-normal data-[state=active]:font-extrabold"}},{default:h(({item:o})=>[r("div",{class:U(["flex items-center gap-2",{"text-primary":o.value===s(I)}])},[r("span",null,n(o.label),1),o.discount?(i(),l("span",Fe,n(o.discount),1)):u("",!0)],2)]),_:1},8,["modelValue","items"])]),s(g).length>0?(i(),l("div",Ne,[(i(!0),l(A,null,O(s(g),(o,k)=>(i(),l("div",{key:o.levelId,class:U(["border-muted relative max-h-90 w-60 cursor-pointer rounded-xl border bg-white p-5 transition-all duration-200 dark:bg-gray-900/5",[s(t).selectedLevelIndex===k?"border-primary shadow-primary/10 shadow-lg":"hover:border-primary border-muted"]]),onClick:w=>K(k)},[o.label?(i(),l("div",We,n(o.label),1)):u("",!0),r("div",{class:U(["mb-3 flex items-center gap-1.5",{"pt-1":k===0}])},[d(m,{src:o.level?.icon,size:"xs"},null,8,["src"]),r("span",He,n(o.level?.name),1)],2),r("div",Xe,[r("span",qe," ¥"+n(o.salesPrice),1),o.originalPrice!==o.salesPrice&&o.originalPrice?(i(),l("span",Je," ¥"+n(o.originalPrice)+"/月 ",1)):u("",!0)]),r("div",Ke,[o.level?.givePower?(i(),P(f,{key:0,name:"i-lucide-zap",class:"text-primary mt-0.5 shrink-0"})):u("",!0),r("div",null,[o.level?.givePower?(i(),l("div",Ye,n(s(c)("membership.frontend.center.givePower",{power:o.level.givePower})),1)):u("",!0),o.level?.description?(i(),l("div",Ze,n(o.level.description),1)):u("",!0)])]),r("div",et,[(i(!0),l(A,null,O(o.level?.benefits||[],(w,le)=>(i(),l("div",{key:le,class:"flex items-center gap-1.5 text-xs"},[w.icon?(i(),P(m,{key:1,src:w.icon,size:"3xs",class:"text-muted-foreground shrink-0"},null,8,["src"])):(i(),P(f,{key:0,name:"i-lucide-check",class:"text-muted-foreground shrink-0",size:"16"})),r("span",tt,n(w.content),1)]))),128))]),s(t).selectedLevelIndex===k?(i(),l("div",st,[d(f,{name:"i-lucide-check",class:"text-sm"})])):u("",!0)],10,Ge))),128))])):(i(),l("div",rt,n(s(c)("membership.frontend.center.noLevelsAvailable")),1)),r("div",ot,[r("h2",nt,n(s(c)("membership.frontend.center.paymentMethod")),1),r("div",at,[d(ie,{modelValue:s(t).selectedPaymentMethod,"onUpdate:modelValue":a[1]||(a[1]=o=>s(t).selectedPaymentMethod=o),orientation:"horizontal",variant:"card",color:"primary",items:s(t).paymentMethods},{label:h(({item:o})=>[r("div",it,[d(m,{src:o?.icon,size:"2xs"},null,8,["src"]),r("span",null,n(o?.label),1)])]),_:1},8,["modelValue","items"])])])]),r("div",lt,[r("div",ct,[r("span",dt,n(s(c)("membership.frontend.center.agreement")),1),d(L,{variant:"link",class:"p-0",onClick:se},{default:h(()=>[C(" 《"+n(s(H).siteConfig?.agreement.paymentTitle||s(c)("membership.frontend.center.paymentAgreement"))+"》 ",1)]),_:1})]),r("div",mt,[s(b)?(i(),l("div",ut," ¥"+n(s(b).salesPrice),1)):u("",!0),d(L,{color:"primary",size:"lg",disabled:!s(b),loadingAuto:"",onClick:Y},{default:h(()=>[C(n(s(c)("membership.frontend.center.subscribe")),1)]),_:1},8,["disabled"])])])])):(i(),l("div",pt,[r("div",ft,[d(f,{name:"i-lucide-lock",class:"text-primary mx-auto mb-4 text-4xl"}),r("h1",_t,n(s(c)("membership.frontend.center.notOpen")),1),r("p",ht,n(s(c)("membership.frontend.center.notOpenTip")),1),d(L,{class:"mt-6",icon:"i-tabler-arrow-left",variant:"soft",onClick:a[2]||(a[2]=o=>e.$router.back())},{default:h(()=>[C(n(s(c)("membership.frontend.center.back")),1)]),_:1})])]))])}}});export{zt as default};
