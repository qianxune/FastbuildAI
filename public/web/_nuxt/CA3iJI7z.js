import D from"./cd55qm53.js";import{_ as G}from"./D_3bTjYR.js";import{_ as H}from"./Co1Njv5N.js";import{_ as Q}from"./CvI6s-qz.js";import{d as Y,i as J,l as f,n as h,p as W,aN as X,q as Z,c as ee,o as x,t as s,w as r,f as le,y as oe,x as d,g as e,v as ae,z as v,_ as se,A as C}from"#entry";import{_ as re}from"./bvMLy1sv.js";import{_ as ie}from"./JxyxsHxp.js";import{_ as te}from"./B5gsc-Ax.js";import{_ as ne}from"./DD8ySyt7.js";import{a as me}from"./B9ZIqvFb.js";import{M as c}from"./Bk5k3yMa.js";import{c as de,e as ce,b as ue}from"./FTderXKt.js";import"./D9sX2Qi6.js";import"./CtosDvS0.js";import"./CAQVAH0V.js";import"./BCcN9pii.js";import"./CMKSl-Ng.js";import"./Deu6qIfg.js";import"./DBEJUH-Z.js";import"./CuVAPZQ8.js";import"./DNSLGqNg.js";import"./BFo3vNrE.js";import"./DeCyaT7k.js";import"./D4e4FYoF.js";import"./Z7qkLoXK.js";import"./BstbYvQo.js";import"./DaWZu8wl.js";const pe={class:"flex-1"},be={class:"flex items-center gap-2"},fe={class:"w-full"},he={class:"flex justify-center"},ve={class:"flex justify-center"},ge={class:"text-muted-foreground flex items-center justify-center py-8 text-sm"},_e={class:"bg-background sticky bottom-0 flex gap-3 py-4"},He=Y({__name:"plan-form",props:{id:{},initialData:{}},emits:["submit-success"],setup(P,{emit:k}){const{t:l}=J(),g=P,$=k,L=[{value:c.MONTH,label:l("membership.console-membership.plan.duration.month")},{value:c.QUARTER,label:l("membership.console-membership.plan.duration.quarter")},{value:c.YEAR,label:l("membership.console-membership.plan.duration.year")},{value:c.FOREVER,label:l("membership.console-membership.plan.duration.forever")},{value:c.CUSTOM,label:l("membership.console-membership.plan.duration.custom")}],z=[{value:"day",label:"天"},{value:"month",label:"月"},{value:"year",label:"年"}],t=f({duration:{value:1,unit:"day"}}),_=f([]),V=h(()=>!!g.id),O=h(()=>_.value.map(o=>({label:o.name,value:o.id}))),B=o=>{const i=u.value.map(n=>n.levelId).filter(n=>n&&n!==o);return O.value.map(n=>({...n,disabled:i.includes(n.value)}))},u=f([]),I=[{accessorKey:"levelId",header:l("membership.console-membership.level.form.labelName")},{accessorKey:"salesPrice",header:l("membership.console-membership.plan.form.priceSales")},{accessorKey:"originalPrice",header:l("membership.console-membership.plan.form.priceOriginal")},{accessorKey:"label",header:l("membership.console-membership.plan.form.labelTag")},{accessorKey:"status",header:l("membership.console-membership.plan.form.status")},{accessorKey:"action",header:l("membership.console-membership.plan.table.actions")}],N=async()=>{try{const o=await me({page:1,pageSize:100});_.value=o.items||[]}catch(o){console.error("Failed to fetch level list:",o)}};W(()=>g.initialData,o=>{o&&Object.keys(o).length>0&&(t.value={...t.value,...o,duration:o.duration?{...o.duration}:{value:1,unit:"day"}},u.value=o.billing?[...o.billing]:[])},{immediate:!0});const S=()=>{u.value.push({levelId:"",salesPrice:0,originalPrice:0,label:"",status:!0})},M=de({name:ue().required(l("membership.console-membership.plan.form.labelNamePlaceholder")),durationConfig:ce().required(l("membership.console-membership.plan.form.labelDurationConfig"))}),F=o=>{const i=[];return o.durationConfig===c.CUSTOM&&(!o.duration?.value||o.duration.value<1)&&i.push({name:"duration.value",message:l("membership.console-membership.plan.form.durationValuePlaceholder")}),i},R=o=>{u.value.splice(o,1)},y=h(()=>t.value.durationConfig===c.CUSTOM),{lockFn:T,isLock:q}=X(async()=>{try{const o={...t.value,duration:y.value?t.value.duration:void 0,billing:u.value};$("submit-success",o)}catch(o){console.error("Update plan failed:",o)}});return Z(()=>{N()}),(o,i)=>{const n=D,p=G,E=H,U=Q,b=se,K=re,w=ie,A=te,j=ne;return x(),ee("div",pe,[s(j,{state:e(t),schema:e(M),validate:F,class:"flex h-full flex-col space-y-4",onSubmit:e(T)},{default:r(()=>[s(p,{label:e(l)("membership.console-membership.plan.form.labelName"),name:"name",required:"",class:"sm:w-sm"},{default:r(()=>[s(n,{class:"w-full",modelValue:e(t).name,"onUpdate:modelValue":i[0]||(i[0]=a=>e(t).name=a),placeholder:e(l)("membership.console-membership.plan.form.labelNamePlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(p,{label:e(l)("membership.console-membership.plan.form.labelLabel"),name:"label",class:"sm:w-sm"},{default:r(()=>[s(n,{class:"w-full",modelValue:e(t).label,"onUpdate:modelValue":i[1]||(i[1]=a=>e(t).label=a),placeholder:e(l)("membership.console-membership.plan.form.labelLabelPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(p,{label:e(l)("membership.console-membership.plan.form.labelDurationConfig"),name:"durationConfig",required:""},{default:r(()=>[s(E,{modelValue:e(t).durationConfig,"onUpdate:modelValue":i[2]||(i[2]=a=>e(t).durationConfig=a),items:L,orientation:"horizontal"},null,8,["modelValue"])]),_:1},8,["label"]),e(y)?(x(),le(p,{key:0,name:"duration.value",class:"sm:w-sm"},{default:r(()=>[d("div",be,[s(n,{class:"flex-1",modelValue:e(t).duration.value,"onUpdate:modelValue":i[5]||(i[5]=a=>e(t).duration.value=a),type:"number",placeholder:e(l)("membership.console-membership.plan.form.durationValuePlaceholder"),autocomplete:"off",ui:{root:"w-full",trailing:"bg-muted-foreground/15 pl-2 rounded-tr-lg rounded-br-lg",base:"!pr-22"}},{trailing:r(()=>[d("div",{class:"flex items-center text-sm",onClick:i[4]||(i[4]=ae(()=>{},["stop","prevent"]))},[s(U,{modelValue:e(t).duration.unit,"onUpdate:modelValue":i[3]||(i[3]=a=>e(t).duration.unit=a),items:z,size:"sm",ui:{base:"!ring-0 !bg-muted-foreground/1",content:"z-999"}},null,8,["modelValue"])])]),_:1},8,["modelValue","placeholder"])])]),_:1})):oe("",!0),s(p,{label:e(l)("membership.console-membership.plan.form.labelBilling"),name:"billing"},{hint:r(()=>[s(b,{color:"primary",variant:"soft",size:"sm",icon:"i-lucide-plus",onClick:S},{default:r(()=>[C(v(e(l)("membership.console-membership.plan.form.addBilling")),1)]),_:1})]),default:r(()=>[d("div",fe,[s(w,{columns:I,data:e(u),ui:{base:"table-fixed border-separate border-spacing-0",thead:"[&>tr]:bg-elevated/50 [&>tr]:after:content-none",tbody:"[&>tr]:last:[&>td]:border-b-0",th:"py-2 first:rounded-l-lg last:rounded-r-lg border-y border-default first:border-l last:border-r",td:"border-b border-default px-2",tr:"[&:has(>td[colspan])]:hidden"}},{"levelId-cell":r(({row:a})=>[s(U,{modelValue:a.original.levelId,"onUpdate:modelValue":m=>a.original.levelId=m,items:B(a.original.levelId),placeholder:e(l)("membership.console-membership.plan.form.selectLevelPlaceholder"),size:"sm",class:"w-full"},null,8,["modelValue","onUpdate:modelValue","items","placeholder"])]),"salesPrice-cell":r(({row:a})=>[s(n,{modelValue:a.original.salesPrice,"onUpdate:modelValue":m=>a.original.salesPrice=m,type:"number",placeholder:e(l)("membership.console-membership.plan.form.inputPlaceholder"),size:"sm",class:"w-full"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),"originalPrice-cell":r(({row:a})=>[s(n,{modelValue:a.original.originalPrice,"onUpdate:modelValue":m=>a.original.originalPrice=m,type:"number",placeholder:"请输入",size:"sm",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),"label-cell":r(({row:a})=>[s(n,{modelValue:a.original.label,"onUpdate:modelValue":m=>a.original.label=m,placeholder:e(l)("membership.console-membership.plan.form.inputPlaceholder"),size:"sm",class:"w-full"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),"status-cell":r(({row:a})=>[d("div",he,[s(K,{modelValue:a.original.status,"onUpdate:modelValue":m=>a.original.status=m},null,8,["modelValue","onUpdate:modelValue"])])]),"action-cell":r(({row:a})=>[d("div",ve,[s(b,{color:"error",variant:"ghost",size:"xs",icon:"i-lucide-trash-2",onClick:m=>R(a.index)},null,8,["onClick"])])]),empty:r(()=>[d("div",ge,v(e(l)("membership.console-membership.plan.form.emptyBilling")),1)]),_:1},8,["data"])])]),_:1},8,["label"]),d("div",_e,[s(A,{codes:e(V)?["levels:update"]:["levels:create"]},{default:r(()=>[s(b,{color:"primary",size:"lg",type:"submit",loading:e(q)},{default:r(()=>[C(v(e(V)?e(l)("console-common.save"):e(l)("console-common.create")),1)]),_:1},8,["loading"])]),_:1},8,["codes"])])]),_:1},8,["state","schema","onSubmit"])])}}});export{He as default};
