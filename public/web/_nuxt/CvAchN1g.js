const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ynz6unPG.js","./DBiaUVBh.js","./Cgyg1gJC.js","./Ghlq83yM.js","./DQMjdCEn.js","./OUYfsp1i.js","./BFo3vNrE.js","./CuVAPZQ8.js","./Z7qkLoXK.js","./CjE5iPSn.js","./D9UsdH-b.js","./MCK2d4XT.js","./EK7Wbu3-.js","./CnGIiRp6.js","./CSy6ZCzT.js"])))=>i.map(i=>d[i]);
import{d as E,i as G,at as j,V as q,s as H,aQ as Q,h as p,G as W,_ as X,l as Y,n as J,p as Z,q as ee,c as h,o as y,x as n,t as l,F as te,E as oe,w as m,z as d,g as e,bD as x,y as ae,A as re,W as se,X as ne}from"#entry";import{_ as le}from"./DBiaUVBh.js";import{_ as ie}from"./CBTz8tdX.js";import{_ as de}from"./BPj_g5mx.js";import ce from"./cd55qm53.js";import{_ as me}from"./B4OpYolY.js";import{_ as pe}from"./CvI6s-qz.js";import{_ as ue}from"./o4ws_w_T.js";import{_ as be}from"./JxyxsHxp.js";import{_ as fe}from"./o0-e7Rye.js";import{b as he,c as ye,a as ge}from"./CnGIiRp6.js";import{u as _e}from"./BlyoSzaa.js";import{u as ke}from"./ZDOPDbaX.js";import{u as ve}from"./CSy6ZCzT.js";import"./DMoqg0Fd.js";import"./CtosDvS0.js";import"./kRIii9yh.js";import"./DNSLGqNg.js";import"./Z7qkLoXK.js";import"./C6Y-ieo6.js";import"./BFo3vNrE.js";import"./DeCyaT7k.js";import"./D4e4FYoF.js";import"./BCcN9pii.js";import"./CMKSl-Ng.js";import"./CuVAPZQ8.js";import"./psimjGaX.js";import"./B3rWqoNg.js";import"./EK7Wbu3-.js";import"./C5Ha_WGa.js";import"./hsuWSsy6.js";import"./Cie-o9Wa.js";import"./jsPNKUA0.js";import"./abPSHzII.js";import"./MCK2d4XT.js";import"./CAQVAH0V.js";import"./BstbYvQo.js";const xe={class:"flex h-full flex-col space-y-4 pb-6"},Se={class:"grid grid-cols-2 gap-4 pt-px md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5"},we={class:"flex items-center justify-center"},Ve={class:"flex flex-col items-center"},Ae={class:"text-2xl font-bold"},Te={class:"text-muted-foreground ml-1 text-sm"},Ke={class:"text-muted-foreground text-sm"},Ue={class:"flex flex-wrap items-center gap-4"},Ce={class:"flex flex-col items-start"},Ne={class:"flex flex-col items-center"},Oe={key:0,class:"text-muted-foreground mb-1 flex justify-center text-xs font-medium"},Re={class:"flex items-center justify-end gap-4"},De={class:"text-muted-foreground text-sm"},_t=E({__name:"order-membership",setup(Ie){const S=se(()=>ne(()=>import("./ynz6unPG.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]),import.meta.url)),w=le,g=X,V=ie,A=W,{t}=G(),{hasAccessByCodes:_}=_e(),T=j(),K=q(),k=H({totalAmount:0,totalIncome:0,totalOrder:0,totalRefundAmount:0,totalRefundOrder:0}),U=[{key:"totalOrder",unit:"console-common.unit",label:"order.backend.membership.orderCount"},{key:"totalAmount",unit:"console-common.yuan",label:"order.backend.membership.totalAmount"},{key:"totalRefundOrder",unit:"console-common.unit",label:"order.backend.membership.refundCount"},{key:"totalRefundAmount",unit:"console-common.yuan",label:"order.backend.membership.totalRefundAmount"},{key:"totalIncome",unit:"console-common.yuan",label:"order.backend.membership.netIncome"}],s=Q({userKeyword:"",orderNo:"",payType:void 0,payState:void 0,refundState:void 0,startTime:void 0,endTime:void 0}),{paging:i,getLists:c,resetPage:u}=ke({fetchFun:he,params:s}),C=[{accessorKey:"orderNo",header:t("order.backend.membership.list.orderNo")},{accessorKey:"user",header:t("order.backend.membership.list.user"),cell:({row:o})=>p("div",{class:"flex items-center gap-2"},[p(A,{src:o.original.user.avatar}),o.original.user.nickname])},{accessorKey:"plan",header:t("order.backend.membership.list.planName"),cell:({row:o})=>o.original.plan?.name||"-"},{accessorKey:"level",header:t("order.backend.membership.list.levelName"),cell:({row:o})=>o.original.level?.name||"-"},{accessorKey:"duration",header:t("order.backend.membership.list.duration")},{accessorKey:"orderAmount",header:t("order.backend.membership.list.orderAmount"),cell:({row:o})=>{const a=Number.parseFloat(o.getValue("orderAmount"));return new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(a)}},{accessorKey:"payState",header:t("order.backend.membership.list.paymentStatus")},{accessorKey:"createdAt",header:({column:o})=>{const a=o.getIsSorted();return p(g,{color:"neutral",variant:"ghost",label:t("order.backend.membership.list.createdAt"),icon:a?a==="asc"?"i-lucide-arrow-up-narrow-wide":"i-lucide-arrow-down-wide-narrow":"i-lucide-arrow-up-down",class:"-mx-2.5",onClick:()=>o.toggleSorting(o.getIsSorted()==="asc")})},cell:({row:o})=>{const a=o.getValue("createdAt");return p(w,{datetime:a,mode:"datetime"})}},{accessorKey:"actions",header:()=>t("order.backend.membership.list.actions"),size:40,enableSorting:!1,enableHiding:!0}],N=async o=>{await ve({title:t("order.backend.membership.list.refund"),description:t("console-common.confirmRefund"),color:"warning"}),await ge(o||""),c(),T.success(t("console-common.refundSuccess"))};function O(o){return[_(["membership-order:detail"])?{label:t("order.backend.membership.list.viewDetails"),icon:"i-lucide-eye",color:"info",onClick:()=>{I(o.original.id)}}:null,o.original.payState===1&&_(["membership-order:refund"])&&o.original.refundStatus===0?{label:t("order.backend.membership.list.refund"),icon:"tabler:arrow-back",color:"error",onSelect(){N(o.original.id)}}:null].filter(Boolean)}const R=Y({left:[],right:["actions"]}),D=J(()=>{const o=i.extend?.payTypeLists||[];return[{label:t("console-common.all"),value:"all"},...o.map(a=>({label:a.name,value:a.payType}))]});Z(()=>i.extend,o=>{o?.statistics&&(k.value=o.statistics)},{deep:!0});const I=async o=>{if(o)try{const a=await ye(o);$(a)}catch(a){console.error(a)}},$=o=>{K.create(S).open({order:o,"onGet-list":()=>{c()},onClose:()=>{}})},b=()=>{s.payType==="all"&&(s.payType=void 0),s.payState==="all"&&(s.payState=void 0),s.refundState==="all"&&(s.refundState=void 0),u()};return ee(()=>c()),(o,a)=>{const M=de,v=ce,B=me,f=pe,P=ue,F=be,L=fe;return y(),h("div",xe,[n("div",Se,[(y(),h(te,null,oe(U,(r,z)=>l(M,{key:z},{default:m(()=>[n("div",we,[n("div",Ve,[n("div",null,[n("span",Ae,d(e(k)[r.key]),1),n("span",Te,d(e(t)(r.unit)),1)]),n("span",Ke,d(e(t)(r.label)),1)])])]),_:2},1024)),64))]),n("div",Ue,[l(v,{modelValue:e(s).userKeyword,"onUpdate:modelValue":a[0]||(a[0]=r=>e(s).userKeyword=r),placeholder:e(t)("order.backend.membership.search.userKeyword"),class:"w-48",onKeyup:x(e(u),["enter"])},null,8,["modelValue","placeholder","onKeyup"]),l(v,{modelValue:e(s).orderNo,"onUpdate:modelValue":a[1]||(a[1]=r=>e(s).orderNo=r),placeholder:e(t)("order.backend.membership.search.orderNo"),class:"w-48",onKeyup:x(e(u),["enter"])},null,8,["modelValue","placeholder","onKeyup"]),l(B,{class:"ml-auto",start:e(s).startTime,"onUpdate:start":a[2]||(a[2]=r=>e(s).startTime=r),end:e(s).endTime,"onUpdate:end":a[3]||(a[3]=r=>e(s).endTime=r),"show-time":!0,ui:{root:"w-auto sm:w-xs"},onChange:e(c)},null,8,["start","end","onChange"]),l(f,{modelValue:e(s).payType,"onUpdate:modelValue":[a[4]||(a[4]=r=>e(s).payType=r),b],items:e(D),placeholder:e(t)("order.backend.membership.search.payType"),class:"w-36"},null,8,["modelValue","items","placeholder"]),l(f,{modelValue:e(s).payState,"onUpdate:modelValue":[a[5]||(a[5]=r=>e(s).payState=r),b],items:[{label:e(t)("console-common.all"),value:"all"},{label:e(t)("order.backend.membership.detail.paid"),value:1},{label:e(t)("order.backend.membership.detail.unpaid"),value:0}],placeholder:e(t)("order.backend.membership.search.payState"),class:"w-36"},null,8,["modelValue","items","placeholder"]),l(f,{modelValue:e(s).refundState,"onUpdate:modelValue":[a[6]||(a[6]=r=>e(s).refundState=r),b],items:[{label:e(t)("console-common.all"),value:"all"},{label:e(t)("order.backend.membership.search.refunded"),value:1},{label:e(t)("order.backend.membership.search.notRefunded"),value:0}],placeholder:e(t)("order.backend.membership.search.refundState"),class:"w-36"},null,8,["modelValue","items","placeholder"])]),l(F,{data:e(i).items,columns:C,loading:e(i).loading,"column-pinning":e(R),sticky:"",ui:{base:"table-fixed border-separate border-spacing-0",thead:"[&>tr]:bg-elevated/50 [&>tr]:after:content-none",tbody:"[&>tr]:last:[&>td]:border-b-0",th:"py-2 first:rounded-l-lg last:rounded-r-lg border-y border-default first:border-l last:border-r",td:"border-b border-default",tr:"[&:has(>td[colspan])]:hidden"},class:"flex-1"},{"payState-cell":m(({row:r})=>[n("div",Ce,[n("div",Ne,[r.original.refundStatus===1?(y(),h("div",Oe,d(e(t)("order.backend.recharge.list.paid")),1)):ae("",!0),l(P,{color:r.original.refundStatus===1?"warning":r.original.payState===1?"success":"error"},{default:m(()=>[re(d(r.original.refundStatus===1?e(t)("order.backend.recharge.list.refunded"):r.original.payState===1?e(t)("order.backend.recharge.list.paid"):e(t)("order.backend.recharge.list.unpaid")),1)]),_:2},1032,["color"])])])]),"actions-cell":m(({row:r})=>[l(e(V),{items:[O(r)]},{default:m(()=>[l(e(g),{icon:"i-lucide-ellipsis",color:"neutral",variant:"ghost","aria-label":"Actions"})]),_:1},8,["items"])]),_:1},8,["data","loading","column-pinning"]),n("div",Re,[n("span",De,d(e(t)("console-common.total"))+" "+d(e(i).total)+" "+d(e(t)("console-common.items")),1),l(L,{modelValue:e(i).page,"onUpdate:modelValue":[a[7]||(a[7]=r=>e(i).page=r),e(c)],"items-per-page":e(i).pageSize,total:e(i).total},null,8,["modelValue","items-per-page","total","onUpdate:modelValue"])])])}}});export{_t as default};
